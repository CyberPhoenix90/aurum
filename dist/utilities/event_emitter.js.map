{"version":3,"file":"event_emitter.js","sourceRoot":"","sources":["../../src/utilities/event_emitter.ts"],"names":[],"mappings":"AAsBA,MAAM,OAAO,YAAY;IAUxB;QACC,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;QAC3B,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;IACvB,CAAC;IATD,IAAW,aAAa;QACvB,OAAO,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC;IACrC,CAAC;IASM,SAAS,CAAC,QAA0B,EAAE,iBAAqC;QACjF,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,kBAAkB,CAAC,QAAQ,EAAE,IAAI,CAAC,gBAAgB,EAAE,iBAAiB,CAAC,CAAC;QAE/F,OAAO,MAAM,CAAC;IACf,CAAC;IAEM,gBAAgB;QACtB,OAAO,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;IAC/B,CAAC;IAEM,SAAS;QACf,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YACnB,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC;SACjC;aAAM;YACN,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;SAChE;IACF,CAAC;IAEM,YAAY,CAAC,IAAO,EAAE,MAAmB;QAC/C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QAErB,IAAI,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC;QAE1C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE;YAChC,IAAI,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,QAAQ,KAAK,MAAM,EAAE;gBACjD,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;aACxC;SACD;QAED,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,CAAC,SAAS,EAAE,CAAC;IAClB,CAAC;IAEO,SAAS;QAChB,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;YAChC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;YACvC,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC;SAC5B;IACF,CAAC;IAEM,IAAI,CAAC,IAAQ;QACnB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QAErB,IAAI,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC;QAE1C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE;YAChC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;SACxC;QAED,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,CAAC,SAAS,EAAE,CAAC;IAClB,CAAC;IAEO,kBAAkB,CACzB,QAA0B,EAC1B,OAA+B,EAC/B,iBAAqC;QAErC,MAAM,IAAI,GAAS,IAAI,CAAC;QAExB,MAAM,YAAY,GAAyB;YAC1C,QAAQ;SACR,CAAC;QAEF,MAAM,MAAM,GAA4B;YACvC,MAAM;gBACL,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC;YACpC,CAAC;SACD,CAAC;QAEF,IAAI,iBAAiB,KAAK,SAAS,EAAE;YACpC,iBAAiB,CAAC,aAAa,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC,CAAC;SAC1E;QACD,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAE3B,OAAO,EAAE,YAAY,EAAE,MAAM,EAAE,CAAC;IACjC,CAAC;IAEO,MAAM,CAAC,YAAkC,EAAE,OAA+B;QACjF,IAAI,KAAK,GAAW,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;QAClD,IAAI,KAAK,IAAI,CAAC,EAAE;YACf,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;gBACnB,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;aACzB;iBAAM;gBACN,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC,CAAC;aAChE;SACD;IACF,CAAC;CACD","sourcesContent":["import { CancellationToken } from '../utilities/cancellation_token';\nimport { Callback } from './common';\n\n/**\n * @internal\n */\nexport interface EventSubscriptionFacade {\n\tcancel(): void;\n}\n\n/**\n * @internal\n */\nexport type EventCallback<T> = (data: T) => void;\n\ninterface EventSubscription<T> {\n\tcallback: EventCallback<T>;\n}\n\n/**\n * @internal\n */\nexport class EventEmitter<T> {\n\tprivate isFiring: boolean;\n\tprivate onAfterFire: Array<() => void>;\n\n\tpublic get subscriptions(): number {\n\t\treturn this.subscribeChannel.length;\n\t}\n\n\tprivate subscribeChannel: EventSubscription<T>[];\n\n\tconstructor() {\n\t\tthis.subscribeChannel = [];\n\t\tthis.onAfterFire = [];\n\t}\n\n\tpublic subscribe(callback: EventCallback<T>, cancellationToken?: CancellationToken): EventSubscriptionFacade {\n\t\tconst { facade } = this.createSubscription(callback, this.subscribeChannel, cancellationToken);\n\n\t\treturn facade;\n\t}\n\n\tpublic hasSubscriptions(): boolean {\n\t\treturn this.subscriptions > 0;\n\t}\n\n\tpublic cancelAll(): void {\n\t\tif (!this.isFiring) {\n\t\t\tthis.subscribeChannel.length = 0;\n\t\t} else {\n\t\t\tthis.onAfterFire.push(() => (this.subscribeChannel.length = 0));\n\t\t}\n\t}\n\n\tpublic fireFiltered(data: T, filter: Callback<T>): void {\n\t\tthis.isFiring = true;\n\n\t\tlet length = this.subscribeChannel.length;\n\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tif (this.subscribeChannel[i].callback !== filter) {\n\t\t\t\tthis.subscribeChannel[i].callback(data);\n\t\t\t}\n\t\t}\n\n\t\tthis.isFiring = false;\n\t\tthis.afterFire();\n\t}\n\n\tprivate afterFire() {\n\t\tif (this.onAfterFire.length > 0) {\n\t\t\tthis.onAfterFire.forEach((cb) => cb());\n\t\t\tthis.onAfterFire.length = 0;\n\t\t}\n\t}\n\n\tpublic fire(data?: T): void {\n\t\tthis.isFiring = true;\n\n\t\tlet length = this.subscribeChannel.length;\n\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tthis.subscribeChannel[i].callback(data);\n\t\t}\n\n\t\tthis.isFiring = false;\n\t\tthis.afterFire();\n\t}\n\n\tprivate createSubscription(\n\t\tcallback: EventCallback<T>,\n\t\tchannel: EventSubscription<T>[],\n\t\tcancellationToken?: CancellationToken\n\t): { subscription: EventSubscription<T>; facade: EventSubscriptionFacade } {\n\t\tconst that: this = this;\n\n\t\tconst subscription: EventSubscription<T> = {\n\t\t\tcallback\n\t\t};\n\n\t\tconst facade: EventSubscriptionFacade = {\n\t\t\tcancel() {\n\t\t\t\tthat.cancel(subscription, channel);\n\t\t\t}\n\t\t};\n\n\t\tif (cancellationToken !== undefined) {\n\t\t\tcancellationToken.addCancelable(() => that.cancel(subscription, channel));\n\t\t}\n\t\tchannel.push(subscription);\n\n\t\treturn { subscription, facade };\n\t}\n\n\tprivate cancel(subscription: EventSubscription<T>, channel: EventSubscription<T>[]): void {\n\t\tlet index: number = channel.indexOf(subscription);\n\t\tif (index >= 0) {\n\t\t\tif (!this.isFiring) {\n\t\t\t\tchannel.splice(index, 1);\n\t\t\t} else {\n\t\t\t\tthis.onAfterFire.push(() => this.cancel(subscription, channel));\n\t\t\t}\n\t\t}\n\t}\n}\n"]}