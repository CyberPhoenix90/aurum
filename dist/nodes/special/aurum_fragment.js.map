{"version":3,"file":"aurum_fragment.js","sourceRoot":"","sources":["../../../src/nodes/special/aurum_fragment.ts"],"names":[],"mappings":"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","sourcesContent":["import { AurumElement, ChildNode } from './aurum_element';\nimport { EventEmitter } from '../../utilities/event_emitter';\nimport { ArrayDataSource, DataSource } from '../../stream/data_source';\nimport { CancellationToken } from '../../utilities/cancellation_token';\nimport { AurumTextElement } from './aurum_text';\n\nexport interface AurumFragmentProps {\n\trepeatModel?: ArrayDataSource<AurumElement>;\n}\n\nexport class AurumFragment {\n\tpublic children: Array<AurumElement | AurumTextElement>;\n\tpublic onChange: EventEmitter<void>;\n\tprivate cancellationToken: CancellationToken;\n\n\tconstructor(props: AurumFragmentProps, children?: ChildNode[]) {\n\t\tthis.onChange = new EventEmitter();\n\t\tthis.children = [];\n\t\tif (props.repeatModel) {\n\t\t\tthis.handleRepeat(props.repeatModel);\n\t\t} else if (children) {\n\t\t\tthis.addChildren(children);\n\t\t}\n\t}\n\n\tprivate addChildren(children: ChildNode[]) {\n\t\tfor (const child of children) {\n\t\t\tif (child instanceof AurumElement) {\n\t\t\t\tthis.children.push(child);\n\t\t\t} else if (child instanceof DataSource) {\n\t\t\t\tlet sourceChild = undefined;\n\t\t\t\tchild.unique(this.cancellationToken).listenAndRepeat((newValue) => {\n\t\t\t\t\tif ((newValue === undefined || newValue === null) && sourceChild) {\n\t\t\t\t\t\tthis.children.splice(this.children.indexOf(sourceChild), 1);\n\t\t\t\t\t\tsourceChild = undefined;\n\t\t\t\t\t\tthis.onChange.fire();\n\t\t\t\t\t} else if (typeof newValue === 'string') {\n\t\t\t\t\t\tif (!sourceChild) {\n\t\t\t\t\t\t\tconst textNode = new AurumTextElement(child as any);\n\t\t\t\t\t\t\tthis.children.push(textNode);\n\t\t\t\t\t\t\tsourceChild = textNode;\n\t\t\t\t\t\t\tthis.onChange.fire();\n\t\t\t\t\t\t} else if (sourceChild instanceof AurumElement) {\n\t\t\t\t\t\t\tconst textNode = new AurumTextElement(child as any);\n\t\t\t\t\t\t\tthis.children.splice(this.children.indexOf(sourceChild), 1, textNode);\n\t\t\t\t\t\t\tsourceChild = textNode;\n\t\t\t\t\t\t\tthis.onChange.fire();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (newValue instanceof AurumElement) {\n\t\t\t\t\t\tif (!sourceChild) {\n\t\t\t\t\t\t\tthis.children.push(newValue);\n\t\t\t\t\t\t\tsourceChild = newValue;\n\t\t\t\t\t\t\tthis.onChange.fire();\n\t\t\t\t\t\t} else if (sourceChild instanceof AurumTextElement || sourceChild !== newValue) {\n\t\t\t\t\t\t\tthis.children.splice(this.children.indexOf(sourceChild), 1, newValue);\n\t\t\t\t\t\t\tsourceChild = newValue;\n\t\t\t\t\t\t\tthis.onChange.fire();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow new Error('case not yet implemented');\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate handleRepeat(dataSource: ArrayDataSource<AurumElement>): void {\n\t\tdataSource.listenAndRepeat((change) => {\n\t\t\tswitch (change.operationDetailed) {\n\t\t\t\tcase 'replace':\n\t\t\t\t\tthis.children[change.index] = change.items[0];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swap':\n\t\t\t\t\tconst itemA = this.children[change.index];\n\t\t\t\t\tconst itemB = this.children[change.index2];\n\t\t\t\t\tthis.children[change.index2] = itemA;\n\t\t\t\t\tthis.children[change.index] = itemB;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'append':\n\t\t\t\t\tthis.children = this.children.concat(change.items);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'prepend':\n\t\t\t\t\tthis.children.unshift(...change.items);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'remove':\n\t\t\t\tcase 'removeLeft':\n\t\t\t\tcase 'removeRight':\n\t\t\t\t\tthis.children.splice(change.index, change.count);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'clear':\n\t\t\t\t\tthis.children = [];\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('unhandled operation');\n\t\t\t}\n\t\t\tthis.onChange.fire();\n\t\t});\n\t}\n\n\tpublic dispose() {\n\t\tif (this.cancellationToken.isCanceled) {\n\t\t\treturn;\n\t\t}\n\t\tthis.cancellationToken.cancel();\n\t}\n}\n"]}