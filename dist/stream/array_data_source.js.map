{"version":3,"file":"array_data_source.js","sourceRoot":"src/","sources":["stream/array_data_source.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter } from './event_emitter';\nimport { DataSource } from './data_source';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { Predicate } from '../utilities/common';\n\nexport interface CollectionChange<T> {\n\toperation: 'replace' | 'append' | 'prepend' | 'removeLeft' | 'removeRight' | 'remove';\n\tcount: number;\n\tindex: number;\n\ttarget?: T;\n\titems: T[];\n\tnewState: T[];\n}\nexport class ArrayDataSource<T> {\n\tprotected data: T[];\n\tpublic onChange: EventEmitter<CollectionChange<T>>;\n\n\tconstructor(initialData?: T[]) {\n\t\tif (initialData) {\n\t\t\tthis.data = initialData.slice();\n\t\t} else {\n\t\t\tthis.data = [];\n\t\t}\n\t\tthis.onChange = new EventEmitter();\n\t}\n\n\tpublic get length() {\n\t\treturn this.data.length;\n\t}\n\n\tpublic getData(): T[] {\n\t\treturn this.data.slice();\n\t}\n\n\tpublic get(index: number): T {\n\t\treturn this.data[index];\n\t}\n\n\tpublic set(index: number, item: T): void {\n\t\tconst old = this.data[index];\n\t\tif (old === item) {\n\t\t\treturn;\n\t\t}\n\t\tthis.data[index] = item;\n\t\tthis.onChange.fire({ operation: 'replace', target: old, count: 1, index, items: [item], newState: this.data });\n\t}\n\n\tpublic push(...items: T[]) {\n\t\tthis.data.push(...items);\n\t\tthis.onChange.fire({\n\t\t\toperation: 'append',\n\t\t\tcount: items.length,\n\t\t\tindex: this.data.length - items.length,\n\t\t\titems,\n\t\t\tnewState: this.data\n\t\t});\n\t}\n\n\tpublic unshift(...items: T[]) {\n\t\tthis.data.unshift(...items);\n\t\tthis.onChange.fire({ operation: 'prepend', count: items.length, items, index: 0, newState: this.data });\n\t}\n\n\tpublic pop(): T {\n\t\tconst item = this.data.pop();\n\t\tthis.onChange.fire({\n\t\t\toperation: 'removeRight',\n\t\t\tcount: 1,\n\t\t\tindex: this.data.length,\n\t\t\titems: [item],\n\t\t\tnewState: this.data\n\t\t});\n\n\t\treturn item;\n\t}\n\n\tpublic merge(newData: T[]): void {\n\t\tfor (let i = 0; i < newData.length; i++) {\n\t\t\tif (this.data[i] !== newData[i]) {\n\t\t\t\tif (this.length > i) {\n\t\t\t\t\tthis.set(i, newData[i]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.push(newData[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.length > newData.length) {\n\t\t\tthis.removeRight(this.length - newData.length);\n\t\t}\n\t}\n\n\tpublic removeRight(count: number): void {\n\t\tconst result = this.data.splice(this.length - count, count);\n\t\tthis.onChange.fire({ operation: 'removeRight', count, index: this.length, items: result, newState: this.data });\n\t}\n\n\tpublic removeLeft(count: number): void {\n\t\tconst result = this.data.splice(0, count);\n\t\tthis.onChange.fire({ operation: 'removeLeft', count, index: 0, items: result, newState: this.data });\n\t}\n\n\tpublic remove(item: T): void {\n\t\tconst index = this.data.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\tthis.data.splice(index, 1);\n\t\t\tthis.onChange.fire({ operation: 'remove', count: 1, index, items: [item], newState: this.data });\n\t\t}\n\t}\n\n\tpublic clear(): void {\n\t\tconst items = this.data;\n\t\tthis.data = [];\n\t\tthis.onChange.fire({\n\t\t\toperation: 'remove',\n\t\t\tcount: items.length,\n\t\t\tindex: 0,\n\t\t\titems,\n\t\t\tnewState: this.data\n\t\t});\n\t}\n\n\tpublic shift(): T {\n\t\tconst item = this.data.shift();\n\t\tthis.onChange.fire({ operation: 'removeLeft', items: [item], count: 1, index: 0, newState: this.data });\n\n\t\treturn item;\n\t}\n\n\tpublic toArray(): T[] {\n\t\treturn this.data.slice();\n\t}\n\n\tpublic filter(callback: Predicate<T>, cancellationToken?: CancellationToken): FilteredArrayView<T> {\n\t\treturn new FilteredArrayView(this, callback, cancellationToken);\n\t}\n\n\tpublic forEach(callbackfn: (value: T, index: number, array: T[]) => void, thisArg?: any): void {\n\t\treturn this.data.forEach(callbackfn, thisArg);\n\t}\n\n\tpublic toDataSource(): DataSource<T[]> {\n\t\tconst stream = new DataSource(this.data);\n\t\tthis.onChange.subscribe((s) => {\n\t\t\tstream.update(s.newState);\n\t\t});\n\t\treturn stream;\n\t}\n}\n\nexport class FilteredArrayView<T> extends ArrayDataSource<T> {\n\tprivate viewFilter: Predicate<T>;\n\tprivate parent: ArrayDataSource<T>;\n\n\tconstructor(parent: ArrayDataSource<T>, filter: Predicate<T>, cancellationToken?: CancellationToken) {\n\t\tconst initial = (parent as FilteredArrayView<T>).data.filter(filter);\n\t\tsuper(initial);\n\n\t\tthis.parent = parent;\n\t\tthis.viewFilter = filter;\n\n\t\tparent.onChange.subscribe((change) => {\n\t\t\tlet filteredItems;\n\t\t\tswitch (change.operation) {\n\t\t\t\tcase 'remove':\n\t\t\t\tcase 'removeLeft':\n\t\t\t\tcase 'removeRight':\n\t\t\t\t\tfor (const item of change.items) {\n\t\t\t\t\t\tthis.remove(item);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'prepend':\n\t\t\t\t\tfilteredItems = change.items.filter(this.viewFilter);\n\t\t\t\t\tthis.unshift(...filteredItems);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'append':\n\t\t\t\t\tfilteredItems = change.items.filter(this.viewFilter);\n\t\t\t\t\tthis.push(...filteredItems);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'replace':\n\t\t\t\t\tconst index = this.data.indexOf(change.target);\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tconst acceptNew = this.viewFilter(change.items[0]);\n\t\t\t\t\t\tif (acceptNew) {\n\t\t\t\t\t\t\tthis.set(index, change.items[0]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.remove(change.target);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t}\n\t\t}, cancellationToken);\n\t}\n\n\tpublic updateFilter(filter: Predicate<T>): void {\n\t\tif (this.viewFilter === filter) {\n\t\t\treturn;\n\t\t}\n\t\tthis.viewFilter = filter;\n\t\tthis.refresh();\n\t}\n\n\tprotected refresh() {\n\t\tthis.clear();\n\t\tconst data = (this.parent as FilteredArrayView<T>).data.filter(this.viewFilter);\n\t\tthis.push(...data);\n\t}\n}\n"]}