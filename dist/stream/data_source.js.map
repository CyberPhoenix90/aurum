{"version":3,"file":"data_source.js","sourceRoot":"","sources":["../../src/stream/data_source.ts"],"names":[],"mappings":"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","sourcesContent":["import { CancellationToken } from '../utilities/cancellation_token';\nimport { Callback } from '../utilities/common';\n\nexport class DataSource<T> {\n\tpublic value: T;\n\tprivate listeners: Array<(value: T) => void>;\n\n\tconstructor(initialValue?: T) {\n\t\tthis.value = initialValue;\n\t\tthis.listeners = [];\n\t}\n\n\tpublic update(newValue: T) {\n\t\tthis.value = newValue;\n\t\tfor (const l of this.listeners) {\n\t\t\tl(newValue);\n\t\t}\n\t}\n\n\tpublic listen(callback: (value: T) => void, cancellationToken?: CancellationToken): Callback<void> {\n\t\tthis.listeners.push(callback);\n\t\tconst cancel = () => {\n\t\t\tconst index = this.listeners.indexOf(callback);\n\t\t\tif (index !== -1) {\n\t\t\t\tthis.listeners.splice(index, 1);\n\t\t\t}\n\t\t};\n\t\tcancellationToken?.addCancelable(() => {\n\t\t\tcancel();\n\t\t});\n\t\treturn cancel;\n\t}\n\n\tpublic filter(callback: (value: T) => boolean, cancellationToken?: CancellationToken): DataSource<T> {\n\t\tconst filteredSource = new DataSource<T>();\n\t\tthis.listen((value) => {\n\t\t\tif (callback(value)) {\n\t\t\t\tfilteredSource.update(value);\n\t\t\t}\n\t\t}, cancellationToken);\n\t\treturn filteredSource;\n\t}\n\n\tpublic pipe(targetDataSource: DataSource<T>, cancellationToken?: CancellationToken): void {\n\t\tthis.listen((v) => targetDataSource.update(v), cancellationToken);\n\t}\n\n\tpublic map<D>(callback: (value: T) => D, cancellationToken?: CancellationToken): DataSource<D> {\n\t\tconst mappedSource = new DataSource<D>(callback(this.value));\n\t\tthis.listen((value) => {\n\t\t\tmappedSource.update(callback(value));\n\t\t}, cancellationToken);\n\t\treturn mappedSource;\n\t}\n\n\tpublic unique(cancellationToken?: CancellationToken): DataSource<T> {\n\t\tconst uniqueSource = new DataSource<T>();\n\t\tthis.listen((value) => {\n\t\t\tif (value !== uniqueSource.value) {\n\t\t\t\tuniqueSource.update(value);\n\t\t\t}\n\t\t}, cancellationToken);\n\t\treturn uniqueSource;\n\t}\n\n\tpublic reduce(reducer: (p: T, c: T) => T, initialValue: T, cancellationToken?: CancellationToken): DataSource<T> {\n\t\tconst reduceSource = new DataSource<T>(initialValue);\n\t\tthis.listen((v) => reduceSource.update(reducer(reduceSource.value, v)), cancellationToken);\n\n\t\treturn reduceSource;\n\t}\n\n\tpublic aggregate<D, E>(otherSource: DataSource<D>, combinator: (self: T, other: D) => E, cancellationToken?: CancellationToken): DataSource<E> {\n\t\tconst aggregatedSource = new DataSource<E>(combinator(this.value, otherSource.value));\n\n\t\tthis.listen(() => aggregatedSource.update(combinator(this.value, otherSource.value)), cancellationToken);\n\t\totherSource.listen(() => aggregatedSource.update(combinator(this.value, otherSource.value)), cancellationToken);\n\n\t\treturn aggregatedSource;\n\t}\n\n\tpublic combine(otherSource: DataSource<T>, cancellationToken?: CancellationToken): DataSource<T> {\n\t\tconst combinedDataSource = new DataSource<T>();\n\t\tthis.pipe(combinedDataSource, cancellationToken);\n\t\totherSource.pipe(combinedDataSource, cancellationToken);\n\n\t\treturn combinedDataSource;\n\t}\n\n\tpublic pick(key: keyof T, cancellationToken?: CancellationToken): DataSource<T[typeof key]> {\n\t\tconst subDataSource: DataSource<T[typeof key]> = new DataSource(this.value?.[key]);\n\n\t\tthis.listen((v) => {\n\t\t\tif (v !== undefined && v !== null) {\n\t\t\t\tsubDataSource.update(v[key]);\n\t\t\t} else {\n\t\t\t\tsubDataSource.update(v as null | undefined);\n\t\t\t}\n\t\t}, cancellationToken);\n\n\t\treturn subDataSource;\n\t}\n\n\tpublic cancelAll(): void {\n\t\tthis.listeners.length = 0;\n\t}\n}\n"]}