{"version":3,"file":"aurumjs.js","sourceRoot":"","sources":["src/stream/operator_model.ts","src/stream/duplex_data_source.ts","src/utilities/common.ts","src/utilities/cancellation_token.ts","src/utilities/event_emitter.ts","src/debug_mode.ts","src/stream/stream.ts","src/stream/data_source.ts","src/rendering/classname.ts","src/rendering/aurum_element.ts","src/stream/data_source_operators.ts","src/nodes/dom_adapter.ts","src/nodes/input.ts","src/nodes/select.ts","src/nodes/simple_dom_nodes.ts","src/nodes/textarea.ts","src/utilities/aurum.ts","src/rendering/webcomponent.ts","src/builtin_compoents/router.ts","src/builtin_compoents/suspense.ts","src/builtin_compoents/switch.ts","src/stream/object_data_source.ts","src/stream/map_data_source.ts","src/stream/set_data_source.ts","src/aurumjs.ts"],"names":[],"mappings":"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","sourcesContent":["export enum OperationType {\n\tFILTER,\n\tNOOP,\n\tMAP,\n\tDELAY,\n\tMAP_DELAY,\n\tDELAY_FILTER,\n\tMAP_DELAY_FILTER\n}\n\nexport interface DataSourceOperator<T, M> {\n\toperationType: OperationType;\n\t//Inference only works if the types are used despite the fact that the generic types are only used to indicate what type goes in and what type comes out which cannot be described in a way that typescript understands\n\ttypescriptLimitationWorkaround?: (value: T) => M;\n\tname: string;\n}\n\nexport interface DataSourceFilterOperator<T> extends DataSourceOperator<T, T> {\n\toperationType: OperationType.FILTER;\n\toperation: (value: T) => boolean;\n}\n\nexport interface DataSourceMapOperator<T, M> extends DataSourceOperator<T, M> {\n\toperationType: OperationType.MAP;\n\toperation: (value: T) => M;\n}\n\nexport interface DataSourceNoopOperator<T> extends DataSourceOperator<T, T> {\n\toperationType: OperationType.NOOP;\n\toperation: (value: T) => T;\n}\n\nexport interface DataSourceDelayOperator<T> extends DataSourceOperator<T, T> {\n\toperationType: OperationType.DELAY;\n\toperation: (value: T) => Promise<T>;\n}\n\nexport interface DataSourceMapDelayOperator<T, M> extends DataSourceOperator<T, M> {\n\toperationType: OperationType.MAP_DELAY;\n\toperation: (value: T) => Promise<M>;\n}\n\nexport interface DataSourceMapDelayFilterOperator<T, M> extends DataSourceOperator<T, M> {\n\toperationType: OperationType.MAP_DELAY_FILTER;\n\toperation: (value: T) => Promise<{ item: M; cancelled: boolean }>;\n}\n\nexport interface DataSourceDelayFilterOperator<T> extends DataSourceOperator<T, T> {\n\toperationType: OperationType.DELAY_FILTER;\n\toperation: (value: T) => Promise<boolean>;\n}\n","import { CancellationToken } from '../utilities/cancellation_token';\nimport { Callback } from '../utilities/common';\nimport { EventEmitter } from '../utilities/event_emitter';\nimport { DataSource, GenericDataSource, processTransform, ReadOnlyDataSource } from './data_source';\nimport { DataSourceOperator } from './operator_model';\n\nexport enum DataFlow {\n\tUPSTREAM,\n\tDOWNSTREAM\n}\n\n/**\n * Same as DataSource except data can flow in both directions\n */\nexport class DuplexDataSource<T> implements GenericDataSource<T> {\n\t/**\n\t * The current value of this data source, can be changed through update\n\t */\n\tpublic value: T;\n\tprivate primed: boolean;\n\n\tprivate updatingUpstream: boolean;\n\tprivate updatingDownstream: boolean;\n\tprivate updateDownstreamEvent: EventEmitter<T>;\n\tprivate updateUpstreamEvent: EventEmitter<T>;\n\tprivate propagateWritesToReadStream: boolean;\n\tpublic name: string;\n\n\t/**\n\t *\n\t * @param initialValue\n\t * @param propagateWritesToReadStream If a write is done propagate this update back down to all the consumers. Useful at the root node\n\t */\n\tconstructor(initialValue?: T, propagateWritesToReadStream: boolean = true, name: string = 'RootDuplexDataSource') {\n\t\tthis.name = name;\n\t\tthis.value = initialValue;\n\t\tthis.primed = initialValue !== undefined;\n\t\tthis.updateDownstreamEvent = new EventEmitter();\n\t\tthis.updateUpstreamEvent = new EventEmitter();\n\t\tthis.propagateWritesToReadStream = propagateWritesToReadStream;\n\t}\n\n\t/**\n\t * Makes it possible to have 2 completely separate data flow pipelines for each direction\n\t * @param downStream stream to pipe downstream data to\n\t * @param upstream  stream to pipe upstream data to\n\t */\n\tpublic static fromTwoDataSource<T>(\n\t\tdownStream: DataSource<T>,\n\t\tupstream: DataSource<T>,\n\t\tinitialValue?: T,\n\t\tpropagateWritesToReadStream: boolean = true\n\t): DuplexDataSource<T> {\n\t\tconst result = new DuplexDataSource<T>(initialValue, propagateWritesToReadStream);\n\t\t//@ts-ignore\n\t\tresult.updateDownstreamEvent = downStream.updateEvent;\n\t\t//@ts-ignore\n\t\tresult.updateUpstreamEvent = upstream.updateEvent;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Updates the data source with a value if it has never had a value before\n\t */\n\tpublic withInitial(value: T): this {\n\t\tif (!this.primed) {\n\t\t\tthis.updateDownstream(value);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Allows creating a duplex stream that blocks data in one direction. Useful for plugging into code that uses two way flow but only one way is desired\n\t * @param direction direction of the dataflow that is allowed\n\t */\n\tpublic static createOneWay<T>(direction: DataFlow = DataFlow.DOWNSTREAM, initialValue?: T): DuplexDataSource<T> {\n\t\treturn new DuplexDataSource(initialValue, false).oneWayFlow(direction);\n\t}\n\t/**\n\t * Updates the value in the data source and calls the listen callback for all listeners\n\t * @param newValue new value for the data source\n\t */\n\tpublic updateDownstream(newValue: T): void {\n\t\tif (this.updatingDownstream) {\n\t\t\tthrow new Error(\n\t\t\t\t'Problem in datas source: Unstable value propagation, when updating a value the stream was updated back as a direct response. This can lead to infinite loops and is therefore not allowed'\n\t\t\t);\n\t\t}\n\t\tthis.primed = true;\n\t\tthis.updatingDownstream = true;\n\t\tthis.value = newValue;\n\t\tthis.updateDownstreamEvent.fire(newValue);\n\t\tthis.updatingDownstream = false;\n\t}\n\n\t/**\n\t * Updates the value in the data source and calls the listen callback for all listeners\n\t * @param newValue new value for the data source\n\t */\n\tpublic updateUpstream(newValue: T): void {\n\t\tif (this.updatingUpstream) {\n\t\t\tthrow new Error(\n\t\t\t\t'Problem in datas source: Unstable value propagation, when updating a value the stream was updated back as a direct response. This can lead to infinite loops and is therefore not allowed'\n\t\t\t);\n\t\t}\n\t\tthis.primed = true;\n\t\tthis.updatingUpstream = true;\n\t\tthis.value = newValue;\n\t\tthis.updateUpstreamEvent.fire(newValue);\n\t\tif (this.propagateWritesToReadStream) {\n\t\t\tthis.updateDownstreamEvent.fire(newValue);\n\t\t}\n\t\tthis.updatingUpstream = false;\n\t}\n\n\t/**\n\t * Same as listen but will immediately call the callback with the current value first\n\t * @param callback Callback to call when value is updated\n\t * @param cancellationToken Optional token to control the cancellation of the subscription\n\t * @returns Cancellation callback, can be used to cancel subscription without a cancellation token\n\t */\n\tpublic listenAndRepeat(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tcallback(this.value);\n\t\treturn this.listen(callback, cancellationToken);\n\t}\n\n\t/**\n\t * alias for listenDownstream\n\t * @param callback Callback to call when value is updated\n\t * @param cancellationToken Optional token to control the cancellation of the subscription\n\t * @returns Cancellation callback, can be used to cancel subscription without a cancellation token\n\t */\n\tpublic listen(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.listenInternal(callback, cancellationToken);\n\t}\n\n\tprivate listenInternal(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateDownstreamEvent.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Subscribes exclusively to updates of the data stream that occur due to an update flowing upstream\n\t * @param callback Callback to call when value is updated\n\t * @param cancellationToken Optional token to control the cancellation of the subscription\n\t * @returns Cancellation callback, can be used to cancel subscription without a cancellation token\n\t */\n\tpublic listenUpstream(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateUpstreamEvent.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Subscribes exclusively to one update of the data stream that occur due to an update flowing upstream\n\t * @param callback Callback to call when value is updated\n\t * @param cancellationToken Optional token to control the cancellation of the subscription\n\t * @returns Cancellation callback, can be used to cancel subscription without a cancellation token\n\t */\n\tpublic listenUpstreamOnce(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateUpstreamEvent.subscribeOnce(callback, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Subscribes exclusively to updates of the data stream that occur due to an update flowing downstream\n\t * @param callback Callback to call when value is updated\n\t * @param cancellationToken Optional token to control the cancellation of the subscription\n\t * @returns Cancellation callback, can be used to cancel subscription without a cancellation token\n\t */\n\tpublic listenDownstream(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateDownstreamEvent.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\tpublic downStreamToDataSource(cancellationToken?: CancellationToken): DataSource<T> {\n\t\tconst downStreamDatasource = new DataSource<T>(this.value);\n\t\tthis.listenDownstream((newVal) => {\n\t\t\tdownStreamDatasource.update(newVal);\n\t\t}, cancellationToken);\n\n\t\treturn downStreamDatasource;\n\t}\n\n\t/**\n\t * Combines two sources into a third source that listens to updates from both parent sources.\n\t * @param otherSource Second parent for the new source\n\t * @param combinator Method allowing you to combine the data from both parents on update. Called each time a parent is updated with the latest values of both parents\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the two parent datasources\n\t */\n\tpublic aggregate<D, E>(otherSource: ReadOnlyDataSource<D>, combinator: (self: T, other: D) => E, cancellationToken?: CancellationToken): DataSource<E> {\n\t\tcancellationToken = cancellationToken ?? new CancellationToken();\n\t\tconst aggregatedSource = new DataSource<E>(combinator(this.value, otherSource.value));\n\n\t\tthis.listen(() => aggregatedSource.update(combinator(this.value, otherSource.value)), cancellationToken);\n\t\totherSource.listen(() => aggregatedSource.update(combinator(this.value, otherSource.value)), cancellationToken);\n\n\t\treturn aggregatedSource;\n\t}\n\n\t/**\n\t * Combines three sources into a fourth source that listens to updates from all parent sources.\n\t * @param second Second parent for the new source\n\t * @param third Third parent for the new source\n\t * @param combinator Method allowing you to combine the data from all parents on update. Called each time a parent is updated with the latest values of all parents\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the parent datasources\n\t */\n\tpublic aggregateThree<D, E, F>(\n\t\tsecond: ReadOnlyDataSource<D>,\n\t\tthird: ReadOnlyDataSource<E>,\n\t\tcombinator: (self: T, second: D, third: E) => F,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<F> {\n\t\tcancellationToken = cancellationToken ?? new CancellationToken();\n\t\tconst aggregatedSource = new DataSource<F>(combinator(this.value, second.value, third.value));\n\n\t\tthis.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value)), cancellationToken);\n\t\tsecond.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value)), cancellationToken);\n\t\tthird.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value)), cancellationToken);\n\n\t\treturn aggregatedSource;\n\t}\n\n\t/**\n\t * Combines four sources into a fifth source that listens to updates from all parent sources.\n\t * @param second Second parent for the new source\n\t * @param third Third parent for the new source\n\t * @param fourth Fourth parent for the new source\n\t * @param combinator Method allowing you to combine the data from all parents on update. Called each time a parent is updated with the latest values of all parents\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the parent datasources\n\t */\n\tpublic aggregateFour<D, E, F, G>(\n\t\tsecond: ReadOnlyDataSource<D>,\n\t\tthird: ReadOnlyDataSource<E>,\n\t\tfourth: ReadOnlyDataSource<F>,\n\t\tcombinator: (self: T, second: D, third: E, fourth: F) => G,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<G> {\n\t\tcancellationToken = cancellationToken ?? new CancellationToken();\n\t\tconst aggregatedSource = new DataSource<G>(combinator(this.value, second.value, third.value, fourth.value));\n\n\t\tthis.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value)), cancellationToken);\n\t\tsecond.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value)), cancellationToken);\n\t\tthird.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value)), cancellationToken);\n\t\tfourth.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value)), cancellationToken);\n\n\t\treturn aggregatedSource;\n\t}\n\n\t/**\n\t * Creates a new datasource that listenes to updates of this datasource but only propagates the updates from this source if they pass a predicate check\n\t * @param callback predicate check to decide if the update from the parent data source is passed down or not\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions added to the datasources by this operation\n\t */\n\tpublic filter(downStreamFilter: (value: T, oldValue: T) => boolean, cancellationToken?: CancellationToken): DataSource<T>;\n\tpublic filter(\n\t\tdownStreamFilter: (value: T, oldValue: T) => boolean,\n\t\tupstreamFilter?: (value: T) => boolean,\n\t\tcancellationToken?: CancellationToken\n\t): DuplexDataSource<T>;\n\tpublic filter(\n\t\tdownStreamFilter: (value: T, oldValue: T) => boolean,\n\t\tupstreamFilter?: ((value: T, oldValue: T) => boolean) | CancellationToken,\n\t\tcancellationToken?: CancellationToken\n\t): DuplexDataSource<T> | DataSource<T> {\n\t\tif (typeof upstreamFilter === 'function') {\n\t\t\tconst filteredSource = new DuplexDataSource<T>(undefined, false);\n\t\t\tthis.listenDownstream((newVal) => {\n\t\t\t\tif (downStreamFilter(newVal, filteredSource.value)) {\n\t\t\t\t\tfilteredSource.updateDownstream(newVal);\n\t\t\t\t}\n\t\t\t}, cancellationToken);\n\n\t\t\tfilteredSource.listenUpstream((newVal) => {\n\t\t\t\tif ((upstreamFilter as any)(newVal, this.value)) {\n\t\t\t\t\tthis.updateUpstream(newVal);\n\t\t\t\t}\n\t\t\t}, cancellationToken);\n\n\t\t\treturn filteredSource;\n\t\t} else {\n\t\t\tconst filteredSource = new DataSource<T>();\n\t\t\tthis.listenDownstream((newVal) => {\n\t\t\t\tif (downStreamFilter(newVal, filteredSource.value)) {\n\t\t\t\t\tfilteredSource.update(newVal);\n\t\t\t\t}\n\t\t\t}, upstreamFilter as any);\n\n\t\t\treturn filteredSource;\n\t\t}\n\t}\n\n\tpublic transform<A, B = A, C = B, D = C, E = D, F = E, G = F, H = G, I = H, J = I, K = J>(\n\t\toperationA: DataSourceOperator<T, A>,\n\t\toperationB?: DataSourceOperator<A, B> | CancellationToken,\n\t\toperationC?: DataSourceOperator<B, C> | CancellationToken,\n\t\toperationD?: DataSourceOperator<C, D> | CancellationToken,\n\t\toperationE?: DataSourceOperator<D, E> | CancellationToken,\n\t\toperationF?: DataSourceOperator<E, F> | CancellationToken,\n\t\toperationG?: DataSourceOperator<F, G> | CancellationToken,\n\t\toperationH?: DataSourceOperator<G, H> | CancellationToken,\n\t\toperationI?: DataSourceOperator<H, I> | CancellationToken,\n\t\toperationJ?: DataSourceOperator<I, J> | CancellationToken,\n\t\toperationK?: DataSourceOperator<J, K> | CancellationToken,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<K> {\n\t\tlet token;\n\t\tconst operations: DataSourceOperator<any, any>[] = [\n\t\t\toperationA,\n\t\t\toperationB,\n\t\t\toperationC,\n\t\t\toperationD,\n\t\t\toperationE,\n\t\t\toperationF,\n\t\t\toperationG,\n\t\t\toperationH,\n\t\t\toperationI,\n\t\t\toperationJ,\n\t\t\toperationK\n\t\t].filter((e) => e && (e instanceof CancellationToken ? ((token = e), false) : true)) as DataSourceOperator<any, any>[];\n\t\tif (cancellationToken) {\n\t\t\ttoken = cancellationToken;\n\t\t}\n\t\tconst result = new DataSource<K>(undefined, this.name + ' ' + operations.map((v) => v.name).join(' '));\n\t\t(this.primed ? this.listenAndRepeat : this.listen).call(this, processTransform<T, K>(operations as any, result), token);\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Forwards all updates from this source to another\n\t * @param targetDataSource datasource to pipe the updates to\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions added to the datasources by this operation\n\t */\n\tpublic pipe(targetDataSource: DuplexDataSource<T>, cancellationToken?: CancellationToken): this {\n\t\tthis.listenDownstream((newVal) => targetDataSource.updateDownstream(newVal), cancellationToken);\n\t\ttargetDataSource.listenUpstream((newVal) => this.updateUpstream(newVal), cancellationToken);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Creates a new datasource that is listening to updates from this datasource and transforms them with a mapper function before fowarding them to itself\n\t * @param mapper mapper function that transforms the data when it flows downwards\n\t * @param reverseMapper mapper function that transforms the data when it flows upwards\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions added to the datasources by this operation\n\t */\n\tpublic map<D>(mapper: (value: T) => D, cancellationToken?: CancellationToken): DataSource<D>;\n\tpublic map<D>(mapper: (value: T) => D, reverseMapper: (value: D) => T, cancellationToken?: CancellationToken): DuplexDataSource<D>;\n\tpublic map<D>(\n\t\tmapper: (value: T) => D,\n\t\treverseMapper?: ((value: D) => T) | CancellationToken,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<D> | DuplexDataSource<D> {\n\t\tif (typeof reverseMapper === 'function') {\n\t\t\tlet mappedSource;\n\t\t\tif (this.primed) {\n\t\t\t\tmappedSource = new DuplexDataSource<D>(mapper(this.value), false);\n\t\t\t} else {\n\t\t\t\tmappedSource = new DuplexDataSource<D>(undefined, false);\n\t\t\t}\n\n\t\t\tthis.listenDownstream((v) => mappedSource.updateDownstream(mapper(v)), cancellationToken);\n\t\t\tmappedSource.listenUpstream((v) => this.updateUpstream((reverseMapper as any)(v)), cancellationToken);\n\n\t\t\treturn mappedSource;\n\t\t} else {\n\t\t\tlet mappedSource;\n\t\t\tif (this.primed) {\n\t\t\t\tmappedSource = new DataSource<D>(mapper(this.value));\n\t\t\t} else {\n\t\t\t\tmappedSource = new DataSource<D>();\n\t\t\t}\n\n\t\t\tthis.listenDownstream((v) => mappedSource.update(mapper(v)), reverseMapper as any);\n\n\t\t\treturn mappedSource;\n\t\t}\n\t}\n\n\tpublic listenOnce(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateDownstreamEvent.subscribeOnce(callback, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Returns a promise that resolves when the next update occurs\n\t * @param cancellationToken\n\t */\n\tpublic awaitNextUpdate(cancellationToken?: CancellationToken): Promise<T> {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.listenOnce((value) => resolve(value), cancellationToken);\n\t\t});\n\t}\n\n\tpublic debounceUpstream(time: number, cancellationToken?: CancellationToken): DuplexDataSource<T> {\n\t\tconst debouncedDataSource = new DuplexDataSource<T>(this.value);\n\t\tlet timeout;\n\n\t\tdebouncedDataSource.listenUpstream((v) => {\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(() => {\n\t\t\t\tthis.updateUpstream(v);\n\t\t\t}, time);\n\t\t}, cancellationToken);\n\n\t\tthis.listenDownstream((v) => {\n\t\t\tdebouncedDataSource.updateDownstream(v);\n\t\t}, cancellationToken);\n\n\t\treturn debouncedDataSource;\n\t}\n\n\tpublic debounceDownstream(time: number, cancellationToken?: CancellationToken): DuplexDataSource<T> {\n\t\tconst debouncedDataSource = new DuplexDataSource<T>(this.value);\n\t\tlet timeout;\n\n\t\tthis.listenDownstream((v) => {\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(() => {\n\t\t\t\tdebouncedDataSource.updateDownstream(v);\n\t\t\t}, time);\n\t\t}, cancellationToken);\n\n\t\tdebouncedDataSource.listenUpstream((v) => {\n\t\t\tthis.updateUpstream(v);\n\t\t}, cancellationToken);\n\n\t\treturn debouncedDataSource;\n\t}\n\n\t/**\n\t * Creates a new datasource that listens to this one and forwards updates if they are not the same as the last update\n\t * @param cancellationToken  Cancellation token to cancel the subscription the new datasource has to this datasource\n\t */\n\tpublic unique(cancellationToken?: CancellationToken): DuplexDataSource<T> {\n\t\tconst uniqueSource = new DuplexDataSource<T>(this.value, false);\n\n\t\tlet upstreamValue = this.value;\n\t\tlet downStreamValue = this.value;\n\t\tthis.listenDownstream((v) => {\n\t\t\tif (downStreamValue !== v) {\n\t\t\t\tdownStreamValue = v;\n\t\t\t\tuniqueSource.updateDownstream(v);\n\t\t\t}\n\t\t}, cancellationToken);\n\n\t\tuniqueSource.listenUpstream((v) => {\n\t\t\tif (upstreamValue !== v) {\n\t\t\t\tupstreamValue = v;\n\t\t\t\tthis.updateUpstream(v);\n\t\t\t}\n\t\t}, cancellationToken);\n\n\t\treturn uniqueSource;\n\t}\n\n\t/**\n\t * Allows flow of data only in one direction\n\t * @param direction direction of the dataflow that is allowed\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the two parent datasources\n\t */\n\tpublic oneWayFlow(direction: DataFlow = DataFlow.DOWNSTREAM, cancellationToken?: CancellationToken): DuplexDataSource<T> {\n\t\tconst oneWaySource = new DuplexDataSource(this.value, false);\n\n\t\tif (direction === DataFlow.DOWNSTREAM) {\n\t\t\tthis.listenDownstream((v) => oneWaySource.updateDownstream(v), cancellationToken);\n\t\t\toneWaySource.updateUpstream = () => void 0;\n\t\t} else {\n\t\t\toneWaySource.listenUpstream((v) => this.updateUpstream(v));\n\t\t\toneWaySource.updateDownstream = () => void 0;\n\t\t}\n\n\t\treturn oneWaySource;\n\t}\n\n\t/**\n\t * Creates a new datasource that listens to this source and combines all updates into a single value\n\t * @param reducer  function that aggregates an update with the previous result of aggregation\n\t * @param initialValue initial value given to the new source\n\t * @param cancellationToken  Cancellation token to cancel the subscription the new datasource has to this datasource\n\t */\n\tpublic reduce(reducer: (p: T, c: T) => T, initialValue: T, cancellationToken?: CancellationToken): DataSource<T> {\n\t\tconst reduceSource = new DataSource<T>(initialValue);\n\t\tthis.listen((v) => reduceSource.update(reducer(reduceSource.value, v)), cancellationToken);\n\n\t\treturn reduceSource;\n\t}\n\n\t/**\n\t * Remove all listeners\n\t */\n\tpublic cancelAll(): void {\n\t\tthis.updateDownstreamEvent.cancelAll();\n\t\tthis.updateUpstreamEvent.cancelAll();\n\t}\n}\n","import { DataSource, ReadOnlyDataSource } from '../stream/data_source';\nimport { DuplexDataSource } from '../stream/duplex_data_source';\n\nexport type AttributeValue = string | ReadOnlyDataSource<string> | ReadOnlyDataSource<boolean> | boolean;\nexport type StringSource = string | ReadOnlyDataSource<string>;\nexport type ClassType = string | ReadOnlyDataSource<string> | ReadOnlyDataSource<string[]> | Array<string | ReadOnlyDataSource<string>>;\n/**\n * Type alias for a generic calback taking a parameter and not returning anything\n */\nexport type Callback<T> = (data?: T) => void;\nexport type Delegate = () => void;\nexport type Predicate<T> = (data: T) => boolean;\nexport type Provider<T> = () => T;\nexport type Comparator<T1, T2> = (value1: T1, value2: T2) => boolean;\nexport type Constructor<T> = new (...args: any[]) => T;\nexport type MapLike<T> = { [key: string]: T };\n\nexport type DataDrain<T> = Callback<T> | DataSource<T> | DuplexDataSource<T>;\nexport declare type ThenArg<T> = T extends any ? any : T extends PromiseLike<infer U> ? U : T;\n","import { Delegate, Callback } from './common';\n\nexport class CancellationToken {\n\tprivate cancelables: Delegate[];\n\tprivate _isCancelled: boolean;\n\n\tpublic get isCanceled(): boolean {\n\t\treturn this._isCancelled;\n\t}\n\n\tconstructor(...cancellables: Delegate[]) {\n\t\tthis.cancelables = cancellables ?? [];\n\t\tthis._isCancelled = false;\n\t}\n\n\tpublic hasCancellables(): boolean {\n\t\treturn this.cancelables.length > 0;\n\t}\n\n\t/**\n\t * Attaches a new cancelable to this token\n\t * @param delegate\n\t */\n\tpublic addCancelable(delegate: Delegate): this {\n\t\tthis.throwIfCancelled('attempting to add cancellable to token that is already cancelled');\n\n\t\tthis.cancelables.push(delegate);\n\n\t\tif (this.cancelables.length === 200) {\n\t\t\tconsole.log('potential memory leak: cancellation token has over 200 clean up calls');\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tpublic removeCancelable(delegate: Delegate): this {\n\t\tthis.throwIfCancelled('attempting to remove cancellable from token that is already cancelled');\n\n\t\tconst index = this.cancelables.indexOf(delegate);\n\t\tif (index !== -1) {\n\t\t\tthis.cancelables.splice(index, 1);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tpublic setTimeout(cb: Delegate, time: number = 0): void {\n\t\tconst id = setTimeout(() => {\n\t\t\tthis.removeCancelable(cancelable);\n\t\t\tcb();\n\t\t}, time);\n\t\tconst cancelable = () => clearTimeout(id);\n\t\tthis.addCancelable(cancelable);\n\t}\n\n\tpublic setInterval(cb: Delegate, time: number): void {\n\t\tconst id = setInterval(cb, time);\n\t\tthis.addCancelable(() => clearInterval(id));\n\t}\n\n\tpublic requestAnimationFrame(cb: Callback<number>): void {\n\t\tconst id: number = requestAnimationFrame(() => {\n\t\t\tthis.removeCancelable(cancelable);\n\t\t\tcb();\n\t\t});\n\t\tconst cancelable = () => cancelAnimationFrame(id);\n\t\tthis.addCancelable(cancelable);\n\t}\n\n\tpublic animationLoop(cb: Callback<number>): void {\n\t\tlet id: number = requestAnimationFrame(function f(time: number) {\n\t\t\tid = requestAnimationFrame(f);\n\t\t\tcb(time);\n\t\t});\n\n\t\tthis.addCancelable(() => cancelAnimationFrame(id));\n\t}\n\n\tpublic throwIfCancelled(msg: string): void {\n\t\tif (this.isCanceled) {\n\t\t\tthrow new Error(msg || 'cancellation token is cancelled');\n\t\t}\n\t}\n\n\tpublic chain(target: CancellationToken, twoWays: boolean = false): CancellationToken {\n\t\tif (twoWays) {\n\t\t\ttarget.chain(this, false);\n\t\t}\n\n\t\tthis.addCancelable(() => target.cancel());\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Registers an event using addEventListener and if you cancel the token the event will be canceled as well\n\t */\n\tpublic registerDomEvent(eventEmitter: HTMLElement | Document | Window, event: string, callback: (e: Event) => void): this {\n\t\t(eventEmitter as HTMLElement).addEventListener(event, callback);\n\t\tthis.addCancelable(() => eventEmitter.removeEventListener(event, callback));\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Cancels everything attached to this token\n\t */\n\tpublic cancel(): void {\n\t\tif (this.isCanceled) {\n\t\t\treturn;\n\t\t}\n\t\tthis._isCancelled = true;\n\t\tthis.cancelables.forEach((c) => c());\n\t\tthis.cancelables = undefined;\n\t}\n}\n","import { CancellationToken } from '../utilities/cancellation_token';\nimport { Callback } from './common';\n\n/**\n * @internal\n */\nexport interface EventSubscriptionFacade {\n\tcancel(): void;\n}\n\n/**\n * @internal\n */\nexport type EventCallback<T> = (data: T) => void;\n\ninterface EventSubscription<T> {\n\tcallback: EventCallback<T>;\n}\n\n/**\n * @internal\n */\nexport class EventEmitter<T> {\n\tprivate isFiring: boolean;\n\tprivate onAfterFire: Array<() => void>;\n\tpublic onEmpty: Callback<void>;\n\n\tprivate static leakWarningThreshold;\n\n\tpublic static setSubscriptionLeakWarningThreshold(limit: number) {\n\t\tEventEmitter.leakWarningThreshold = limit;\n\t}\n\n\tpublic get subscriptions(): number {\n\t\treturn this.subscribeChannel.length + this.subscribeOnceChannel.length;\n\t}\n\n\tprivate subscribeChannel: EventSubscription<T>[];\n\tprivate subscribeOnceChannel: EventSubscription<T>[];\n\n\tconstructor() {\n\t\tthis.subscribeChannel = [];\n\t\tthis.subscribeOnceChannel = [];\n\t\tthis.onAfterFire = [];\n\t}\n\n\tpublic subscribe(callback: EventCallback<T>, cancellationToken?: CancellationToken): EventSubscriptionFacade {\n\t\tconst { facade } = this.createSubscription(callback, this.subscribeChannel, cancellationToken);\n\t\tif (EventEmitter.leakWarningThreshold && this.subscribeChannel.length > EventEmitter.leakWarningThreshold) {\n\t\t\tconsole.warn(`Observable has ${this.subscribeChannel.length} subscriptions. This could potentially indicate a memory leak`);\n\t\t}\n\n\t\treturn facade;\n\t}\n\n\tsubscribeOnce(callback: import('./common').Callback<T>, cancellationToken?: CancellationToken) {\n\t\tconst { facade } = this.createSubscription(callback, this.subscribeOnceChannel, cancellationToken);\n\n\t\tif (EventEmitter.leakWarningThreshold && this.subscribeOnceChannel.length > EventEmitter.leakWarningThreshold) {\n\t\t\tconsole.warn(`Observable has ${this.subscribeOnceChannel.length} one time subscriptions. This could potentially indicate a memory leak`);\n\t\t}\n\n\t\treturn facade;\n\t}\n\n\tpublic hasSubscriptions(): boolean {\n\t\treturn this.subscriptions > 0;\n\t}\n\n\tpublic cancelAll(): void {\n\t\tif (!this.isFiring) {\n\t\t\tthis.subscribeChannel.length = 0;\n\t\t\tthis.subscribeOnceChannel.length = 0;\n\t\t\tthis.onEmpty?.();\n\t\t} else {\n\t\t\tthis.onAfterFire.push(() => {\n\t\t\t\tthis.subscribeChannel.length = 0;\n\t\t\t\tthis.subscribeOnceChannel.length = 0;\n\t\t\t\tthis.onEmpty?.();\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate afterFire() {\n\t\tif (this.onAfterFire.length > 0) {\n\t\t\tthis.onAfterFire.forEach((cb) => cb());\n\t\t\tthis.onAfterFire.length = 0;\n\t\t}\n\t}\n\n\tpublic fire(data?: T): void {\n\t\tthis.isFiring = true;\n\n\t\tlet length = this.subscribeChannel.length;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\ttry {\n\t\t\t\tthis.subscribeChannel[i].callback(data);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\n\t\tif (this.subscribeOnceChannel.length > 0) {\n\t\t\tlength = this.subscribeOnceChannel.length;\n\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\ttry {\n\t\t\t\t\tthis.subscribeOnceChannel[i].callback(data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.subscribeOnceChannel.length = 0;\n\t\t}\n\n\t\tthis.isFiring = false;\n\t\tthis.afterFire();\n\t}\n\n\tprivate createSubscription(\n\t\tcallback: EventCallback<T>,\n\t\tchannel: EventSubscription<T>[],\n\t\tcancellationToken?: CancellationToken\n\t): { subscription: EventSubscription<T>; facade: EventSubscriptionFacade } {\n\t\tconst that: this = this;\n\n\t\tconst subscription: EventSubscription<T> = {\n\t\t\tcallback\n\t\t};\n\n\t\tconst facade: EventSubscriptionFacade = {\n\t\t\tcancel() {\n\t\t\t\tthat.cancel(subscription, channel);\n\t\t\t}\n\t\t};\n\n\t\tif (cancellationToken !== undefined) {\n\t\t\tcancellationToken.addCancelable(() => that.cancel(subscription, channel));\n\t\t}\n\t\tif (this.isFiring) {\n\t\t\tthis.onAfterFire.push(() => channel.push(subscription));\n\t\t} else {\n\t\t\tchannel.push(subscription);\n\t\t}\n\n\t\treturn { subscription, facade };\n\t}\n\n\tprivate cancel(subscription: EventSubscription<T>, channel: EventSubscription<T>[]): void {\n\t\tlet index: number = channel.indexOf(subscription);\n\t\tif (index >= 0) {\n\t\t\tif (!this.isFiring) {\n\t\t\t\tchannel.splice(index, 1);\n\t\t\t\tif (!this.hasSubscriptions()) {\n\t\t\t\t\tthis.onEmpty?.();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.onAfterFire.push(() => this.cancel(subscription, channel));\n\t\t\t}\n\t\t}\n\t}\n}\n","import { DataSource } from './stream/data_source';\nimport { EventEmitter } from './utilities/event_emitter';\n\nexport let debugMode: boolean = false;\n\ndeclare global {\n\tinterface Window {\n\t\t__debugUpdates: EventEmitter<{\n\t\t\tsource: SerializedStreamData;\n\t\t\tnewValue: any;\n\t\t\tstack: string;\n\t\t}>;\n\t\t__debugNewSource: EventEmitter<{\n\t\t\tsource: SerializedStreamData;\n\t\t}>;\n\t\t__debugLinked: EventEmitter<{\n\t\t\tparent: SerializedStreamData;\n\t\t\tchild: SerializedStreamData;\n\t\t}>;\n\t\t__debugUnlinked: EventEmitter<{\n\t\t\tparent: SerializedStreamData;\n\t\t\tchild: SerializedStreamData;\n\t\t}>;\n\t\t__debugGetStreamData: () => SerializedStreamData[];\n\t}\n}\n\nlet debugStreamData;\n\n/**\n * Initializes the debug features of aurum. Required for the use of aurum devtools\n * Run this function before creating any streams or any aurum components for best results\n * Enabling this harms performance and breaks backwards compatibility with some browsers\n * Do not enable in production\n */\nexport function enableDebugMode(): void {\n\tdebugStreamData = [];\n\tdebugMode = true;\n\tsetInterval(() => garbageCollect(), 60000);\n\twindow.__debugUpdates = new EventEmitter();\n\twindow.__debugNewSource = new EventEmitter();\n\twindow.__debugLinked = new EventEmitter();\n\twindow.__debugUnlinked = new EventEmitter();\n\twindow.__debugGetStreamData = () => debugStreamData.map(serializeStreamData);\n}\n\nfunction serializeStreamData(ref: StreamData): SerializedStreamData {\n\tlet serializedValue: string;\n\n\ttry {\n\t\tserializedValue = JSON.stringify(ref.value);\n\t} catch (e) {\n\t\tserializedValue = '[Unserializable]';\n\t}\n\n\treturn {\n\t\tname: ref.name,\n\t\tvalue: serializedValue,\n\t\tchildren: ref.children,\n\t\tconsumers: ref.consumers,\n\t\tid: ref.id,\n\t\tparents: ref.parents,\n\t\tstack: ref.stack,\n\t\ttimestamp: ref.timestamp\n\t};\n}\n\nexport function debugRegisterStream(stream: DataSource<any>, stack: string) {\n\tconst ref: StreamData = {\n\t\tname: stream.name,\n\t\tvalue: stream.value,\n\t\tid: Math.random(),\n\t\tchildren: [],\n\t\tparents: [],\n\t\tstack,\n\t\ttimestamp: Date.now(),\n\t\treference: new WeakRef(stream),\n\t\tconsumers: []\n\t};\n\tdebugStreamData.push(ref);\n\twindow.__debugNewSource.fire({\n\t\tsource: serializeStreamData(ref)\n\t});\n}\n\nexport function debugRegisterLink(parent: DataSource<any>, child: DataSource<any>) {\n\tlet pref = findDataByRef(parent);\n\tlet cref = findDataByRef(child);\n\n\tif (!pref) {\n\t\tthrow new Error('illegal state');\n\t}\n\tif (!cref) {\n\t\tthrow new Error('illegal state');\n\t}\n\n\tpref.children.push(cref.id);\n\tcref.parents.push(pref.id);\n\twindow.__debugLinked.fire({\n\t\tchild: serializeStreamData(cref),\n\t\tparent: serializeStreamData(pref)\n\t});\n}\n\nexport function debugRegisterUnlink(parent: DataSource<any>, child: DataSource<any>) {\n\tlet pref = findDataByRef(parent);\n\tlet cref = findDataByRef(child);\n\n\tif (!pref) {\n\t\tthrow new Error('illegal state');\n\t}\n\tif (!cref) {\n\t\tthrow new Error('illegal state');\n\t}\n\n\tconst cindex = pref.children.indexOf(cref.id);\n\tif (cindex === -1) {\n\t\tthrow new Error('illegal state');\n\t}\n\tpref.children.splice(cindex, 1);\n\n\tconst pindex = cref.parents.indexOf(pref.id);\n\tif (pindex === -1) {\n\t\tthrow new Error('illegal state');\n\t}\n\tcref.parents.splice(cindex, 1);\n\n\twindow.__debugUnlinked.fire({\n\t\tchild: serializeStreamData(cref),\n\t\tparent: serializeStreamData(pref)\n\t});\n}\n\nexport function debugDeclareUpdate(source: DataSource<any>, value: any, stack: string): void {\n\tlet ref = findDataByRef(source);\n\tif (!ref) {\n\t\tthrow new Error('illegal state');\n\t}\n\n\tref.value = source.value;\n\twindow.__debugUpdates.fire({\n\t\tnewValue: value,\n\t\tsource: serializeStreamData(ref),\n\t\tstack\n\t});\n}\n\nexport function debugRegisterConsumer(stream: DataSource<any>, consumer: string, consumerStack: string) {\n\tlet ref = findDataByRef(stream);\n\n\tif (!ref) {\n\t\tthrow new Error('illegal state');\n\t}\n\n\tref.consumers.push({\n\t\tcode: consumer,\n\t\tstack: consumerStack\n\t});\n}\n\nfunction garbageCollect(): void {\n\tdebugStreamData = debugStreamData.filter((dsd) => dsd.reference.deref() !== undefined);\n}\n\nfunction findDataByRef(target: DataSource<any>): StreamData {\n\treturn debugStreamData.find((dsd) => dsd.reference.deref() === target);\n}\n\nexport type SerializedStreamData = Omit<StreamData, 'reference'>;\nexport interface StreamData {\n\tname: string;\n\tid: number;\n\tvalue: any;\n\treference: WeakRef<DataSource<any>>;\n\tparents: number[];\n\tstack: string;\n\ttimestamp: number;\n\tchildren: number[];\n\tconsumers: {\n\t\tcode: string;\n\t\tstack: string;\n\t}[];\n}\n\ndeclare class WeakRef<T> {\n\tconstructor(item: T);\n\tpublic deref(): T | undefined;\n}\n","import { DataSourceOperator } from './operator_model';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { Callback } from '../utilities/common';\nimport { DataSource, processTransform, ReadOnlyDataSource } from './data_source';\n\n/**\n * Lets you logically combine 2 data sources so that update calls go through the input source and listen goes to the output source\n */\nexport class Stream<I, O = I> implements ReadOnlyDataSource<O> {\n\tprivate input: DataSource<I>;\n\tprivate output: DataSource<O>;\n\tpublic get name(): string {\n\t\treturn `IN:${this.input.name} OUT:${this.output.name}`;\n\t}\n\t/**\n\t * The current value of this data source, can be changed through update\n\t */\n\tpublic get value(): O {\n\t\treturn this.output.value;\n\t}\n\n\tprivate constructor() {}\n\n\tpublic static fromFetchRaw(url: string): Stream<void | RequestInit, Promise<Response>> {\n\t\tconst input = new DataSource<void | RequestInit>();\n\t\tconst output = new DataSource<Promise<Response>>();\n\n\t\tinput.listen((value) => {\n\t\t\toutput.update(fetch(url, value as RequestInit));\n\t\t});\n\n\t\treturn Stream.fromPreconnectedSources(input, output);\n\t}\n\n\tpublic static fromPreconnectedSources<I, O>(inputSource?: DataSource<I>, outputSource?: DataSource<O>): Stream<I, O> {\n\t\tconst result = new Stream<I, O>();\n\t\tresult.input = inputSource ?? new DataSource();\n\t\tresult.output = outputSource ?? (result.input as any);\n\n\t\treturn result;\n\t}\n\n\tpublic static fromStreamTransformation<I, O>(callback: (data: DataSource<I>) => DataSource<O>): Stream<I, O> {\n\t\tconst result = new Stream<I, O>();\n\n\t\tresult.input = new DataSource<I>();\n\t\tresult.output = callback(result.input);\n\n\t\treturn result;\n\t}\n\n\tpublic static fromFetchPostJson<I, O>(url: string, baseRequestData?: RequestInit): Stream<I, O> {\n\t\tconst input = new DataSource<I>();\n\t\tconst output = new DataSource<O>();\n\n\t\tinput.listen(async (value) => {\n\t\t\toutput.update(\n\t\t\t\tawait fetch(\n\t\t\t\t\turl,\n\t\t\t\t\tObject.assign(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} as RequestInit,\n\t\t\t\t\t\tbaseRequestData,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbody: JSON.stringify(value)\n\t\t\t\t\t\t} as RequestInit\n\t\t\t\t\t)\n\t\t\t\t).then((s) => s.json())\n\t\t\t);\n\t\t});\n\n\t\treturn Stream.fromPreconnectedSources(input, output);\n\t}\n\n\tpublic static fromFetchGetJson<O>(url: string, baseRequestData?: RequestInit): Stream<void, O> {\n\t\tconst input = new DataSource<void>();\n\t\tconst output = new DataSource<O>();\n\n\t\tinput.listen(async () => {\n\t\t\toutput.update(await fetch(url).then((s) => s.json()));\n\t\t});\n\n\t\treturn Stream.fromPreconnectedSources(input, output);\n\t}\n\n\tpublic update(data: I): void {\n\t\tthis.input.update(data);\n\t}\n\n\tpublic transform<A, B = A, C = B, D = C, E = D, F = E, G = F, H = G, Z = H, J = Z, K = J>(\n\t\toperationA: DataSourceOperator<O, A>,\n\t\toperationB?: DataSourceOperator<A, B> | CancellationToken,\n\t\toperationC?: DataSourceOperator<B, C> | CancellationToken,\n\t\toperationD?: DataSourceOperator<C, D> | CancellationToken,\n\t\toperationE?: DataSourceOperator<D, E> | CancellationToken,\n\t\toperationF?: DataSourceOperator<E, F> | CancellationToken,\n\t\toperationG?: DataSourceOperator<F, G> | CancellationToken,\n\t\toperationH?: DataSourceOperator<G, H> | CancellationToken,\n\t\toperationI?: DataSourceOperator<H, Z> | CancellationToken,\n\t\toperationJ?: DataSourceOperator<Z, J> | CancellationToken,\n\t\toperationK?: DataSourceOperator<J, K> | CancellationToken,\n\t\tcancellationToken?: CancellationToken\n\t): Stream<I, K> {\n\t\tlet token;\n\t\tconst operations: DataSourceOperator<any, any>[] = [\n\t\t\toperationA,\n\t\t\toperationB,\n\t\t\toperationC,\n\t\t\toperationD,\n\t\t\toperationE,\n\t\t\toperationF,\n\t\t\toperationG,\n\t\t\toperationH,\n\t\t\toperationI,\n\t\t\toperationJ,\n\t\t\toperationK\n\t\t].filter((e) => e && (e instanceof CancellationToken ? ((token = e), false) : true)) as DataSourceOperator<any, any>[];\n\t\tif (cancellationToken) {\n\t\t\ttoken = cancellationToken;\n\t\t}\n\t\tconst result = new DataSource<K>(undefined, this.output.name + ' ' + operations.map((v) => v.name).join(' '));\n\t\tthis.listen(processTransform<O, K>(operations as any, result), token);\n\n\t\treturn Stream.fromPreconnectedSources(this.input, result);\n\t}\n\n\tpublic getOutput(): DataSource<O> {\n\t\treturn this.output;\n\t}\n\n\tpublic listen(callback: Callback<O>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.output.listen(callback, cancellationToken);\n\t}\n\n\tpublic listenAndRepeat(callback: Callback<O>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.output.listenAndRepeat(callback, cancellationToken);\n\t}\n\n\tpublic listenOnce(callback: Callback<O>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.output.listenOnce(callback, cancellationToken);\n\t}\n\n\tpublic awaitNextUpdate(cancellationToken?: CancellationToken): Promise<O> {\n\t\treturn this.output.awaitNextUpdate(cancellationToken);\n\t}\n\n\tpublic cancelAll(): void {\n\t\tthis.input.cancelAll();\n\t\tthis.output.cancelAll();\n\t}\n}\n","import { debugDeclareUpdate, debugMode, debugRegisterConsumer, debugRegisterLink, debugRegisterStream } from '../debug_mode';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { Callback, Predicate } from '../utilities/common';\nimport { EventEmitter } from '../utilities/event_emitter';\nimport { DuplexDataSource } from './duplex_data_source';\nimport {\n\tDataSourceDelayFilterOperator,\n\tDataSourceFilterOperator,\n\tDataSourceMapDelayFilterOperator,\n\tDataSourceMapOperator,\n\tDataSourceOperator,\n\tOperationType\n} from './operator_model';\nimport { Stream } from './stream';\n\nexport interface ReadOnlyDataSource<T> {\n\treadonly value: T;\n\treadonly name: string;\n\tlistenAndRepeat(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void>;\n\tlisten(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void>;\n\tlistenOnce(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void>;\n\tawaitNextUpdate(cancellationToken?: CancellationToken): Promise<T>;\n\ttransform<A, B = A, C = B, D = C, E = D, F = E, G = F, H = G, I = H, J = I, K = J>(\n\t\toperationA: DataSourceOperator<T, A>,\n\t\toperationB?: DataSourceOperator<A, B> | CancellationToken,\n\t\toperationC?: DataSourceOperator<B, C> | CancellationToken,\n\t\toperationD?: DataSourceOperator<C, D> | CancellationToken,\n\t\toperationE?: DataSourceOperator<D, E> | CancellationToken,\n\t\toperationF?: DataSourceOperator<E, F> | CancellationToken,\n\t\toperationG?: DataSourceOperator<F, G> | CancellationToken,\n\t\toperationH?: DataSourceOperator<G, H> | CancellationToken,\n\t\toperationI?: DataSourceOperator<H, I> | CancellationToken,\n\t\toperationJ?: DataSourceOperator<I, J> | CancellationToken,\n\t\toperationK?: DataSourceOperator<J, K> | CancellationToken,\n\t\tcancellationToken?: CancellationToken\n\t): ReadOnlyDataSource<K>;\n}\n\nexport interface GenericDataSource<T> {\n\treadonly value: T;\n\tlistenAndRepeat(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void>;\n\tlisten(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void>;\n\tlistenOnce(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void>;\n\tawaitNextUpdate(cancellationToken?: CancellationToken): Promise<T>;\n\twithInitial(value: T): this;\n\taggregate<D, E>(otherSource: ReadOnlyDataSource<D>, combinator: (self: T, other: D) => E, cancellationToken?: CancellationToken): GenericDataSource<E>;\n\taggregateThree<D, E, F>(\n\t\tsecond: ReadOnlyDataSource<D>,\n\t\tthird: ReadOnlyDataSource<E>,\n\t\tcombinator: (self: T, second: D, third: E) => F,\n\t\tcancellationToken?: CancellationToken\n\t): GenericDataSource<F>;\n\taggregateFour<D, E, F, G>(\n\t\tsecond: ReadOnlyDataSource<D>,\n\t\tthird: ReadOnlyDataSource<E>,\n\t\tfourth: ReadOnlyDataSource<F>,\n\t\tcombinator: (self: T, second: D, third: E, fourth: F) => G,\n\t\tcancellationToken?: CancellationToken\n\t): GenericDataSource<G>;\n\ttransform<A, B = A, C = B, D = C, E = D, F = E, G = F, H = G, I = H, J = I, K = J>(\n\t\toperationA: DataSourceOperator<T, A>,\n\t\toperationB?: DataSourceOperator<A, B> | CancellationToken,\n\t\toperationC?: DataSourceOperator<B, C> | CancellationToken,\n\t\toperationD?: DataSourceOperator<C, D> | CancellationToken,\n\t\toperationE?: DataSourceOperator<D, E> | CancellationToken,\n\t\toperationF?: DataSourceOperator<E, F> | CancellationToken,\n\t\toperationG?: DataSourceOperator<F, G> | CancellationToken,\n\t\toperationH?: DataSourceOperator<G, H> | CancellationToken,\n\t\toperationI?: DataSourceOperator<H, I> | CancellationToken,\n\t\toperationJ?: DataSourceOperator<I, J> | CancellationToken,\n\t\toperationK?: DataSourceOperator<J, K> | CancellationToken,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<K>;\n}\n\n/**\n * Datasources wrap a value and allow you to update it in an observable way. Datasources can be manipulated like streams and can be bound directly in the JSX syntax and will update the html whenever the value changes\n */\nexport class DataSource<T> implements GenericDataSource<T> {\n\t/**\n\t * The current value of this data source, can be changed through update\n\t */\n\tpublic value: T;\n\tprivate primed: boolean;\n\tprivate updating: boolean;\n\tpublic name: string;\n\tprotected updateEvent: EventEmitter<T>;\n\n\tconstructor(initialValue?: T, name: string = 'RootDataSource') {\n\t\tthis.name = name;\n\t\tthis.value = initialValue;\n\t\tif (debugMode) {\n\t\t\tdebugRegisterStream(this, new Error().stack);\n\t\t}\n\t\tthis.primed = initialValue !== undefined;\n\t\tthis.updateEvent = new EventEmitter();\n\t}\n\n\tpublic static fromMultipleSources<T>(sources: ReadOnlyDataSource<T>[], cancellation?: CancellationToken): DataSource<T> {\n\t\tconst result = new DataSource<T>();\n\n\t\tfor (const s of sources) {\n\t\t\tif (debugMode) {\n\t\t\t\tdebugRegisterLink(s as any, result);\n\t\t\t}\n\t\t\t(s as any).listenInternal((v) => result.update(v), cancellation);\n\t\t}\n\n\t\tresult.name = `Combination of [${sources.map((v) => v.name).join(' & ')}]`;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Updates with the same value as the last value\n\t */\n\tpublic repeatLast(): this {\n\t\tthis.update(this.value);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Updates the value in the data source and calls the listen callback for all listeners\n\t * @param newValue new value for the data source\n\t */\n\tpublic update(newValue: T): void {\n\t\tthis.primed = true;\n\t\tif (this.updating) {\n\t\t\tthrow new Error(\n\t\t\t\t'Problem in data source: Unstable value propagation. When updating a value the stream was updated back as a direct response. This can lead to infinite loops and is therefore not allowed'\n\t\t\t);\n\t\t}\n\t\tthis.updating = true;\n\t\tthis.value = newValue;\n\t\tthis.updateEvent.fire(newValue);\n\t\tif (debugMode) {\n\t\t\tdebugDeclareUpdate(this, newValue, new Error().stack);\n\t\t}\n\t\tthis.updating = false;\n\t}\n\n\t/**\n\t * Updates the data source with a value if it has never had a value before\n\t */\n\tpublic withInitial(value: T): this {\n\t\tif (!this.primed) {\n\t\t\tthis.update(value);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Same as listen but will immediately call the callback with the current value first\n\t * @param callback Callback to call when value is updated\n\t * @param cancellationToken Optional token to control the cancellation of the subscription\n\t * @returns Cancellation callback, can be used to cancel subscription without a cancellation token\n\t */\n\tpublic listenAndRepeat(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tcallback(this.value);\n\t\treturn this.listen(callback, cancellationToken);\n\t}\n\n\tprivate listenAndRepeatInternal(callback: Callback<T>, cancellationToken?: CancellationToken, parent?: ReadOnlyDataSource<any>): Callback<void> {\n\t\tcallback(this.value);\n\t\treturn this.listenInternal(callback, cancellationToken, parent);\n\t}\n\n\t/**\n\t * Subscribes to the updates of the data stream\n\t * @param callback Callback to call when value is updated\n\t * @param cancellationToken Optional token to control the cancellation of the subscription\n\t * @returns Cancellation callback, can be used to cancel subscription without a cancellation token\n\t */\n\tpublic listen(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tif (debugMode) {\n\t\t\tdebugRegisterConsumer(this, callback.toString(), new Error().stack);\n\t\t}\n\t\treturn this.listenInternal(callback, cancellationToken);\n\t}\n\n\tprivate listenInternal(callback: Callback<T>, cancellationToken?: CancellationToken, parent?: ReadOnlyDataSource<any>): Callback<void> {\n\t\tconst cancel = this.updateEvent.subscribe(callback, cancellationToken).cancel;\n\n\t\treturn cancel;\n\t}\n\n\t/**\n\t * Subscribes to the updates of the data stream for a single update\n\t * @param callback Callback to call when value is updated\n\t * @param cancellationToken Optional token to control the cancellation of the subscription\n\t * @returns Cancellation callback, can be used to cancel subscription without a cancellation token\n\t */\n\tpublic listenOnce(callback: Callback<T>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateEvent.subscribeOnce(callback, cancellationToken).cancel;\n\t}\n\n\tpublic transform<A, B = A, C = B, D = C, E = D, F = E, G = F, H = G, I = H, J = I, K = J>(\n\t\toperationA: DataSourceOperator<T, A>,\n\t\toperationB?: DataSourceOperator<A, B> | CancellationToken,\n\t\toperationC?: DataSourceOperator<B, C> | CancellationToken,\n\t\toperationD?: DataSourceOperator<C, D> | CancellationToken,\n\t\toperationE?: DataSourceOperator<D, E> | CancellationToken,\n\t\toperationF?: DataSourceOperator<E, F> | CancellationToken,\n\t\toperationG?: DataSourceOperator<F, G> | CancellationToken,\n\t\toperationH?: DataSourceOperator<G, H> | CancellationToken,\n\t\toperationI?: DataSourceOperator<H, I> | CancellationToken,\n\t\toperationJ?: DataSourceOperator<I, J> | CancellationToken,\n\t\toperationK?: DataSourceOperator<J, K> | CancellationToken,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<K> {\n\t\tlet token;\n\t\tconst operations: DataSourceOperator<any, any>[] = [\n\t\t\toperationA,\n\t\t\toperationB,\n\t\t\toperationC,\n\t\t\toperationD,\n\t\t\toperationE,\n\t\t\toperationF,\n\t\t\toperationG,\n\t\t\toperationH,\n\t\t\toperationI,\n\t\t\toperationJ,\n\t\t\toperationK\n\t\t].filter((e) => e && (e instanceof CancellationToken ? ((token = e), false) : true)) as DataSourceOperator<any, any>[];\n\t\tif (cancellationToken) {\n\t\t\ttoken = cancellationToken;\n\t\t}\n\t\tconst result = new DataSource<K>(undefined, this.name + ' ' + operations.map((v) => v.name).join(' '));\n\t\tif (debugMode) {\n\t\t\tdebugRegisterLink(this, result);\n\t\t}\n\t\t(this.primed ? this.listenAndRepeatInternal : this.listenInternal).call(this, processTransform<T, K>(operations as any, result), token);\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Combines two sources into a third source that listens to updates from both parent sources.\n\t * @param otherSource Second parent for the new source\n\t * @param combinator Method allowing you to combine the data from both parents on update. Called each time a parent is updated with the latest values of both parents\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the two parent datasources\n\t */\n\tpublic aggregate<D, E>(otherSource: ReadOnlyDataSource<D>, combinator: (self: T, other: D) => E, cancellationToken?: CancellationToken): DataSource<E> {\n\t\tcancellationToken = cancellationToken ?? new CancellationToken();\n\t\tconst aggregatedSource = new DataSource<E>(combinator(this.value, otherSource.value));\n\n\t\tthis.listen(() => aggregatedSource.update(combinator(this.value, otherSource.value)), cancellationToken);\n\t\totherSource.listen(() => aggregatedSource.update(combinator(this.value, otherSource.value)), cancellationToken);\n\n\t\treturn aggregatedSource;\n\t}\n\n\t/**\n\t * Combines three sources into a fourth source that listens to updates from all parent sources.\n\t * @param second Second parent for the new source\n\t * @param third Third parent for the new source\n\t * @param combinator Method allowing you to combine the data from all parents on update. Called each time a parent is updated with the latest values of all parents\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the parent datasources\n\t */\n\tpublic aggregateThree<D, E, F>(\n\t\tsecond: ReadOnlyDataSource<D>,\n\t\tthird: ReadOnlyDataSource<E>,\n\t\tcombinator: (self: T, second: D, third: E) => F,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<F> {\n\t\tcancellationToken = cancellationToken ?? new CancellationToken();\n\t\tconst aggregatedSource = new DataSource<F>(combinator(this.value, second.value, third.value));\n\n\t\tthis.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value)), cancellationToken);\n\t\tsecond.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value)), cancellationToken);\n\t\tthird.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value)), cancellationToken);\n\n\t\treturn aggregatedSource;\n\t}\n\n\t/**\n\t * Combines four sources into a fifth source that listens to updates from all parent sources.\n\t * @param second Second parent for the new source\n\t * @param third Third parent for the new source\n\t * @param fourth Fourth parent for the new source\n\t * @param combinator Method allowing you to combine the data from all parents on update. Called each time a parent is updated with the latest values of all parents\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the parent datasources\n\t */\n\tpublic aggregateFour<D, E, F, G>(\n\t\tsecond: ReadOnlyDataSource<D>,\n\t\tthird: ReadOnlyDataSource<E>,\n\t\tfourth: ReadOnlyDataSource<F>,\n\t\tcombinator: (self: T, second: D, third: E, fourth: F) => G,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<G> {\n\t\tcancellationToken = cancellationToken ?? new CancellationToken();\n\t\tconst aggregatedSource = new DataSource<G>(combinator(this.value, second.value, third.value, fourth.value));\n\n\t\tthis.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value)), cancellationToken);\n\t\tsecond.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value)), cancellationToken);\n\t\tthird.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value)), cancellationToken);\n\t\tfourth.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value)), cancellationToken);\n\n\t\treturn aggregatedSource;\n\t}\n\n\t/**\n\t * Combines four sources into a fifth source that listens to updates from all parent sources.\n\t * @param second Second parent for the new source\n\t * @param third Third parent for the new source\n\t * @param fourth Fourth parent for the new source\n\t * @param fifth Fifth  parent for the new source\n\t * @param combinator Method allowing you to combine the data from all parents on update. Called each time a parent is updated with the latest values of all parents\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the parent datasources\n\t */\n\tpublic aggregateFive<D, E, F, G, H>(\n\t\tsecond: ReadOnlyDataSource<D>,\n\t\tthird: ReadOnlyDataSource<E>,\n\t\tfourth: ReadOnlyDataSource<F>,\n\t\tfifth: ReadOnlyDataSource<G>,\n\t\tcombinator: (self: T, second: D, third: E, fourth: F, fifth: G) => H,\n\t\tcancellationToken?: CancellationToken\n\t): DataSource<H> {\n\t\tcancellationToken = cancellationToken ?? new CancellationToken();\n\t\tconst aggregatedSource = new DataSource<H>(combinator(this.value, second.value, third.value, fourth.value, fifth.value));\n\n\t\tthis.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value, fifth.value)), cancellationToken);\n\t\tsecond.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value, fifth.value)), cancellationToken);\n\t\tthird.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value, fifth.value)), cancellationToken);\n\t\tfourth.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value, fifth.value)), cancellationToken);\n\t\tfifth.listen(() => aggregatedSource.update(combinator(this.value, second.value, third.value, fourth.value, fifth.value)), cancellationToken);\n\n\t\treturn aggregatedSource;\n\t}\n\n\t/**\n\t * Forwards all updates from this source to another\n\t * @param targetDataSource datasource to pipe the updates to\n\t * @param cancellationToken  Cancellation token to cancel the subscription the target datasource has to this datasource\n\t */\n\tpublic pipe(targetDataSource: DataSource<T>, cancellationToken?: CancellationToken): this {\n\t\tthis.listen((v) => targetDataSource.update(v), cancellationToken);\n\n\t\treturn this;\n\t}\n\t/**\n\t * Like aggregate except that no combination method is needed as a result both parents must have the same type and the new stream just exposes the last update recieved from either parent\n\t * @param otherSource Second parent for the new source\n\t * @param cancellationToken  Cancellation token to cancel the subscriptions the new datasource has to the two parent datasources\n\t */\n\tpublic combine(otherSources: DataSource<T>[], cancellationToken?: CancellationToken): DataSource<T> {\n\t\tcancellationToken = cancellationToken ?? new CancellationToken();\n\n\t\tlet combinedDataSource: DataSource<T> | DuplexDataSource<T> | Stream<T, any>;\n\t\tif (this.primed) {\n\t\t\tcombinedDataSource = new DataSource<T>(this.value);\n\t\t} else {\n\t\t\tcombinedDataSource = new DataSource<T>();\n\t\t}\n\t\tthis.pipe(combinedDataSource, cancellationToken);\n\t\tfor (const otherSource of otherSources) {\n\t\t\totherSource.pipe(combinedDataSource, cancellationToken);\n\t\t}\n\n\t\treturn combinedDataSource;\n\t}\n\n\t/**\n\t * Returns a promise that resolves when the next update occurs\n\t * @param cancellationToken\n\t */\n\tpublic awaitNextUpdate(cancellationToken?: CancellationToken): Promise<T> {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.listenOnce((value) => resolve(value), cancellationToken);\n\t\t});\n\t}\n\n\t/**\n\t * Remove all listeners\n\t */\n\tpublic cancelAll(): void {\n\t\tthis.updateEvent.cancelAll();\n\t}\n}\n\nexport interface CollectionChange<T> {\n\toperation: 'replace' | 'swap' | 'add' | 'remove' | 'merge';\n\toperationDetailed: 'replace' | 'append' | 'prepend' | 'removeRight' | 'removeLeft' | 'remove' | 'swap' | 'clear' | 'merge' | 'insert';\n\tcount?: number;\n\tindex: number;\n\tindex2?: number;\n\ttarget?: T;\n\titems: T[];\n\tnewState: T[];\n\tpreviousState?: T[];\n}\nexport class ArrayDataSource<T> {\n\tprotected data: T[];\n\tprotected updateEvent: EventEmitter<CollectionChange<T>>;\n\tprivate lengthSource: DataSource<number>;\n\tprivate name: string;\n\n\tconstructor(initialData?: T[], name: string = 'RootArrayDataSource') {\n\t\tthis.name = name;\n\t\tif (initialData) {\n\t\t\tthis.data = initialData.slice();\n\t\t} else {\n\t\t\tthis.data = [];\n\t\t}\n\t\tthis.lengthSource = new DataSource(this.data.length, this.name + '.length');\n\t\tthis.updateEvent = new EventEmitter();\n\t}\n\n\tpublic static fromMultipleSources<T>(sources: Array<ArrayDataSource<T> | T[]>, cancellationToken?: CancellationToken): ArrayDataSource<T> {\n\t\tconst boundaries = [0];\n\t\tconst result = new ArrayDataSource<T>(\n\t\t\tundefined,\n\t\t\t`ArrayDataSource of (${sources.reduce((p, c) => p + (c instanceof ArrayDataSource ? c.name + ' ' : ''), '')})`\n\t\t);\n\n\t\tfor (let i = 0; i < sources.length; i++) {\n\t\t\tif (Array.isArray(sources[i])) {\n\t\t\t\tresult.appendArray(sources[i] as T[]);\n\t\t\t} else {\n\t\t\t\tresult.appendArray((sources[i] as ArrayDataSource<T>).data ?? []);\n\t\t\t\tlet index = i;\n\t\t\t\t(sources[i] as ArrayDataSource<T>).listen((change) => {\n\t\t\t\t\tswitch (change.operationDetailed) {\n\t\t\t\t\t\tcase 'append':\n\t\t\t\t\t\tcase 'prepend':\n\t\t\t\t\t\tcase 'insert':\n\t\t\t\t\t\t\tresult.insertAt(change.index + boundaries[index], ...change.items);\n\t\t\t\t\t\t\tfor (let i = index + 1; i < boundaries.length; i++) {\n\t\t\t\t\t\t\t\tboundaries[i] += change.count;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'remove':\n\t\t\t\t\t\tcase 'removeLeft':\n\t\t\t\t\t\tcase 'removeRight':\n\t\t\t\t\t\tcase 'clear':\n\t\t\t\t\t\t\tresult.removeRange(change.index + boundaries[index], change.index + boundaries[index] + change.count);\n\t\t\t\t\t\t\tfor (let i = index + 1; i < boundaries.length; i++) {\n\t\t\t\t\t\t\t\tboundaries[i] -= change.count;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'merge':\n\t\t\t\t\t\t\tthrow new Error('Not yet supported');\n\t\t\t\t\t\tcase 'replace':\n\t\t\t\t\t\t\tresult.set(change.index + boundaries[index], change.items[0]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'swap':\n\t\t\t\t\t\t\tresult.swap(change.index + boundaries[index], change.index2 + boundaries[index]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}, cancellationToken);\n\t\t\t}\n\t\t\tboundaries.push(result.length.value);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Same as listen but will immediately call the callback with an append of all existing elements first\n\t */\n\tpublic listenAndRepeat(callback: Callback<CollectionChange<T>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tcallback({\n\t\t\toperation: 'add',\n\t\t\toperationDetailed: 'append',\n\t\t\tindex: 0,\n\t\t\titems: this.data,\n\t\t\tnewState: this.data,\n\t\t\tcount: this.data.length\n\t\t});\n\t\treturn this.listen(callback, cancellationToken);\n\t}\n\n\tpublic repeatCurrentState(): void {\n\t\tthis.update({\n\t\t\toperation: 'remove',\n\t\t\toperationDetailed: 'clear',\n\t\t\tcount: this.data.length,\n\t\t\tindex: 0,\n\t\t\titems: this.data,\n\t\t\tnewState: []\n\t\t});\n\t\tthis.update({\n\t\t\toperation: 'add',\n\t\t\toperationDetailed: 'append',\n\t\t\tindex: 0,\n\t\t\titems: this.data,\n\t\t\tnewState: this.data,\n\t\t\tcount: this.data.length\n\t\t});\n\t}\n\n\tpublic listen(callback: Callback<CollectionChange<T>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateEvent.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\tpublic listenOnce(callback: Callback<CollectionChange<T>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateEvent.subscribeOnce(callback, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Returns a promise that resolves when the next update occurs\n\t * @param cancellationToken\n\t */\n\tpublic awaitNextUpdate(cancellationToken?: CancellationToken): Promise<CollectionChange<T>> {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.listenOnce((value) => resolve(value), cancellationToken);\n\t\t});\n\t}\n\n\tpublic get length(): DataSource<number> {\n\t\treturn this.lengthSource;\n\t}\n\n\tpublic getData(): ReadonlyArray<T> {\n\t\treturn this.data;\n\t}\n\n\tpublic get(index: number): T {\n\t\treturn this.data[index];\n\t}\n\n\tpublic set(index: number, item: T): void {\n\t\tconst old = this.data[index];\n\t\tif (old === item) {\n\t\t\treturn;\n\t\t}\n\t\tthis.data[index] = item;\n\t\tthis.update({ operation: 'replace', operationDetailed: 'replace', target: old, count: 1, index, items: [item], newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic indexOf(item: T): number {\n\t\treturn this.data.indexOf(item);\n\t}\n\n\tpublic lastIndexOf(item: T): number {\n\t\treturn this.data.lastIndexOf(item);\n\t}\n\n\tpublic includes(item: T): boolean {\n\t\treturn this.data.includes(item);\n\t}\n\n\tpublic replace(item: T, newItem: T): void {\n\t\tconst index = this.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\tthis.set(index, newItem);\n\t\t}\n\t}\n\n\tpublic swap(indexA: number, indexB: number): void {\n\t\tif (indexA === indexB) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemA = this.data[indexA];\n\t\tconst itemB = this.data[indexB];\n\t\tthis.data[indexB] = itemA;\n\t\tthis.data[indexA] = itemB;\n\n\t\tthis.update({ operation: 'swap', operationDetailed: 'swap', index: indexA, index2: indexB, items: [itemA, itemB], newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic swapItems(itemA: T, itemB: T): void {\n\t\tif (itemA === itemB) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst indexA = this.data.indexOf(itemA);\n\t\tconst indexB = this.data.indexOf(itemB);\n\t\tif (indexA !== -1 && indexB !== -1) {\n\t\t\tthis.data[indexB] = itemA;\n\t\t\tthis.data[indexA] = itemB;\n\t\t}\n\n\t\tthis.update({ operation: 'swap', operationDetailed: 'swap', index: indexA, index2: indexB, items: [itemA, itemB], newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic appendArray(items: T[]) {\n\t\tif (items.length < 65000) {\n\t\t\tthis.data.push.apply(this.data, items);\n\t\t} else {\n\t\t\tconsole.warn('Appending over 65000 items in one go can lead to performance issues. Consider streaming your changes progressively');\n\t\t\tthis.data = this.data.concat(items);\n\t\t}\n\n\t\tthis.update({\n\t\t\toperation: 'add',\n\t\t\toperationDetailed: 'append',\n\t\t\tcount: items.length,\n\t\t\tindex: this.data.length - items.length,\n\t\t\titems,\n\t\t\tnewState: this.data\n\t\t});\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic insertAt(index: number, ...items: T[]) {\n\t\tif (items.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.data.splice(index, 0, ...items);\n\n\t\tthis.update({\n\t\t\toperation: 'add',\n\t\t\toperationDetailed: 'insert',\n\t\t\tcount: items.length,\n\t\t\tindex,\n\t\t\titems,\n\t\t\tnewState: this.data\n\t\t});\n\t\tthis.lengthSource.update(this.data.length);\n\t}\n\n\tpublic push(...items: T[]) {\n\t\tthis.appendArray(items);\n\t}\n\n\tpublic unshift(...items: T[]) {\n\t\tthis.data.unshift(...items);\n\t\tthis.update({ operation: 'add', operationDetailed: 'prepend', count: items.length, items, index: 0, newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic pop(): T {\n\t\tconst item = this.data.pop();\n\n\t\tthis.update({\n\t\t\toperation: 'remove',\n\t\t\toperationDetailed: 'removeRight',\n\t\t\tcount: 1,\n\t\t\tindex: this.data.length,\n\t\t\titems: [item],\n\t\t\tnewState: this.data\n\t\t});\n\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t\treturn item;\n\t}\n\n\tpublic merge(newData: T[]): void {\n\t\tconst old = this.data;\n\t\tthis.data = newData.slice();\n\n\t\tthis.update({\n\t\t\toperation: 'merge',\n\t\t\toperationDetailed: 'merge',\n\t\t\tpreviousState: old,\n\t\t\tindex: 0,\n\t\t\titems: this.data,\n\t\t\tnewState: this.data\n\t\t});\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic removeRight(count: number): void {\n\t\tconst length = this.data.length;\n\t\tconst result = this.data.splice(length - count, count);\n\t\tthis.update({ operation: 'remove', operationDetailed: 'removeRight', count, index: length - count, items: result, newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic removeLeft(count: number): void {\n\t\tconst result = this.data.splice(0, count);\n\t\tthis.update({ operation: 'remove', operationDetailed: 'removeLeft', count, index: 0, items: result, newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic removeAt(index: number): void {\n\t\tconst removed = this.data.splice(index, 1);\n\t\tthis.update({ operation: 'remove', operationDetailed: 'remove', count: removed.length, index, items: removed, newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic removeRange(start: number, end): void {\n\t\tconst removed = this.data.splice(start, end - start);\n\t\tthis.update({ operation: 'remove', operationDetailed: 'remove', count: removed.length, index: start, items: removed, newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic remove(item: T): void {\n\t\tconst index = this.data.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\tthis.removeAt(index);\n\t\t}\n\t}\n\n\tpublic clear(): void {\n\t\tif (this.data.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = this.data;\n\t\tthis.data = [];\n\t\tthis.update({\n\t\t\toperation: 'remove',\n\t\t\toperationDetailed: 'clear',\n\t\t\tcount: items.length,\n\t\t\tindex: 0,\n\t\t\titems,\n\t\t\tnewState: this.data\n\t\t});\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\t}\n\n\tpublic shift(): T {\n\t\tconst item = this.data.shift();\n\t\tthis.update({ operation: 'remove', operationDetailed: 'removeLeft', items: [item], count: 1, index: 0, newState: this.data });\n\t\tif (this.lengthSource.value !== this.data.length) {\n\t\t\tthis.lengthSource.update(this.data.length);\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tpublic toArray(): T[] {\n\t\treturn this.data.slice();\n\t}\n\n\tpublic reverse(cancellationToken?: CancellationToken): ReversedArrayView<T> {\n\t\tconst view = new ReversedArrayView<T>(this, cancellationToken, this.name + '.reverse()');\n\n\t\treturn view;\n\t}\n\n\tpublic sort(comparator: (a: T, b: T) => number, dependencies: ReadOnlyDataSource<any>[] = [], cancellationToken?: CancellationToken): SortedArrayView<T> {\n\t\tconst view = new SortedArrayView(this, comparator, cancellationToken, this.name + '.sort()');\n\n\t\tdependencies.forEach((dep) => {\n\t\t\tdep.listen(() => view.refresh());\n\t\t}, cancellationToken);\n\n\t\treturn view;\n\t}\n\n\tpublic map<D>(mapper: (data: T) => D, dependencies: ReadOnlyDataSource<any>[] = [], cancellationToken?: CancellationToken): MappedArrayView<T, D> {\n\t\tconst view = new MappedArrayView<T, D>(this, mapper, cancellationToken, this.name + '.map()');\n\n\t\tdependencies.forEach((dep) => {\n\t\t\tdep.listen(() => view.refresh());\n\t\t}, cancellationToken);\n\n\t\treturn view;\n\t}\n\n\tpublic unique(cancellationToken?: CancellationToken): UniqueArrayView<T> {\n\t\treturn new UniqueArrayView(this, cancellationToken, this.name + '.unique()');\n\t}\n\n\tpublic filter(callback: Predicate<T>, dependencies: ReadOnlyDataSource<any>[] = [], cancellationToken?: CancellationToken): FilteredArrayView<T> {\n\t\tconst view = new FilteredArrayView(this, callback, cancellationToken, this.name + '.filter()');\n\n\t\tdependencies.forEach((dep) => {\n\t\t\tdep.listen(() => view.refresh(), cancellationToken);\n\t\t});\n\n\t\treturn view;\n\t}\n\n\tpublic forEach(callbackfn: (value: T, index: number, array: T[]) => void): void {\n\t\treturn this.data.forEach(callbackfn);\n\t}\n\n\tprotected update(change: CollectionChange<T>) {\n\t\tthis.updateEvent.fire(change);\n\t}\n}\n\nexport class MappedArrayView<D, T> extends ArrayDataSource<T> {\n\tprivate parent: ArrayDataSource<D>;\n\tprivate mapper: (a: D) => T;\n\n\tconstructor(parent: ArrayDataSource<D>, mapper: (a: D) => T, cancellationToken: CancellationToken = new CancellationToken(), name?: string) {\n\t\tconst initial = parent.getData().map(mapper);\n\t\tsuper(initial, name);\n\t\tthis.parent = parent;\n\t\tthis.mapper = mapper;\n\n\t\tparent.listen((change) => {\n\t\t\tswitch (change.operationDetailed) {\n\t\t\t\tcase 'removeLeft':\n\t\t\t\t\tthis.removeLeft(change.count);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'removeRight':\n\t\t\t\t\tthis.removeRight(change.count);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'remove':\n\t\t\t\t\tthis.remove(this.data[change.index]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'clear':\n\t\t\t\t\tthis.clear();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'prepend':\n\t\t\t\t\tthis.unshift(...change.items.map(this.mapper));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'append':\n\t\t\t\t\tthis.appendArray(change.items.map(this.mapper));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'insert':\n\t\t\t\t\tthis.insertAt(change.index, ...change.items.map(this.mapper));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swap':\n\t\t\t\t\tthis.swap(change.index, change.index2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'replace':\n\t\t\t\t\tthis.set(change.index, this.mapper(change.items[0]));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'merge':\n\t\t\t\t\tconst old = this.data.slice();\n\t\t\t\t\tconst source = change.previousState.slice();\n\t\t\t\t\tfor (let i = 0; i < change.newState.length; i++) {\n\t\t\t\t\t\tif (this.data.length <= i) {\n\t\t\t\t\t\t\tthis.data.push(this.mapper(change.newState[i]));\n\t\t\t\t\t\t\tsource.push(change.newState[i]);\n\t\t\t\t\t\t} else if (source[i] !== change.newState[i]) {\n\t\t\t\t\t\t\tconst index = source.indexOf(change.newState[i]);\n\t\t\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\t\t\tconst a = this.data[i];\n\t\t\t\t\t\t\t\tconst b = this.data[index];\n\t\t\t\t\t\t\t\tthis.data[i] = b;\n\t\t\t\t\t\t\t\tthis.data[index] = a;\n\t\t\t\t\t\t\t\tconst c = source[i];\n\t\t\t\t\t\t\t\tconst d = source[index];\n\t\t\t\t\t\t\t\tsource[i] = d;\n\t\t\t\t\t\t\t\tsource[index] = c;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//@ts-ignore\n\t\t\t\t\t\t\t\tthis.data.splice(i, 0, this.mapper(change.newState[i]));\n\t\t\t\t\t\t\t\tsource.splice(i, 0, change.newState[i]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.data.length > change.newState.length) {\n\t\t\t\t\t\tthis.data.length = change.newState.length;\n\t\t\t\t\t}\n\t\t\t\t\tthis.update({\n\t\t\t\t\t\toperation: 'merge',\n\t\t\t\t\t\toperationDetailed: 'merge',\n\t\t\t\t\t\tpreviousState: old,\n\t\t\t\t\t\tindex: 0,\n\t\t\t\t\t\titems: this.data,\n\t\t\t\t\t\tnewState: this.data\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}, cancellationToken);\n\t}\n\n\tpublic refresh() {\n\t\t//@ts-ignore\n\t\tthis.merge(this.parent.data.map(this.mapper));\n\t}\n}\n\nexport class ReversedArrayView<T> extends ArrayDataSource<T> {\n\tprivate parent: ArrayDataSource<T>;\n\n\tconstructor(parent: ArrayDataSource<T>, cancellationToken: CancellationToken = new CancellationToken(), name?: string) {\n\t\tconst initial = parent\n\t\t\t.getData()\n\t\t\t.slice()\n\t\t\t.reverse();\n\t\tsuper(initial, name);\n\t\tthis.parent = parent;\n\n\t\tparent.listen((change) => {\n\t\t\tswitch (change.operationDetailed) {\n\t\t\t\tcase 'removeLeft':\n\t\t\t\t\tthis.removeRight(change.count);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'removeRight':\n\t\t\t\t\tthis.removeLeft(change.count);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'remove':\n\t\t\t\t\tfor (const item of change.items) {\n\t\t\t\t\t\tthis.remove(item);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'clear':\n\t\t\t\t\tthis.clear();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'prepend':\n\t\t\t\t\tthis.appendArray(change.items.reverse());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'append':\n\t\t\t\t\tthis.unshift(...change.items.reverse());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'insert':\n\t\t\t\t\tthis.merge(change.newState.slice().reverse());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'merge':\n\t\t\t\t\tthis.merge(change.items.slice().reverse());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swap':\n\t\t\t\t\tthis.merge(change.newState.slice().reverse());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'replace':\n\t\t\t\t\tthis.merge(change.newState.slice().reverse());\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}, cancellationToken);\n\t}\n\n\tpublic refresh() {\n\t\tthis.merge(\n\t\t\tthis.parent\n\t\t\t\t.getData()\n\t\t\t\t.slice()\n\t\t\t\t.reverse()\n\t\t);\n\t}\n}\n\nexport class UniqueArrayView<T> extends ArrayDataSource<T> {\n\tconstructor(parent: ArrayDataSource<T>, cancellationToken: CancellationToken = new CancellationToken(), name?: string) {\n\t\tconst initial = Array.from(new Set(parent.getData()));\n\t\tsuper(initial, name);\n\t\tlet filteredItems;\n\n\t\tparent.listen((change) => {\n\t\t\tswitch (change.operationDetailed) {\n\t\t\t\tcase 'removeLeft':\n\t\t\t\tcase 'removeRight':\n\t\t\t\tcase 'remove':\n\t\t\t\t\tfor (const item of change.items) {\n\t\t\t\t\t\tif (!change.newState.includes(item)) {\n\t\t\t\t\t\t\tthis.remove(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'clear':\n\t\t\t\t\tthis.clear();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'prepend':\n\t\t\t\t\tfilteredItems = change.items.filter((e) => !this.data.includes(e));\n\t\t\t\t\tthis.unshift(...filteredItems);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'append':\n\t\t\t\t\tfilteredItems = change.items.filter((e) => !this.data.includes(e));\n\t\t\t\t\tthis.appendArray(filteredItems);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'insert':\n\t\t\t\t\tfilteredItems = change.items.filter((e) => !this.data.includes(e));\n\t\t\t\t\tthis.insertAt(change.index, ...filteredItems);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'merge':\n\t\t\t\t\tthis.merge(Array.from(new Set(parent.getData())));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swap':\n\t\t\t\t\tthis.swap(change.index, change.index2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'replace':\n\t\t\t\t\tif (this.data.includes(change.items[0])) {\n\t\t\t\t\t\tthis.remove(change.target);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.set(change.index, change.items[0]);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}, cancellationToken);\n\t}\n}\nexport class SortedArrayView<T> extends ArrayDataSource<T> {\n\tprivate comparator: (a: T, b: T) => number;\n\tprivate parent: ArrayDataSource<T>;\n\n\tconstructor(parent: ArrayDataSource<T>, comparator: (a: T, b: T) => number, cancellationToken: CancellationToken = new CancellationToken(), name?: string) {\n\t\tconst initial = parent\n\t\t\t.getData()\n\t\t\t.slice()\n\t\t\t.sort(comparator);\n\t\tsuper(initial, name);\n\t\tthis.parent = parent;\n\t\tthis.comparator = comparator;\n\n\t\tparent.listen((change) => {\n\t\t\tswitch (change.operationDetailed) {\n\t\t\t\tcase 'removeLeft':\n\t\t\t\tcase 'removeRight':\n\t\t\t\tcase 'remove':\n\t\t\t\t\tfor (const item of change.items) {\n\t\t\t\t\t\tthis.remove(item);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'clear':\n\t\t\t\t\tthis.clear();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'prepend':\n\t\t\t\t\tthis.unshift(...change.items);\n\t\t\t\t\tthis.data.sort(this.comparator);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'append':\n\t\t\t\t\tthis.appendSorted(change.items);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'insert':\n\t\t\t\t\tthis.appendSorted(change.items);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'merge':\n\t\t\t\t\tthis.merge(change.items.slice().sort(this.comparator));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swap':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'replace':\n\t\t\t\t\tthis.remove(change.target);\n\t\t\t\t\tthis.appendSorted(change.items);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}, cancellationToken);\n\t}\n\n\tprivate appendSorted(items: T[]) {\n\t\tthis.merge(this.data.concat(items).sort(this.comparator));\n\t}\n\n\tpublic refresh() {\n\t\tthis.merge(\n\t\t\tthis.parent\n\t\t\t\t.getData()\n\t\t\t\t.slice()\n\t\t\t\t.sort(this.comparator)\n\t\t);\n\t}\n}\n\nexport class FilteredArrayView<T> extends ArrayDataSource<T> {\n\tprivate viewFilter: Predicate<T>;\n\tprivate parent: ArrayDataSource<T>;\n\tconstructor(parent: ArrayDataSource<T> | T[], filter?: Predicate<T>, cancellationToken: CancellationToken = new CancellationToken(), name?: string) {\n\t\tif (Array.isArray(parent)) {\n\t\t\tparent = new ArrayDataSource(parent);\n\t\t}\n\t\tfilter = filter ?? (() => true);\n\t\tconst initial = (parent as FilteredArrayView<T>).data.filter(filter);\n\t\tsuper(initial, name);\n\n\t\tthis.parent = parent;\n\t\tthis.viewFilter = filter;\n\t\tparent.listen((change) => {\n\t\t\tlet filteredItems;\n\t\t\tswitch (change.operationDetailed) {\n\t\t\t\tcase 'clear':\n\t\t\t\t\tthis.clear();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'removeLeft':\n\t\t\t\tcase 'removeRight':\n\t\t\t\tcase 'remove':\n\t\t\t\t\tfor (const item of change.items) {\n\t\t\t\t\t\tthis.remove(item);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'prepend':\n\t\t\t\t\tfilteredItems = change.items.filter(this.viewFilter);\n\t\t\t\t\tthis.unshift(...filteredItems);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'append':\n\t\t\t\t\tfilteredItems = change.items.filter(this.viewFilter);\n\t\t\t\t\tthis.appendArray(filteredItems);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'insert':\n\t\t\t\t\tfilteredItems = change.items.filter(this.viewFilter);\n\t\t\t\t\tthis.insertAt(change.index, ...filteredItems);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'merge':\n\t\t\t\t\tthis.merge(change.items.filter(this.viewFilter));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swap':\n\t\t\t\t\tconst indexA = this.data.indexOf(change.items[0]);\n\t\t\t\t\tconst indexB = this.data.indexOf(change.items[1]);\n\t\t\t\t\tif (indexA !== -1 && indexB !== -1) {\n\t\t\t\t\t\tthis.swap(indexA, indexB);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'replace':\n\t\t\t\t\tconst index = this.data.indexOf(change.target);\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tconst acceptNew = this.viewFilter(change.items[0]);\n\t\t\t\t\t\tif (acceptNew) {\n\t\t\t\t\t\t\tthis.set(index, change.items[0]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.remove(change.target);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}, cancellationToken);\n\t}\n\n\t/**\n\t * Replaces the filter function\n\t * @param filter\n\t * @returns returns new size of array view after applying filter\n\t */\n\tpublic updateFilter(filter: Predicate<T>): number {\n\t\tif (this.viewFilter === filter) {\n\t\t\treturn;\n\t\t}\n\t\tthis.viewFilter = filter;\n\t\tthis.refresh();\n\t\treturn this.data.length;\n\t}\n\n\t/**\n\t * Recalculates the filter. Only needed if your filter function isn't pure and you know the result would be different if run again compared to before\n\t */\n\tpublic refresh() {\n\t\tthis.merge((this.parent as FilteredArrayView<T>).data.filter(this.viewFilter));\n\t}\n}\n\nexport function processTransform<I, O>(operations: DataSourceOperator<any, any>[], result: DataSource<O>): Callback<I> {\n\treturn async (v: any) => {\n\t\tfor (const operation of operations) {\n\t\t\tswitch (operation.operationType) {\n\t\t\t\tcase OperationType.NOOP:\n\t\t\t\tcase OperationType.MAP:\n\t\t\t\t\tv = (operation as DataSourceMapOperator<any, any>).operation(v);\n\t\t\t\t\tbreak;\n\t\t\t\tcase OperationType.MAP_DELAY_FILTER:\n\t\t\t\t\tconst tmp = await (operation as DataSourceMapDelayFilterOperator<any, any>).operation(v);\n\t\t\t\t\tif (tmp.cancelled) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tv = await tmp.item;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase OperationType.DELAY:\n\t\t\t\tcase OperationType.MAP_DELAY:\n\t\t\t\t\tv = await (operation as DataSourceMapOperator<any, any>).operation(v);\n\t\t\t\t\tbreak;\n\t\t\t\tcase OperationType.DELAY_FILTER:\n\t\t\t\t\tif (!(await (operation as DataSourceDelayFilterOperator<any>).operation(v))) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase OperationType.FILTER:\n\t\t\t\t\tif (!(operation as DataSourceFilterOperator<any>).operation(v)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tresult.update(v);\n\t};\n}\n","import { ReadOnlyDataSource, DataSource } from '../stream/data_source';\nimport { DuplexDataSource } from '../stream/duplex_data_source';\nimport { CancellationToken } from '../utilities/cancellation_token';\n\nexport function aurumClassName(\n\tdata: { [key: string]: boolean | ReadOnlyDataSource<boolean> },\n\tcancellationToken?: CancellationToken\n): Array<string | ReadOnlyDataSource<string>> {\n\tconst result = [];\n\tfor (const key in data) {\n\t\tif (data[key]) {\n\t\t\tif (data[key] instanceof DataSource || data[key] instanceof DuplexDataSource) {\n\t\t\t\tconst source = data[key] as ReadOnlyDataSource<boolean>;\n\t\t\t\tconst mappedSource = new DataSource<string>(source.value ? key : '');\n\t\t\t\tsource.listen((value) => {\n\t\t\t\t\tmappedSource.update(value ? key : '');\n\t\t\t\t}, cancellationToken);\n\n\t\t\t\tresult.push(mappedSource);\n\t\t\t} else {\n\t\t\t\tresult.push(key);\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n}\n","import { DataSource, ArrayDataSource, CollectionChange, ReadOnlyDataSource } from '../stream/data_source';\nimport { DuplexDataSource } from '../stream/duplex_data_source';\nimport { Stream } from '../stream/stream';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { aurumClassName } from './classname';\n\nexport function createRenderSession(): RenderSession {\n\tconst session = {\n\t\tattachCalls: [],\n\t\tsessionToken: new CancellationToken(() => {\n\t\t\tfor (const token of session.tokens) {\n\t\t\t\ttoken.cancel();\n\t\t\t}\n\t\t}),\n\t\ttokens: []\n\t};\n\n\treturn session;\n}\n\nexport const aurumElementModelIdentitiy = Symbol('AurumElementModel');\n\nexport const nodeData = new WeakMap<any, AurumNodeData>();\n\nexport interface AurumNodeData {}\n\nexport type Renderable =\n\t| AurumElement\n\t| HTMLElement\n\t| Text\n\t| string\n\t| number\n\t| AurumElementModel<any>\n\t| Promise<Renderable>\n\t| DataSource<Renderable>\n\t| ArrayDataSource<Renderable>\n\t| DuplexDataSource<Renderable>\n\t| Renderable[];\n\nexport type Rendered = AurumElement | HTMLElement | Text;\n\nexport interface AurumComponentAPI {\n\tonAttach(cb: () => void);\n\tonDetach(cb: () => void);\n\tonError(cb: (error: Error) => Renderable);\n\tcancellationToken: CancellationToken;\n\tprerender(children: Renderable[], disposalToken?: CancellationToken): any[];\n\tprerender(child: Renderable, disposalToken?: CancellationToken): any;\n\tstyle(fragments: TemplateStringsArray, ...input: any[]): DataSource<string>;\n\tclassName(data: { [key: string]: boolean | ReadOnlyDataSource<boolean> }): Array<string | ReadOnlyDataSource<string>>;\n}\n\nexport interface AurumElementModel<T> {\n\t[aurumElementModelIdentitiy]: boolean;\n\tprops: T;\n\tname: string;\n\tisIntrinsic: boolean;\n\tchildren: Renderable[];\n\tfactory(props: T, children: Renderable[], api: AurumComponentAPI): Renderable;\n}\n\nexport abstract class AurumElement {\n\tpublic children: Rendered[];\n\tprotected api: AurumComponentAPI;\n\tprivate static id: number = 1;\n\n\tprotected contentStartMarker: Comment;\n\tprotected contentEndMarker: Comment;\n\tprotected hostNode: HTMLElement;\n\tprivate lastStartIndex: number;\n\tprivate lastEndIndex: number;\n\n\tconstructor(dataSource: ArrayDataSource<any> | DataSource<any> | DuplexDataSource<any>, api: AurumComponentAPI) {\n\t\tthis.children = [];\n\t\tthis.api = api;\n\t\tthis.api.onAttach(() => {\n\t\t\tif (this.hostNode === undefined) {\n\t\t\t\tthrow new Error('illegal state: Attach fired but not actually attached');\n\t\t\t}\n\t\t\tthis.render(dataSource);\n\t\t});\n\t}\n\n\tpublic dispose() {\n\t\tthis.clearContent();\n\t}\n\n\tpublic attachToDom(node: HTMLElement, index: number): void {\n\t\tif (this.hostNode) {\n\t\t\tthrow new Error('Aurum Element is already attached');\n\t\t}\n\t\tconst id = AurumElement.id++;\n\n\t\tthis.hostNode = node;\n\t\tthis.contentStartMarker = document.createComment('START Aurum Node ' + id);\n\t\tthis.contentEndMarker = document.createComment('END Aurum Node ' + id);\n\t\tif (index >= node.childNodes.length) {\n\t\t\tnode.appendChild(this.contentStartMarker);\n\t\t\tnode.appendChild(this.contentEndMarker);\n\t\t} else {\n\t\t\tnode.insertBefore(this.contentStartMarker, node.childNodes[index]);\n\t\t\tnode.insertBefore(this.contentEndMarker, node.childNodes[index + 1]);\n\t\t}\n\t}\n\n\tprotected getWorkIndex(): number {\n\t\tif (this.lastStartIndex !== undefined && this.hostNode.childNodes[this.lastStartIndex] === this.contentStartMarker) {\n\t\t\treturn this.lastStartIndex + 1;\n\t\t}\n\n\t\tfor (let i = 0; i < this.hostNode.childNodes.length; i++) {\n\t\t\tif (this.hostNode.childNodes[i] === this.contentStartMarker) {\n\t\t\t\tthis.lastStartIndex = i;\n\t\t\t\treturn i + 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected getLastIndex(): number {\n\t\tif (this.lastEndIndex !== undefined && this.hostNode.childNodes[this.lastEndIndex] === this.contentEndMarker) {\n\t\t\treturn this.lastEndIndex;\n\t\t}\n\n\t\tfor (let i = 0; i < this.hostNode.childNodes.length; i++) {\n\t\t\tif (this.hostNode.childNodes[i] === this.contentEndMarker) {\n\t\t\t\tthis.lastEndIndex = i;\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected abstract render(dataSource: DataSource<any> | ArrayDataSource<any> | DuplexDataSource<any>): void;\n\n\tprotected clearContent(): void {\n\t\tif (this.hostNode === undefined) {\n\t\t\tthrow new Error('illegal state: Aurum element was not attched to anything');\n\t\t}\n\n\t\tlet workIndex = this.getWorkIndex();\n\t\twhile (this.hostNode.childNodes[workIndex] !== this.contentEndMarker) {\n\t\t\tif (!(this.hostNode.childNodes[workIndex] instanceof Comment)) {\n\t\t\t\tthis.hostNode.removeChild(this.hostNode.childNodes[workIndex]);\n\t\t\t} else {\n\t\t\t\tworkIndex++;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected updateDom(): void {\n\t\tif (this.hostNode === undefined) {\n\t\t\tthrow new Error('illegal state: Aurum element was not attched to anything');\n\t\t}\n\n\t\tconst workIndex = this.getWorkIndex();\n\t\tlet i: number;\n\t\tlet offset: number = 0;\n\t\tfor (i = 0; i < this.children.length; i++) {\n\t\t\tconst child = this.children[i];\n\t\t\tif (child === undefined || child === null) {\n\t\t\t\toffset--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (child instanceof AurumElement) {\n\t\t\t\tif (!child.hostNode) {\n\t\t\t\t\tchild.attachToDom(this.hostNode, i + workIndex + offset);\n\t\t\t\t}\n\t\t\t\toffset += child.getLastIndex() - i - offset - workIndex;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.hostNode.childNodes[i + workIndex + offset] !== this.contentEndMarker &&\n\t\t\t\tthis.hostNode.childNodes[i + workIndex + offset] !== this.children[i] &&\n\t\t\t\tthis.hostNode.childNodes[i + workIndex + offset] !== (this.children[i + 1] as SingularAurumElement)?.contentStartMarker\n\t\t\t) {\n\t\t\t\tif (child instanceof HTMLElement || child instanceof Text) {\n\t\t\t\t\tthis.hostNode.removeChild(this.hostNode.childNodes[i + workIndex + offset]);\n\t\t\t\t\tif (this.hostNode.childNodes[i + workIndex + offset]) {\n\t\t\t\t\t\tthis.hostNode.insertBefore(child, this.hostNode.childNodes[i + workIndex + offset]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.hostNode.appendChild(child);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('not implemented');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (child instanceof HTMLElement || child instanceof Text) {\n\t\t\t\t\tif (this.hostNode.childNodes[i + workIndex + offset]) {\n\t\t\t\t\t\tthis.hostNode.insertBefore(child, this.hostNode.childNodes[i + workIndex + offset]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.hostNode.appendChild(child);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('not implemented');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\twhile (this.hostNode.childNodes[i + workIndex + offset] !== this.contentEndMarker) {\n\t\t\tthis.hostNode.removeChild(this.hostNode.childNodes[i + workIndex + offset]);\n\t\t}\n\t}\n}\n\n/**\n * @internal\n */\nexport interface RenderSession {\n\tattachCalls: Array<() => void>;\n\ttokens: CancellationToken[];\n\tsessionToken: CancellationToken;\n}\n\n/**\n * @internal\n */\nexport function render<T extends Renderable>(element: T, session: RenderSession, prerendering: boolean = false): T extends Array<any> ? any[] : any {\n\tif (element == undefined) {\n\t\treturn undefined;\n\t}\n\n\tif (pendingSessions.has(element)) {\n\t\tconst subSession = pendingSessions.get(element);\n\t\tif (subSession.sessionToken) {\n\t\t\tsession.attachCalls.push(...subSession.attachCalls);\n\t\t\tsession.sessionToken.chain(subSession.sessionToken);\n\t\t\tsubSession.attachCalls = undefined;\n\t\t\tsubSession.sessionToken = undefined;\n\t\t}\n\t\tpendingSessions.delete(element);\n\t}\n\n\tif (Array.isArray(element)) {\n\t\t// Flatten the rendered content into a single array to avoid having to iterate over nested arrays later\n\t\treturn Array.prototype.concat.apply(\n\t\t\t[],\n\t\t\telement.map((e) => render(e, session, prerendering))\n\t\t);\n\t}\n\n\tif (!prerendering) {\n\t\tif (element instanceof Promise) {\n\t\t\tconst ds = new DataSource();\n\t\t\telement.then((val) => {\n\t\t\t\tds.update(val);\n\t\t\t});\n\t\t\tconst result = new SingularAurumElement(ds, createAPI(session));\n\t\t\treturn result as any;\n\t\t} else if (element instanceof DataSource || element instanceof DuplexDataSource) {\n\t\t\tconst result = new SingularAurumElement(element as any, createAPI(session));\n\t\t\treturn result as any;\n\t\t} else if (element instanceof ArrayDataSource) {\n\t\t\tconst result = new ArrayAurumElement(element as any, createAPI(session));\n\t\t\treturn result as any;\n\t\t}\n\n\t\tconst type = typeof element;\n\t\tif (type === 'string' || type === 'number' || type === 'bigint' || type === 'boolean') {\n\t\t\treturn document.createTextNode(element.toString()) as any;\n\t\t}\n\t}\n\n\tif (element[aurumElementModelIdentitiy]) {\n\t\tconst model: AurumElementModel<any> = (element as any) as AurumElementModel<any>;\n\t\tconst api = createAPI(session);\n\t\tif (!model.isIntrinsic) {\n\t\t\tconsole.log(`Rendering ${model.name}`);\n\t\t\tapi.onAttach(() => {\n\t\t\t\tconsole.log(`Attaching ${model.name}`);\n\t\t\t});\n\t\t\tapi.onDetach(() => {\n\t\t\t\tconsole.log(`Detaching ${model.name}`);\n\t\t\t});\n\t\t}\n\t\tconst componentResult = model.factory(model.props || {}, model.children, api);\n\t\treturn render(componentResult, session, prerendering);\n\t}\n\t// Unsupported types are returned as is in hope that a transclusion component will transform it into something compatible\n\treturn element as any;\n}\n\nexport const pendingSessions: WeakMap<any, RenderSession> = new WeakMap();\n\n/**\n * @internal\n */\nexport function createAPI(session: RenderSession): AurumComponentAPI {\n\tlet token: CancellationToken = undefined;\n\tconst api = {\n\t\trenderSession: session,\n\t\tonAttach: (cb) => {\n\t\t\tsession.attachCalls.push(cb);\n\t\t},\n\t\tonDetach: (cb) => {\n\t\t\tif (!token) {\n\t\t\t\ttoken = new CancellationToken();\n\t\t\t\tsession.tokens.push(token);\n\t\t\t}\n\t\t\ttoken.addCancelable(cb);\n\t\t},\n\t\tonError: (cb) => {\n\t\t\tthrow new Error('not implemented');\n\t\t},\n\t\tget cancellationToken() {\n\t\t\tif (!token) {\n\t\t\t\ttoken = new CancellationToken();\n\t\t\t\tsession.tokens.push(token);\n\t\t\t}\n\t\t\treturn token;\n\t\t},\n\t\tprerender(target: Renderable | Renderable[]) {\n\t\t\tconst subSession = createRenderSession();\n\t\t\tconst result = render(target, subSession, true);\n\t\t\tif (Array.isArray(result)) {\n\t\t\t\tfor (const item of result) {\n\t\t\t\t\tif (typeof item === 'object') {\n\t\t\t\t\t\tpendingSessions.set(item, subSession);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpendingSessions.set(result, subSession);\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tstyle(fragments: TemplateStringsArray, ...input: any[]): DataSource<string> {\n\t\t\tconst result = new DataSource<string>();\n\t\t\tfor (const ins of input) {\n\t\t\t\tif (ins instanceof DataSource || ins instanceof DuplexDataSource || ins instanceof Stream) {\n\t\t\t\t\tins.listen(() => result.update(recompute(fragments, input)), api.cancellationToken);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.update(recompute(fragments, input));\n\n\t\t\treturn result;\n\t\t},\n\t\tclassName(data: { [key: string]: boolean | ReadOnlyDataSource<boolean> }): Array<string | ReadOnlyDataSource<string>> {\n\t\t\treturn aurumClassName(data, api.cancellationToken);\n\t\t}\n\t};\n\n\treturn api;\n}\n\nfunction recompute(fragments: TemplateStringsArray, input: any[]) {\n\tlet result = '';\n\tfor (let i = 0; i < fragments.length; i++) {\n\t\tresult += fragments[i];\n\t\tif (input[i]) {\n\t\t\tif (input[i] instanceof DataSource || input[i] instanceof DuplexDataSource || input[i] instanceof Stream) {\n\t\t\t\tresult += input[i].value;\n\t\t\t} else {\n\t\t\t\tresult += input[i];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport class ArrayAurumElement extends AurumElement {\n\tprivate renderSessions: WeakMap<any, RenderSession>;\n\tprivate dataSource: ArrayDataSource<any>;\n\n\tconstructor(dataSource: ArrayDataSource<any>, api: AurumComponentAPI) {\n\t\tsuper(dataSource, api);\n\t\tthis.renderSessions = new WeakMap();\n\t\tthis.dataSource = dataSource;\n\t}\n\n\tpublic attachToDom(node: HTMLElement, index: number): void {\n\t\tsuper.attachToDom(node, index);\n\t\t//@ts-ignore\n\t\tthis.contentStartMarker.dataSource = this.dataSource;\n\t\t//@ts-ignore\n\t\tthis.contentEndMarker.dataSource = this.dataSource;\n\t}\n\n\tprotected render(dataSource: ArrayDataSource<any>): void {\n\t\tdataSource.listenAndRepeat((n) => {\n\t\t\tthis.handleNewContent(n);\n\t\t}, this.api.cancellationToken);\n\t}\n\n\tprivate spliceChildren(index: number, amount: number, newItems?: Rendered): void {\n\t\tlet removed;\n\t\tif (newItems) {\n\t\t\tremoved = this.children.splice(index, amount, newItems);\n\t\t} else {\n\t\t\tremoved = this.children.splice(index, amount);\n\t\t}\n\t\tfor (const item of removed) {\n\t\t\tthis.renderSessions.get(item).sessionToken.cancel();\n\t\t}\n\t}\n\n\tprivate handleNewContent(change: CollectionChange<any>): void {\n\t\tconst ac = [];\n\t\tswitch (change.operationDetailed) {\n\t\t\tcase 'merge':\n\t\t\t\tconst source = change.previousState.slice();\n\t\t\t\tfor (let i = 0; i < change.newState.length; i++) {\n\t\t\t\t\tif (this.children.length <= i) {\n\t\t\t\t\t\tthis.children.push(this.renderItem(change.newState[i], ac));\n\t\t\t\t\t\tsource.push(change.newState[i]);\n\t\t\t\t\t} else if (source[i] !== change.newState[i]) {\n\t\t\t\t\t\tconst index = source.indexOf(change.newState[i], i);\n\t\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\t\tconst a = this.children[i];\n\t\t\t\t\t\t\tconst b = this.children[index];\n\t\t\t\t\t\t\tthis.children[i] = b;\n\t\t\t\t\t\t\tthis.children[index] = a;\n\t\t\t\t\t\t\tconst c = source[i];\n\t\t\t\t\t\t\tconst d = source[index];\n\t\t\t\t\t\t\tsource[i] = d;\n\t\t\t\t\t\t\tsource[index] = c;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.spliceChildren(i, 0, this.renderItem(change.newState[i], ac));\n\t\t\t\t\t\t\tsource.splice(i, 0, change.newState[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.children.length > change.newState.length) {\n\t\t\t\t\tthis.spliceChildren(change.newState.length, this.children.length - change.newState.length);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'remove':\n\t\t\tcase 'removeLeft':\n\t\t\tcase 'removeRight':\n\t\t\t\tthis.spliceChildren(change.index, change.count);\n\t\t\t\tbreak;\n\t\t\tcase 'append':\n\t\t\t\tfor (const item of change.items) {\n\t\t\t\t\tconst rendered = this.renderItem(item, ac);\n\t\t\t\t\tif (Array.isArray(rendered)) {\n\t\t\t\t\t\tthis.children = this.children.concat(rendered);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.children.push(rendered);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'replace':\n\t\t\t\tconst rendered = this.renderItem(change.items[0], ac);\n\t\t\t\tif (Array.isArray(rendered)) {\n\t\t\t\t\tthrow new Error('illegal state');\n\t\t\t\t} else {\n\t\t\t\t\tthis.children[change.index] = rendered;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'swap':\n\t\t\t\tconst itemA = this.children[change.index];\n\t\t\t\tconst itemB = this.children[change.index2];\n\t\t\t\tthis.children[change.index2] = itemA;\n\t\t\t\tthis.children[change.index] = itemB;\n\t\t\t\tbreak;\n\t\t\tcase 'prepend':\n\t\t\t\tfor (let i = change.items.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst item = change.items[i];\n\t\t\t\t\tconst rendered = this.renderItem(item, ac);\n\t\t\t\t\tif (Array.isArray(rendered)) {\n\t\t\t\t\t\tthrow new Error('illegal state');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.children.unshift(rendered);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'insert':\n\t\t\t\tlet index = change.index;\n\t\t\t\tfor (const item of change.items) {\n\t\t\t\t\tconst rendered = this.renderItem(item, ac);\n\t\t\t\t\tif (Array.isArray(rendered)) {\n\t\t\t\t\t\tthrow new Error('illegal state');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.children.splice(index, 0, rendered);\n\t\t\t\t\t\tindex += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'remove':\n\t\t\t\tfor (const item of change.items) {\n\t\t\t\t\tconst rendered = this.renderItem(item, ac);\n\t\t\t\t\tif (Array.isArray(rendered)) {\n\t\t\t\t\t\tthrow new Error('illegal state');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.children.unshift(rendered);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'clear':\n\t\t\t\tthis.children.length = 0;\n\t\t\t\tthis.renderSessions = new WeakMap();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error('not implemented');\n\t\t}\n\t\tthis.updateDom();\n\t\tfor (const c of ac) {\n\t\t\tc();\n\t\t}\n\t}\n\n\tprivate renderItem(item: any, attachCalls: any[]) {\n\t\tif (item === null || item === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst s = createRenderSession();\n\t\tconst rendered = render(item, s);\n\t\tif (rendered === undefined || rendered === null) {\n\t\t\treturn;\n\t\t}\n\t\tif (rendered instanceof AurumElement) {\n\t\t\ts.sessionToken.addCancelable(() => rendered.dispose());\n\t\t}\n\t\tthis.renderSessions.set(rendered, s);\n\t\tattachCalls.push(...s.attachCalls);\n\t\treturn rendered;\n\t}\n}\n\nexport class SingularAurumElement extends AurumElement {\n\tprivate renderSession: RenderSession;\n\tprivate lastValue: any;\n\tprivate dataSource: DataSource<any> | DuplexDataSource<any>;\n\n\tconstructor(dataSource: DataSource<any> | DuplexDataSource<any>, api: AurumComponentAPI) {\n\t\tsuper(dataSource, api);\n\t\tthis.api.cancellationToken.addCancelable(() => this.renderSession?.sessionToken.cancel());\n\t\tthis.dataSource = dataSource;\n\t}\n\n\tpublic attachToDom(node: HTMLElement, index: number): void {\n\t\tsuper.attachToDom(node, index);\n\t\t//@ts-ignore\n\t\tthis.contentStartMarker.dataSource = this.dataSource;\n\t\t//@ts-ignore\n\t\tthis.contentEndMarker.dataSource = this.dataSource;\n\t}\n\n\tprotected render(dataSource: DataSource<any> | DuplexDataSource<any>): void {\n\t\tdataSource.listenAndRepeat((n) => {\n\t\t\tthis.handleNewContent(n);\n\t\t}, this.api.cancellationToken);\n\t}\n\n\tprivate handleNewContent(newValue: any): void {\n\t\tif (this.lastValue === newValue) {\n\t\t\treturn;\n\t\t}\n\t\tlet optimized = false;\n\t\tif (this.children.length === 1 && this.children[0] instanceof Text) {\n\t\t\tconst type = typeof newValue;\n\t\t\tif (type === 'string' || type === 'bigint' || type === 'number' || type === 'boolean') {\n\t\t\t\tthis.children[0].nodeValue = newValue;\n\t\t\t\toptimized = true;\n\t\t\t}\n\t\t}\n\t\tif (!optimized) {\n\t\t\tthis.fullRebuild(newValue);\n\t\t}\n\t\tthis.updateDom();\n\t\tfor (const cb of this.renderSession.attachCalls) {\n\t\t\tcb();\n\t\t}\n\n\t\tthis.lastValue = newValue;\n\t}\n\n\tprivate fullRebuild(newValue: any): void {\n\t\tthis.clearContent();\n\t\tthis.endSession();\n\t\tthis.renderSession = createRenderSession();\n\t\tlet rendered = render(newValue, this.renderSession);\n\t\tif (rendered === undefined) {\n\t\t\tthis.children = [];\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(rendered)) {\n\t\t\trendered = [rendered];\n\t\t}\n\t\tfor (const item of rendered) {\n\t\t\tif (item instanceof AurumElement) {\n\t\t\t\titem.attachToDom(this.hostNode, this.getLastIndex());\n\t\t\t\tthis.renderSession.sessionToken.addCancelable(() => {\n\t\t\t\t\titem.dispose();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (Array.isArray(rendered)) {\n\t\t\tthis.children = rendered;\n\t\t}\n\t}\n\n\tprivate endSession(): void {\n\t\tif (this.renderSession) {\n\t\t\tthis.renderSession.sessionToken.cancel();\n\t\t\tthis.renderSession = undefined;\n\t\t}\n\t}\n}\n","import { ThenArg, Callback } from '../utilities/common';\nimport { EventEmitter } from '../utilities/event_emitter';\nimport { DataSource } from './data_source';\nimport { DuplexDataSource } from './duplex_data_source';\nimport { Stream } from './stream';\nimport {\n\tDataSourceMapOperator,\n\tOperationType,\n\tDataSourceFilterOperator,\n\tDataSourceMapDelayOperator,\n\tDataSourceMapDelayFilterOperator,\n\tDataSourceDelayOperator,\n\tDataSourceDelayFilterOperator,\n\tDataSourceNoopOperator\n} from './operator_model';\n\nexport function dsMap<T, M>(mapper: (value: T) => M): DataSourceMapOperator<T, M> {\n\treturn {\n\t\tname: 'map',\n\t\toperationType: OperationType.MAP,\n\t\toperation: (v) => mapper(v)\n\t};\n}\n\nexport function dsMapAsync<T, M>(mapper: (value: T) => Promise<M>): DataSourceMapDelayOperator<T, M> {\n\treturn {\n\t\tname: 'mapAsync',\n\t\toperationType: OperationType.MAP_DELAY,\n\t\toperation: (v) => mapper(v)\n\t};\n}\n\nexport function dsDiff<T>(): DataSourceMapOperator<T, { newValue: T; oldValue: T }> {\n\tlet lastValue = undefined;\n\treturn {\n\t\tname: 'diff',\n\t\toperationType: OperationType.MAP,\n\t\toperation: (v) => {\n\t\t\tlet result = {\n\t\t\t\toldValue: lastValue,\n\t\t\t\tnewValue: v\n\t\t\t};\n\t\t\tlastValue = v;\n\t\t\treturn result;\n\t\t}\n\t};\n}\n\nexport function dsFilter<T>(predicate: (value: T) => boolean): DataSourceFilterOperator<T> {\n\treturn {\n\t\tname: 'filter',\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => predicate(v)\n\t};\n}\n\nexport function dsFilterAsync<T>(predicate: (value: T) => Promise<boolean>): DataSourceDelayFilterOperator<T> {\n\treturn {\n\t\tname: 'filterAsync',\n\t\toperationType: OperationType.DELAY_FILTER,\n\t\toperation: (v) => predicate(v)\n\t};\n}\n\nexport function dsEven(): DataSourceFilterOperator<number> {\n\treturn {\n\t\tname: 'even',\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => v % 2 === 0\n\t};\n}\n\nexport function dsOdd(): DataSourceFilterOperator<number> {\n\treturn {\n\t\tname: 'odd',\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => v % 2 !== 0\n\t};\n}\n\nexport function dsMin(): DataSourceFilterOperator<number> {\n\tlet last = Number.MAX_SAFE_INTEGER;\n\treturn {\n\t\tname: 'min',\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => {\n\t\t\tif (v < last) {\n\t\t\t\tlast = v;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsMax(): DataSourceFilterOperator<number> {\n\tlet last = Number.MIN_SAFE_INTEGER;\n\treturn {\n\t\tname: 'max',\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => {\n\t\t\tif (v > last) {\n\t\t\t\tlast = v;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsSkipDynamic<T>(amountLeft: DataSource<number>): DataSourceFilterOperator<T> {\n\treturn {\n\t\toperationType: OperationType.FILTER,\n\t\tname: 'skipDynamic',\n\t\toperation: (v) => {\n\t\t\tif (amountLeft.value === 0) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tamountLeft.update(amountLeft.value - 1);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsSkip<T>(amount: number): DataSourceFilterOperator<T> {\n\treturn {\n\t\toperationType: OperationType.FILTER,\n\t\tname: `skip ${amount}`,\n\t\toperation: (v) => {\n\t\t\tif (amount === 0) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tamount--;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsCutOff<T>(amount: number): DataSourceFilterOperator<T> {\n\treturn {\n\t\tname: `cutoff ${amount}`,\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => {\n\t\t\tif (amount === 0) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tamount--;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsCutOffDynamic<T>(amountLeft: DataSource<number>): DataSourceFilterOperator<T> {\n\treturn {\n\t\tname: 'cutoffDynamic',\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => {\n\t\t\tif (amountLeft.value === 0) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tamountLeft.update(amountLeft.value - 1);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsUnique<T>(): DataSourceFilterOperator<T> {\n\tlet last: T;\n\treturn {\n\t\tname: 'unique',\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => {\n\t\t\tif (v === last) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tlast = v;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsAwait<T>(): DataSourceMapDelayOperator<T, ThenArg<T>> {\n\treturn {\n\t\tname: 'await',\n\t\toperationType: OperationType.MAP_DELAY,\n\t\toperation: (v) => {\n\t\t\treturn v as any;\n\t\t}\n\t};\n}\n\nexport function dsAwaitOrdered<T>(): DataSourceMapDelayOperator<T, ThenArg<T>> {\n\tconst queue: any[] = [];\n\tconst onDequeue = new EventEmitter();\n\n\treturn {\n\t\toperationType: OperationType.MAP_DELAY,\n\t\tname: 'awaitOrdered',\n\t\toperation: async (v) => {\n\t\t\tqueue.push(v);\n\t\t\tif (queue.length === 1) {\n\t\t\t\treturn processItem();\n\t\t\t} else {\n\t\t\t\tconst unsub = onDequeue.subscribe(async () => {\n\t\t\t\t\tif (queue[0] === v) {\n\t\t\t\t\t\tunsub.cancel();\n\t\t\t\t\t\treturn processItem();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\tasync function processItem() {\n\t\tawait queue[0];\n\t\tconst item = queue.shift();\n\t\tonDequeue.fire();\n\t\treturn item;\n\t}\n}\n\nexport function dsAwaitLatest<T>(): DataSourceMapDelayFilterOperator<T, ThenArg<T>> {\n\tlet freshnessToken: number;\n\n\treturn {\n\t\toperationType: OperationType.MAP_DELAY_FILTER,\n\t\tname: 'awaitLatest',\n\t\toperation: async (v) => {\n\t\t\tfreshnessToken = Date.now();\n\t\t\tconst timestamp = freshnessToken;\n\t\t\tconst resolved = await (v as any);\n\t\t\tif (freshnessToken === timestamp) {\n\t\t\t\treturn {\n\t\t\t\t\titem: resolved as any,\n\t\t\t\t\tcancelled: false\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\titem: undefined,\n\t\t\t\t\tcancelled: true\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsReduce<T, M = T>(reducer: (p: M, c: T) => M, initialValue: M): DataSourceMapOperator<T, M> {\n\tlet last = initialValue;\n\treturn {\n\t\tname: 'reduce',\n\t\toperationType: OperationType.MAP,\n\t\toperation: (v) => {\n\t\t\tlast = reducer(last, v);\n\t\t\treturn last;\n\t\t}\n\t};\n}\n\nexport function dsStringJoin(seperator: string = ', '): DataSourceMapOperator<string, string> {\n\tlet last: string;\n\treturn {\n\t\tname: `stringJoin ${seperator}`,\n\t\toperationType: OperationType.MAP,\n\t\toperation: (v: string) => {\n\t\t\tif (last) {\n\t\t\t\tlast += seperator + v;\n\t\t\t} else {\n\t\t\t\tlast = v;\n\t\t\t}\n\t\t\treturn last;\n\t\t}\n\t};\n}\n\nexport function dsDelay<T>(time: number): DataSourceDelayOperator<T> {\n\treturn {\n\t\tname: `delay ${time}ms`,\n\t\toperationType: OperationType.DELAY,\n\t\toperation: (v) => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tresolve(v);\n\t\t\t\t}, time);\n\t\t\t});\n\t\t}\n\t};\n}\n\nexport function dsDebounce<T>(time: number): DataSourceDelayFilterOperator<T> {\n\tlet timeout;\n\tlet cancelled = new EventEmitter();\n\treturn {\n\t\toperationType: OperationType.DELAY_FILTER,\n\t\tname: `debounce ${time}ms`,\n\t\toperation: (v) => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\tcancelled.fire();\n\t\t\t\tcancelled.subscribeOnce(() => {\n\t\t\t\t\tresolve(false);\n\t\t\t\t});\n\t\t\t\ttimeout = setTimeout(() => {\n\t\t\t\t\tresolve(true);\n\t\t\t\t\tcancelled.cancelAll();\n\t\t\t\t}, time);\n\t\t\t});\n\t\t}\n\t};\n}\n\n/**\n * Debounce update to occur at most one per animation frame\n */\nexport function dsThrottleFrame<T>(): DataSourceDelayFilterOperator<T> {\n\tlet timeout;\n\tlet cancelled = new EventEmitter();\n\treturn {\n\t\toperationType: OperationType.DELAY_FILTER,\n\t\tname: `throttle frame`,\n\t\toperation: (v) => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\tcancelled.fire();\n\t\t\t\tcancelled.subscribeOnce(() => {\n\t\t\t\t\tresolve(false);\n\t\t\t\t});\n\t\t\t\ttimeout = requestAnimationFrame(() => {\n\t\t\t\t\tresolve(true);\n\t\t\t\t\tcancelled.cancelAll();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n}\n\nexport function dsSemaphore<T>(state: DataSource<number>): DataSourceDelayOperator<T> {\n\treturn {\n\t\toperationType: OperationType.DELAY,\n\t\tname: 'semaphore',\n\t\toperation: (v) => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tif (state.value > 0) {\n\t\t\t\t\tstate.update(state.value - 1);\n\t\t\t\t\tresolve(v);\n\t\t\t\t} else {\n\t\t\t\t\tconst cancel = state.listen(() => {\n\t\t\t\t\t\tif (state.value > 0) {\n\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\tstate.update(state.value - 1);\n\t\t\t\t\t\t\tresolve(v);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n}\n\nexport function dsLock<T>(state: DataSource<boolean>): DataSourceDelayOperator<T> {\n\treturn {\n\t\tname: 'lock',\n\t\toperationType: OperationType.DELAY,\n\t\toperation: (v) => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tif (state.value) {\n\t\t\t\t\tresolve(v);\n\t\t\t\t} else {\n\t\t\t\t\tconst cancel = state.listen(() => {\n\t\t\t\t\t\tif (state.value) {\n\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\tresolve(v);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n}\n\nexport function dsThrottle<T>(time: number): DataSourceFilterOperator<T> {\n\tlet cooldown = false;\n\treturn {\n\t\tname: `throttle ${time}ms`,\n\t\toperationType: OperationType.FILTER,\n\t\toperation: (v) => {\n\t\t\tif (!cooldown) {\n\t\t\t\tcooldown = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcooldown = false;\n\t\t\t\t}, time);\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsBuffer<T>(time: number): DataSourceMapDelayFilterOperator<T, T[]> {\n\tlet buffer = [];\n\tlet promise;\n\n\treturn {\n\t\tname: `buffer ${time}ms`,\n\t\toperationType: OperationType.MAP_DELAY_FILTER,\n\t\toperation: (v) => {\n\t\t\tbuffer.push(v);\n\t\t\tif (!promise) {\n\t\t\t\tpromise = new Promise((resolve) => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tpromise = undefined;\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tcancelled: false,\n\t\t\t\t\t\t\titem: buffer\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbuffer = [];\n\t\t\t\t\t}, time);\n\t\t\t\t});\n\t\t\t\treturn promise;\n\t\t\t} else {\n\t\t\t\treturn Promise.resolve({\n\t\t\t\t\tcancelled: true,\n\t\t\t\t\titem: undefined\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsPick<T, K extends keyof T>(key: K): DataSourceMapOperator<T, T[K]> {\n\treturn {\n\t\tname: `pick ${key}`,\n\t\toperationType: OperationType.MAP,\n\t\toperation: (v) => {\n\t\t\tif (v !== undefined && v !== null) {\n\t\t\t\treturn v[key];\n\t\t\t} else {\n\t\t\t\treturn v as null | undefined;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function dsPipe<T>(target: DataSource<T> | DuplexDataSource<T> | Stream<T, any>): DataSourceNoopOperator<T> {\n\treturn {\n\t\tname: `pipe ${target.name}`,\n\t\toperationType: OperationType.NOOP,\n\t\toperation: (v) => {\n\t\t\tif (target instanceof DataSource || target instanceof Stream) {\n\t\t\t\ttarget.update(v);\n\t\t\t} else {\n\t\t\t\ttarget.updateDownstream(v);\n\t\t\t}\n\t\t\treturn v;\n\t\t}\n\t};\n}\n\n/**\n * Same as pipe except for duplex data sources it pipes upstream\n */\nexport function dsPipeUp<T>(target: DataSource<T> | DuplexDataSource<T> | Stream<T, any>): DataSourceNoopOperator<T> {\n\treturn {\n\t\tname: `pipeup ${target.name}`,\n\t\toperationType: OperationType.NOOP,\n\t\toperation: (v) => {\n\t\t\tif (target instanceof DataSource || target instanceof Stream) {\n\t\t\t\ttarget.update(v);\n\t\t\t} else {\n\t\t\t\ttarget.updateUpstream(v);\n\t\t\t}\n\t\t\treturn v;\n\t\t}\n\t};\n}\n\nexport function dsTap<T>(cb: Callback<T>): DataSourceNoopOperator<T> {\n\treturn {\n\t\tname: 'tap',\n\t\toperationType: OperationType.NOOP,\n\t\toperation: (v) => {\n\t\t\tcb(v);\n\t\t\treturn v;\n\t\t}\n\t};\n}\n\nexport function dsLoadBalance<T>(targets: Array<DataSource<T> | DuplexDataSource<T> | Stream<T, any>>): DataSourceNoopOperator<T> {\n\tlet i = 0;\n\n\treturn {\n\t\tname: `loadBalance [${targets.map((v) => v.name).join()}]`,\n\t\toperationType: OperationType.NOOP,\n\t\toperation: (v) => {\n\t\t\tconst target = targets[i++];\n\t\t\tif (i >= targets.length) {\n\t\t\t\ti = 0;\n\t\t\t}\n\t\t\tif (target instanceof DataSource || target instanceof Stream) {\n\t\t\t\ttarget.update(v);\n\t\t\t} else {\n\t\t\t\ttarget.updateDownstream(v);\n\t\t\t}\n\n\t\t\treturn v;\n\t\t}\n\t};\n}\n","import { StringSource, ClassType, DataDrain, Callback, MapLike, AttributeValue } from '../utilities/common';\nimport { DataSource, ReadOnlyDataSource } from '../stream/data_source';\nimport { DuplexDataSource } from '../stream/duplex_data_source';\nimport { Renderable, AurumComponentAPI, AurumElement, Rendered, render } from '../rendering/aurum_element';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { dsUnique } from '../stream/data_source_operators';\n\nexport interface HTMLNodeProps<T> {\n\tid?: AttributeValue;\n\tname?: AttributeValue;\n\tdraggable?: AttributeValue;\n\tclass?: ClassType;\n\ttabindex?: AttributeValue;\n\tstyle?: AttributeValue;\n\ttitle?: AttributeValue;\n\trole?: AttributeValue;\n\tslot?: AttributeValue;\n\tcontentEditable?: AttributeValue;\n\tonDblClick?: DataDrain<MouseEvent>;\n\tonClick?: DataDrain<MouseEvent>;\n\tonKeyDown?: DataDrain<KeyboardEvent>;\n\tonKeyUp?: DataDrain<KeyboardEvent>;\n\tonMouseDown?: DataDrain<MouseEvent>;\n\tonMouseUp?: DataDrain<MouseEvent>;\n\tonMouseEnter?: DataDrain<MouseEvent>;\n\tonMouseLeave?: DataDrain<MouseEvent>;\n\tonMouseMove?: DataDrain<MouseEvent>;\n\tonMouseWheel?: DataDrain<WheelEvent>;\n\tonBlur?: DataDrain<FocusEvent>;\n\tonFocus?: DataDrain<FocusEvent>;\n\tonDrag?: DataDrain<DragEvent>;\n\tonDragEnd?: DataDrain<DragEvent>;\n\tonDragEnter?: DataDrain<DragEvent>;\n\tonDragExit?: DataDrain<DragEvent>;\n\tonDragLeave?: DataDrain<DragEvent>;\n\tonDragOver?: DataDrain<DragEvent>;\n\tonDragStart?: DataDrain<DragEvent>;\n\tonLoad?: DataDrain<Event>;\n\tonError?: DataDrain<ErrorEvent>;\n\n\tonAttach?: Callback<T>;\n\tonDetach?: Callback<T>;\n}\n\n/**\n * @internal\n */\nexport const defaultEvents: MapLike<string> = {\n\tdrag: 'onDrag',\n\tdragstart: 'onDragStart',\n\tdragend: 'onDragEnd',\n\tdragexit: 'onDragExit',\n\tdragover: 'onDragOver',\n\tdragenter: 'onDragEnter',\n\tdragleave: 'onDragLeave',\n\tblur: 'onBlur',\n\tfocus: 'onFocus',\n\tclick: 'onClick',\n\tdblclick: 'onDblClick',\n\tkeydown: 'onKeyDown',\n\tkeyhit: 'onKeyHit',\n\tkeyup: 'onKeyUp',\n\tmousedown: 'onMouseDown',\n\tmouseup: 'onMouseUp',\n\tmousemove: 'onMouseMove',\n\tmouseenter: 'onMouseEnter',\n\tmouseleave: 'onMouseLeave',\n\tmousewheel: 'onMouseWheel',\n\tload: 'onLoad',\n\terror: 'onError'\n};\n\n/**\n * @internal\n */\nexport const defaultAttributes: string[] = ['id', 'name', 'draggable', 'tabindex', 'style', 'role', 'contentEditable', 'slot', 'title'];\n\nexport function DomNodeCreator<T extends HTMLNodeProps<any>>(\n\tnodeName: string,\n\textraAttributes?: string[],\n\textraEvents?: MapLike<string>,\n\textraLogic?: (node: HTMLElement, props: T, cleanUp: CancellationToken) => void\n) {\n\treturn function(props: T, children: Renderable[], api: AurumComponentAPI): HTMLElement {\n\t\tconst node = document.createElement(nodeName);\n\t\tif (props) {\n\t\t\tprocessHTMLNode(node, props, api.cancellationToken, extraAttributes, extraEvents);\n\t\t}\n\t\t//@ts-ignore\n\t\tconst renderedChildren = render(children, api.renderSession);\n\t\tconnectChildren(node, renderedChildren);\n\t\tif (props.onAttach) {\n\t\t\tapi.onAttach(() => props.onAttach(node));\n\t\t}\n\t\tif (props.onDetach) {\n\t\t\tapi.onDetach(() => {\n\t\t\t\tif (node.isConnected) {\n\t\t\t\t\tnode.parentElement.removeChild(node);\n\t\t\t\t}\n\t\t\t\tprops.onDetach(node);\n\t\t\t});\n\t\t}\n\n\t\textraLogic?.(node, props, api.cancellationToken);\n\n\t\treturn node;\n\t};\n}\n\nfunction connectChildren(target: HTMLElement, children: Rendered | Rendered[]): void {\n\tif (children === undefined || children === null) {\n\t\treturn;\n\t}\n\n\tif (Array.isArray(children)) {\n\t\tfor (const child of children) {\n\t\t\tconnectChildren(target, child);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (children instanceof AurumElement) {\n\t\tchildren.attachToDom(target, target.childNodes.length);\n\t} else if (children instanceof HTMLElement || children instanceof Text) {\n\t\ttarget.appendChild(children);\n\t} else {\n\t\tthrow new Error(`Unexpected child type passed to DOM Node: ${children}`);\n\t}\n}\n\nexport function processHTMLNode(\n\tnode: HTMLElement,\n\tprops: HTMLNodeProps<any>,\n\tcleanUp: CancellationToken,\n\textraAttributes?: string[],\n\textraEvents?: MapLike<string>\n) {\n\tcreateEventHandlers(node, defaultEvents, props);\n\tif (extraEvents) {\n\t\tcreateEventHandlers(node, extraEvents, props);\n\t}\n\n\tconst dataProps = Object.keys(props).filter((e) => e.includes('-'));\n\tbindProps(node, defaultAttributes, props, cleanUp, dataProps);\n\tif (extraAttributes) {\n\t\tbindProps(node, extraAttributes, props, cleanUp);\n\t}\n\n\tif (props.class) {\n\t\thandleClass(node, props.class, cleanUp);\n\t}\n}\n\nexport function createEventHandlers(node: HTMLElement, events: MapLike<string>, props: any) {\n\tfor (const key in events) {\n\t\tif (props[events[key]]) {\n\t\t\tif (props[events[key]] instanceof DataSource) {\n\t\t\t\t//@ts-ignore\n\t\t\t\tnode.addEventListener(key, (e: MouseEvent) => props[events[key]].update(e));\n\t\t\t} else if (props[events[key]] instanceof DuplexDataSource) {\n\t\t\t\t//@ts-ignore\n\t\t\t\tnode.addEventListener(key, (e: MouseEvent) => props[events[key]].updateDownstream(e));\n\t\t\t} else if (typeof props[events[key]] === 'function') {\n\t\t\t\t//@ts-ignore\n\t\t\t\tnode.addEventListener(key, (e: MouseEvent) => props[events[key]](e));\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction bindProps(node: HTMLElement, keys: string[], props: any, cleanUp: CancellationToken, dynamicProps?: string[]) {\n\tfor (const key of keys) {\n\t\tif (props[key]) {\n\t\t\tassignStringSourceToAttribute(node, props[key], key, cleanUp);\n\t\t}\n\t}\n\tif (dynamicProps) {\n\t\tfor (const key of dynamicProps) {\n\t\t\tif (props[key]) {\n\t\t\t\tassignStringSourceToAttribute(node, props[key], key, cleanUp);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction assignStringSourceToAttribute(node: HTMLElement, data: StringSource, key: string, cleanUp: CancellationToken) {\n\tif (typeof data === 'string') {\n\t\tnode.setAttribute(key, data);\n\t} else if (typeof data === 'boolean') {\n\t\tif (data) {\n\t\t\tnode.setAttribute(key, '');\n\t\t}\n\t} else if (data instanceof DataSource || data instanceof DuplexDataSource) {\n\t\tif (typeof data.value === 'string') {\n\t\t\tnode.setAttribute(key, data.value);\n\t\t} else if (typeof data.value === 'boolean') {\n\t\t\tif (data.value) {\n\t\t\t\tnode.setAttribute(key, '');\n\t\t\t}\n\t\t}\n\t\tdata.transform(dsUnique(), cleanUp).listen((v) => {\n\t\t\tif (typeof v === 'string') {\n\t\t\t\tnode.setAttribute(key, v);\n\t\t\t} else if (typeof v === 'boolean') {\n\t\t\t\tif (v) {\n\t\t\t\t\tnode.setAttribute(key, '');\n\t\t\t\t} else {\n\t\t\t\t\tnode.removeAttribute(key);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\tthrow new Error('Attributes only support types boolean, string, number and data sources');\n\t}\n}\n\nfunction handleClass(node: HTMLElement, data: ClassType, cleanUp: CancellationToken) {\n\tif (typeof data === 'string') {\n\t\tnode.className = data;\n\t} else if (data instanceof DataSource || data instanceof DuplexDataSource) {\n\t\tif (data.value) {\n\t\t\tif (Array.isArray(data.value)) {\n\t\t\t\tnode.className = data.value.join(' ');\n\t\t\t\tdata.transform(dsUnique(), cleanUp).listen(() => {\n\t\t\t\t\tnode.className = (data.value as string[]).join(' ');\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnode.className = data.value;\n\t\t\t\tdata.transform(dsUnique(), cleanUp).listen(() => {\n\t\t\t\t\tnode.className = data.value as string;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tdata.transform(dsUnique(), cleanUp).listen((v) => ((node as HTMLElement).className = v));\n\t} else {\n\t\tconst value: string = (data as Array<string | ReadOnlyDataSource<string>>).reduce<string>((p, c) => {\n\t\t\tif (typeof c === 'string') {\n\t\t\t\treturn `${p} ${c}`;\n\t\t\t} else {\n\t\t\t\tif (c.value) {\n\t\t\t\t\treturn `${p} ${c.value}`;\n\t\t\t\t} else {\n\t\t\t\t\treturn p;\n\t\t\t\t}\n\t\t\t}\n\t\t}, '');\n\t\tnode.className = value;\n\t\tfor (const i of data as Array<string | ReadOnlyDataSource<string>>) {\n\t\t\tif (i instanceof DataSource) {\n\t\t\t\ti.transform(dsUnique(), cleanUp).listen((v) => {\n\t\t\t\t\tconst value: string = (data as Array<string | ReadOnlyDataSource<string>>).reduce<string>((p, c) => {\n\t\t\t\t\t\tif (typeof c === 'string') {\n\t\t\t\t\t\t\treturn `${p} ${c}`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (c.value) {\n\t\t\t\t\t\t\t\treturn `${p} ${c.value}`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn p;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, '');\n\t\t\t\t\tnode.className = value;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n","import { HTMLNodeProps, DomNodeCreator } from './dom_adapter';\nimport { AttributeValue, DataDrain } from '../utilities/common';\nimport { GenericDataSource, DataSource } from '../stream/data_source';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { DuplexDataSource } from '../stream/duplex_data_source';\n\nexport interface InputProps extends HTMLNodeProps<HTMLInputElement> {\n\tplaceholder?: AttributeValue;\n\treadonly?: AttributeValue;\n\tdisabled?: AttributeValue;\n\tonChange?: DataDrain<InputEvent>;\n\tonInput?: DataDrain<InputEvent>;\n\tvalue?: GenericDataSource<string> | string;\n\taccept?: AttributeValue;\n\talt?: AttributeValue;\n\tautocomplete?: AttributeValue;\n\tautofocus?: AttributeValue;\n\tchecked?: GenericDataSource<boolean> | boolean;\n\tdefaultChecked?: AttributeValue;\n\tformAction?: AttributeValue;\n\tformEnctype?: AttributeValue;\n\tformMethod?: AttributeValue;\n\tformNoValidate?: AttributeValue;\n\tformTarget?: AttributeValue;\n\tmax?: AttributeValue;\n\tmaxLength?: AttributeValue;\n\tmin?: AttributeValue;\n\tminLength?: AttributeValue;\n\tpattern?: AttributeValue;\n\tmultiple?: AttributeValue;\n\trequired?: AttributeValue;\n\ttype?: AttributeValue;\n}\n\n/**\n * @internal\n */\nconst inputEvents = { input: 'onInput', change: 'onChange' };\n\n/**\n * @internal\n */\nconst inputProps = [\n\t'placeholder',\n\t'readonly',\n\t'disabled',\n\t'accept',\n\t'alt',\n\t'autocomplete',\n\t'autofocus',\n\t'checked',\n\t'defaultChecked',\n\t'formAction',\n\t'formEnctype',\n\t'formMethod',\n\t'formNoValidate',\n\t'formTarget',\n\t'max',\n\t'maxLength',\n\t'min',\n\t'minLength',\n\t'pattern',\n\t'multiple',\n\t'required',\n\t'type'\n];\n\n/**\n * @internal\n */\nexport const Input = DomNodeCreator<InputProps>('input', inputProps, inputEvents, (node: HTMLElement, props: InputProps, cleanUp: CancellationToken) => {\n\tconst input = node as HTMLInputElement;\n\tif (props.value) {\n\t\tif (props.value instanceof DataSource) {\n\t\t\tprops.value.listenAndRepeat((v) => {\n\t\t\t\tinput.value = v;\n\t\t\t}, cleanUp);\n\t\t\tinput.addEventListener('input', () => {\n\t\t\t\t(props.value as DataSource<string>).update(input.value);\n\t\t\t});\n\t\t} else if (props.value instanceof DuplexDataSource) {\n\t\t\tprops.value.listenAndRepeat((v) => {\n\t\t\t\tinput.value = v;\n\t\t\t}, cleanUp);\n\t\t\tinput.addEventListener('input', () => {\n\t\t\t\t(props.value as DuplexDataSource<string>).updateUpstream(input.value);\n\t\t\t});\n\t\t} else {\n\t\t\tinput.value = props.value as string;\n\t\t}\n\t}\n\n\tif (props.checked) {\n\t\tif (props.checked instanceof DataSource) {\n\t\t\tprops.checked.listenAndRepeat((v) => {\n\t\t\t\tinput.checked = v;\n\t\t\t}, cleanUp);\n\t\t\tinput.addEventListener('change', () => {\n\t\t\t\t(props.checked as DataSource<boolean>).update(input.checked);\n\t\t\t});\n\t\t} else if (props.checked instanceof DuplexDataSource) {\n\t\t\tprops.checked.listenAndRepeat((v) => {\n\t\t\t\tinput.checked = v;\n\t\t\t}, cleanUp);\n\t\t\tinput.addEventListener('change', () => {\n\t\t\t\t(props.checked as DuplexDataSource<boolean>).updateUpstream(input.checked);\n\t\t\t});\n\t\t} else {\n\t\t\tinput.checked = props.checked as boolean;\n\t\t}\n\t}\n});\n","import { DataSource, GenericDataSource } from '../stream/data_source';\nimport { DuplexDataSource } from '../stream/duplex_data_source';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { DomNodeCreator, HTMLNodeProps } from './dom_adapter';\n\nexport interface SelectProps extends HTMLNodeProps<HTMLSelectElement> {\n\tvalue?: GenericDataSource<string> | string;\n\tselectedIndex?: GenericDataSource<number> | number;\n}\n\n/**\n * @internal\n */\nconst selectEvents = { change: 'onChange' };\n\n/**\n * @internal\n */\nexport const Select = DomNodeCreator<SelectProps>('select', undefined, selectEvents, (node: HTMLElement, props: SelectProps, cleanUp: CancellationToken) => {\n\tconst select = node as HTMLSelectElement;\n\tif (props.value) {\n\t\tif (props.value instanceof DataSource) {\n\t\t\tprops.value.listenAndRepeat((v) => {\n\t\t\t\tselect.value = v;\n\t\t\t}, cleanUp);\n\t\t\tselect.addEventListener('change', () => {\n\t\t\t\t(props.value as DataSource<string>).update(select.value);\n\t\t\t});\n\t\t} else if (props.value instanceof DuplexDataSource) {\n\t\t\tprops.value.listenAndRepeat((v) => {\n\t\t\t\tselect.value = v;\n\t\t\t}, cleanUp);\n\t\t\tselect.addEventListener('change', () => {\n\t\t\t\t(props.value as DuplexDataSource<string>).updateUpstream(select.value);\n\t\t\t});\n\t\t} else {\n\t\t\tselect.value = props.value as string;\n\t\t}\n\t}\n\n\tif (props.selectedIndex) {\n\t\tif (props.selectedIndex instanceof DataSource) {\n\t\t\tprops.selectedIndex.listenAndRepeat((v) => {\n\t\t\t\tselect.selectedIndex = v;\n\t\t\t}, cleanUp);\n\t\t\tselect.addEventListener('change', () => {\n\t\t\t\t(props.selectedIndex as DataSource<number>).update(select.selectedIndex);\n\t\t\t});\n\t\t} else if (props.selectedIndex instanceof DuplexDataSource) {\n\t\t\tprops.selectedIndex.listenAndRepeat((v) => {\n\t\t\t\tselect.selectedIndex = v;\n\t\t\t}, cleanUp);\n\t\t\tselect.addEventListener('change', () => {\n\t\t\t\t(props.selectedIndex as DuplexDataSource<number>).updateUpstream(select.selectedIndex);\n\t\t\t});\n\t\t} else {\n\t\t\tselect.selectedIndex = props.selectedIndex as number;\n\t\t}\n\t}\n});\n","import { DomNodeCreator, HTMLNodeProps } from './dom_adapter';\nimport { AttributeValue } from '../utilities/common';\n\nexport interface AProps extends HTMLNodeProps<HTMLAnchorElement> {\n\thref?: AttributeValue;\n\ttarget?: AttributeValue;\n}\n\nexport interface AreaProps extends HTMLNodeProps<HTMLAreaElement> {\n\talt?: AttributeValue;\n\tcoords?: AttributeValue;\n\tdownload?: AttributeValue;\n\thref?: AttributeValue;\n\threflang?: AttributeValue;\n\tmedia?: AttributeValue;\n\trel?: AttributeValue;\n\tshape?: AttributeValue;\n\ttarget?: AttributeValue;\n\ttype?: AttributeValue;\n}\n\nexport interface VideoProps extends HTMLNodeProps<HTMLVideoElement> {\n\tcontrols?: AttributeValue;\n\tautoplay?: AttributeValue;\n\tloop?: AttributeValue;\n\tmuted?: AttributeValue;\n\tpreload?: AttributeValue;\n\tsrc?: AttributeValue;\n\tposter?: AttributeValue;\n\twidth?: AttributeValue;\n\theight?: AttributeValue;\n}\n\nexport interface AudioProps extends HTMLNodeProps<HTMLAudioElement> {\n\tcontrols?: AttributeValue;\n\tautoplay?: AttributeValue;\n\tloop?: AttributeValue;\n\tmuted?: AttributeValue;\n\tpreload?: AttributeValue;\n\tsrc?: AttributeValue;\n}\n\nexport interface FormProps extends HTMLNodeProps<HTMLFormElement> {\n\taction?: AttributeValue;\n\tmethod?: AttributeValue;\n\trel?: AttributeValue;\n\tenctype?: AttributeValue;\n\tnovalidate?: AttributeValue;\n\ttarget?: AttributeValue;\n}\n\nexport interface ButtonProps extends HTMLNodeProps<HTMLButtonElement> {\n\ttype?: AttributeValue;\n\tdisabled?: AttributeValue;\n}\n\nexport interface CanvasProps extends HTMLNodeProps<HTMLCanvasElement> {\n\twidth?: AttributeValue;\n\theight?: AttributeValue;\n}\n\nexport interface DataProps extends HTMLNodeProps<HTMLDataElement> {\n\tvalue?: AttributeValue;\n}\n\nexport interface IFrameProps extends HTMLNodeProps<HTMLIFrameElement> {\n\tsrc?: AttributeValue;\n\tallow?: AttributeValue;\n\tallowFullscreen?: AttributeValue;\n\tallowPaymentRequest?: AttributeValue;\n\twidth?: AttributeValue;\n\theight?: AttributeValue;\n\tsrcdoc?: AttributeValue;\n}\n\nexport interface ImgProps extends HTMLNodeProps<HTMLImageElement> {\n\tsrc?: AttributeValue;\n\talt?: AttributeValue;\n\twidth?: AttributeValue;\n\theight?: AttributeValue;\n\treferrerPolicy?: AttributeValue;\n\tsizes?: AttributeValue;\n\tsrcset?: AttributeValue;\n\tuseMap?: AttributeValue;\n}\n\nexport interface LabelProps extends HTMLNodeProps<HTMLLabelElement> {\n\tfor?: AttributeValue;\n}\n\nexport interface LinkProps extends HTMLNodeProps<HTMLLinkElement> {\n\thref?: AttributeValue;\n\trel?: AttributeValue;\n\tmedia?: AttributeValue;\n\tas?: AttributeValue;\n\tdisabled?: AttributeValue;\n\ttype?: AttributeValue;\n}\n\nexport interface TimeProps extends HTMLNodeProps<HTMLTimeElement> {\n\tdatetime?: AttributeValue;\n}\n\nexport interface StyleProps extends HTMLNodeProps<HTMLStyleElement> {\n\tmedia?: AttributeValue;\n}\n\nexport interface SourceProps extends HTMLNodeProps<HTMLSourceElement> {\n\tsrc?: AttributeValue;\n\tsrcSet?: AttributeValue;\n\tmedia?: AttributeValue;\n\tsizes?: AttributeValue;\n\ttype?: AttributeValue;\n}\n\nexport interface ScriptProps extends HTMLNodeProps<HTMLScriptElement> {\n\tsrc?: AttributeValue;\n\tasync?: AttributeValue;\n\tdefer?: AttributeValue;\n\tintegrity?: AttributeValue;\n\tnoModule?: AttributeValue;\n\ttype?: AttributeValue;\n}\n\nexport interface SvgProps extends HTMLNodeProps<HTMLOrSVGElement> {\n\twidth?: AttributeValue;\n\theight?: AttributeValue;\n}\n\nexport interface ProgressProps extends HTMLNodeProps<HTMLProgressElement> {\n\tmax?: AttributeValue;\n\tvalue?: AttributeValue;\n}\n\nexport interface OptionProps extends HTMLNodeProps<HTMLElement> {\n\tvalue?: AttributeValue;\n}\n\nexport interface SlotProps extends HTMLNodeProps<HTMLSlotElement> {}\n\n/**\n * @internal\n */\nexport const Code = DomNodeCreator<HTMLNodeProps<HTMLElement>>('code');\n/**\n * @internal\n */\nexport const Div = DomNodeCreator<HTMLNodeProps<HTMLDivElement>>('div');\n/**\n * @internal\n */\nexport const A = DomNodeCreator<AProps>('a', ['href', 'target']);\n/**\n * @internal\n */\nexport const Abbr = DomNodeCreator<HTMLNodeProps<HTMLElement>>('abbr');\n/**\n * @internal\n */\nexport const Address = DomNodeCreator<HTMLNodeProps<HTMLElement>>('address');\n/**\n * @internal\n */\nexport const H1 = DomNodeCreator<HTMLNodeProps<HTMLElement>>('h1');\n/**\n * @internal\n */\nexport const H2 = DomNodeCreator<HTMLNodeProps<HTMLElement>>('h2');\n/**\n * @internal\n */\nexport const H3 = DomNodeCreator<HTMLNodeProps<HTMLElement>>('h3');\n/**\n * @internal\n */\nexport const H4 = DomNodeCreator<HTMLNodeProps<HTMLElement>>('h4');\n/**\n * @internal\n */\nexport const H5 = DomNodeCreator<HTMLNodeProps<HTMLElement>>('h5');\n/**\n * @internal\n */\nexport const H6 = DomNodeCreator<HTMLNodeProps<HTMLElement>>('h6');\n/**\n * @internal\n */\nexport const Area = DomNodeCreator<HTMLNodeProps<HTMLAreaElement>>('area', ['alt', 'coors']);\n/**\n * @internal\n */\nexport const Article = DomNodeCreator<HTMLNodeProps<HTMLElement>>('article');\n/**\n * @internal\n */\nexport const Aside = DomNodeCreator<HTMLNodeProps<HTMLElement>>('aside');\n/**\n * @internal\n */\nexport const Span = DomNodeCreator<HTMLNodeProps<HTMLSpanElement>>('span');\n/**\n * @internal\n */\nexport const NoScript = DomNodeCreator<HTMLNodeProps<HTMLElement>>('noscript');\n/**\n * @internal\n */\nexport const Video = DomNodeCreator<VideoProps>('video', ['controls', 'autoplay', 'loop', 'muted', 'preload', 'src', 'poster', 'width', 'height']);\n/**\n * @internal\n */\nexport const Ul = DomNodeCreator<HTMLNodeProps<HTMLUListElement>>('ul');\n/**\n * @internal\n */\nexport const Ol = DomNodeCreator<HTMLNodeProps<HTMLOListElement>>('ol');\n/**\n * @internal\n */\nexport const Li = DomNodeCreator<HTMLNodeProps<HTMLLIElement>>('li');\n/**\n * @internal\n */\nexport const Tr = DomNodeCreator<HTMLNodeProps<HTMLTableRowElement>>('tr');\n/**\n * @internal\n */\nexport const B = DomNodeCreator<HTMLNodeProps<HTMLElement>>('b');\n/**\n * @internal\n */\nexport const Body = DomNodeCreator<HTMLNodeProps<HTMLBodyElement>>('body');\n/**\n * @internal\n */\nexport const Title = DomNodeCreator<HTMLNodeProps<HTMLTitleElement>>('title');\n/**\n * @internal\n */\nexport const Summary = DomNodeCreator<HTMLNodeProps<HTMLElement>>('summary');\n/**\n * @internal\n */\nexport const THead = DomNodeCreator<HTMLNodeProps<HTMLElement>>('thead');\n/**\n * @internal\n */\nexport const Template = DomNodeCreator<HTMLNodeProps<HTMLTemplateElement>>('template');\n/**\n * @internal\n */\nexport const Q = DomNodeCreator<HTMLNodeProps<HTMLQuoteElement>>('q');\n/**\n * @internal\n */\nexport const Pre = DomNodeCreator<HTMLNodeProps<HTMLPreElement>>('pre');\n/**\n * @internal\n */\nexport const P = DomNodeCreator<HTMLNodeProps<HTMLParagraphElement>>('p');\n/**\n * @internal\n */\nexport const Hr = DomNodeCreator<HTMLNodeProps<HTMLHRElement>>('hr');\n/**\n * @internal\n */\nexport const Audio = DomNodeCreator<AudioProps>('audio', ['controls', 'autoplay', 'loop', 'muted', 'preload', 'src']);\n/**\n * @internal\n */\nexport const Br = DomNodeCreator<HTMLNodeProps<HTMLBRElement>>('br');\n/**\n * @internal\n */\nexport const Button = DomNodeCreator<ButtonProps>('button', ['disabled']);\n/**\n * @internal\n */\nexport const Canvas = DomNodeCreator<CanvasProps>('canvas', ['width', 'height']);\n/**\n * @internal\n */\nexport const Data = DomNodeCreator<DataProps>('data', ['value']);\n/**\n * @internal\n */\nexport const Details = DomNodeCreator<HTMLNodeProps<HTMLDetailsElement>>('details');\n/**\n * @internal\n */\nexport const Em = DomNodeCreator<HTMLNodeProps<HTMLElement>>('em');\n/**\n * @internal\n */\nexport const Footer = DomNodeCreator<HTMLNodeProps<HTMLElement>>('footer');\n/**\n * @internal\n */\nexport const Form = DomNodeCreator<FormProps>('form');\n/**\n * @internal\n */\nexport const Head = DomNodeCreator<HTMLNodeProps<HTMLHeadElement>>('head');\n/**\n * @internal\n */\nexport const Header = DomNodeCreator<HTMLNodeProps<HTMLElement>>('header');\n/**\n * @internal\n */\nexport const Heading = DomNodeCreator<HTMLNodeProps<HTMLHeadingElement>>('heading');\n/**\n * @internal\n */\nexport const I = DomNodeCreator<HTMLNodeProps<HTMLElement>>('i');\n/**\n * @internal\n */\nexport const IFrame = DomNodeCreator<IFrameProps>('iframe', ['src', 'srcdoc', 'width', 'height', 'allow', 'allowFullscreen', 'allowPaymentRequest']);\n/**\n * @internal\n */\nexport const Img = DomNodeCreator<ImgProps>('img', ['src', 'alt', 'width', 'height', 'referrerPolicy', 'sizes', 'srcset', 'useMap']);\n/**\n * @internal\n */\nexport const Label = DomNodeCreator<LabelProps>('label', ['for']);\n/**\n * @internal\n */\nexport const Link = DomNodeCreator<LinkProps>('link', ['href', 'rel', 'media', 'as', 'disabled', 'type']);\n/**\n * @internal\n */\nexport const Nav = DomNodeCreator<HTMLNodeProps<HTMLElement>>('nav');\n/**\n * @internal\n */\nexport const Sub = DomNodeCreator<HTMLNodeProps<HTMLElement>>('sub');\n/**\n * @internal\n */\nexport const Sup = DomNodeCreator<HTMLNodeProps<HTMLElement>>('sup');\n/**\n * @internal\n */\nexport const Table = DomNodeCreator<HTMLNodeProps<HTMLTableElement>>('table');\n/**\n * @internal\n */\nexport const TBody = DomNodeCreator<HTMLNodeProps<HTMLElement>>('tbody');\n/**\n * @internal\n */\nexport const TFoot = DomNodeCreator<HTMLNodeProps<HTMLElement>>('tfoot');\n/**\n * @internal\n */\nexport const Td = DomNodeCreator<HTMLNodeProps<HTMLTableColElement>>('td');\n/**\n * @internal\n */\nexport const Th = DomNodeCreator<HTMLNodeProps<HTMLTableHeaderCellElement>>('th');\n/**\n * @internal\n */\nexport const Time = DomNodeCreator<TimeProps>('time', ['datetime']);\n/**\n * @internal\n */\nexport const Style = DomNodeCreator<StyleProps>('style', ['media']);\n/**\n * @internal\n */\nexport const Source = DomNodeCreator<SourceProps>('source', ['src', 'srcSet', 'media', 'sizes', 'type']);\n/**\n * @internal\n */\nexport const Script = DomNodeCreator<ScriptProps>('script', ['src', 'async', 'defer', 'integrity', 'noModule', 'type']);\n/**\n * @internal\n */\nexport const Svg = DomNodeCreator<SvgProps>('svg', ['width', 'height']);\n/**\n * @internal\n */\nexport const Progress = DomNodeCreator<ProgressProps>('progress', ['max', 'value']);\n/**\n * @internal\n */\nexport const Option = DomNodeCreator<OptionProps>('option', ['value']);\n\n/**\n * @internal\n */\nexport const Slot = DomNodeCreator<SlotProps>('slot', ['name']);\n","import { GenericDataSource, DataSource } from '../stream/data_source';\nimport { AttributeValue, DataDrain } from '../utilities/common';\nimport { DomNodeCreator, HTMLNodeProps } from './dom_adapter';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { DuplexDataSource } from '../stream/duplex_data_source';\n\nexport interface TextAreaProps extends HTMLNodeProps<HTMLTextAreaElement> {\n\tplaceholder?: AttributeValue;\n\treadonly?: AttributeValue;\n\tdisabled?: AttributeValue;\n\tonChange?: DataDrain<InputEvent>;\n\tonInput?: DataDrain<InputEvent>;\n\tvalue?: GenericDataSource<string> | string;\n\trows?: AttributeValue;\n\twrap?: AttributeValue;\n\tautocomplete?: AttributeValue;\n\tautofocus?: AttributeValue;\n\tmax?: AttributeValue;\n\tmaxLength?: AttributeValue;\n\tmin?: AttributeValue;\n\tminLength?: AttributeValue;\n\trequired?: AttributeValue;\n\ttype?: AttributeValue;\n}\n\n/**\n * @internal\n */\nconst textAreaEvents = { input: 'onInput', change: 'onChange' };\n\n/**\n * @internal\n */\nconst textAreaProps = [\n\t'placeholder',\n\t'readonly',\n\t'disabled',\n\t'rows',\n\t'wrap',\n\t'autocomplete',\n\t'autofocus',\n\t'max',\n\t'maxLength',\n\t'min',\n\t'minLength',\n\t'required',\n\t'type'\n];\n\n/**\n * @internal\n */\nexport const TextArea = DomNodeCreator<TextAreaProps>(\n\t'textArea',\n\ttextAreaProps,\n\ttextAreaEvents,\n\t(node: HTMLElement, props: TextAreaProps, cleanUp: CancellationToken) => {\n\t\tconst textArea = node as HTMLTextAreaElement;\n\t\tif (props.value) {\n\t\t\tif (props.value instanceof DataSource) {\n\t\t\t\tprops.value.listenAndRepeat((v) => {\n\t\t\t\t\ttextArea.value = v;\n\t\t\t\t}, cleanUp);\n\t\t\t\ttextArea.addEventListener('input', () => {\n\t\t\t\t\t(props.value as DataSource<string>).update(textArea.value);\n\t\t\t\t});\n\t\t\t} else if (props.value instanceof DuplexDataSource) {\n\t\t\t\tprops.value.listenAndRepeat((v) => {\n\t\t\t\t\ttextArea.value = v;\n\t\t\t\t}, cleanUp);\n\t\t\t\ttextArea.addEventListener('input', () => {\n\t\t\t\t\t(props.value as DuplexDataSource<string>).updateUpstream(textArea.value);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\ttextArea.value = props.value as string;\n\t\t\t}\n\t\t}\n\t}\n);\n","import { HTMLNodeProps } from '../nodes/dom_adapter';\nimport { Input, InputProps } from '../nodes/input';\nimport { Select, SelectProps } from '../nodes/select';\nimport {\n\tA,\n\tAbbr,\n\tAProps,\n\tArea,\n\tAreaProps,\n\tArticle,\n\tAside,\n\tAudio,\n\tAudioProps,\n\tB,\n\tBr,\n\tButton,\n\tButtonProps,\n\tCanvas,\n\tCanvasProps,\n\tData,\n\tDataProps,\n\tDetails,\n\tDiv,\n\tEm,\n\tFooter,\n\tForm,\n\tH1,\n\tH2,\n\tH3,\n\tH4,\n\tH5,\n\tH6,\n\tHead,\n\tHeader,\n\tHeading,\n\tI,\n\tIFrame,\n\tIFrameProps,\n\tImg,\n\tImgProps,\n\tLabel,\n\tLabelProps,\n\tLi,\n\tLink,\n\tLinkProps,\n\tNav,\n\tNoScript,\n\tOl,\n\tOption,\n\tOptionProps,\n\tP,\n\tPre,\n\tProgress,\n\tProgressProps,\n\tQ,\n\tScript,\n\tScriptProps,\n\tSource,\n\tSourceProps,\n\tSpan,\n\tStyle,\n\tStyleProps,\n\tSub,\n\tSummary,\n\tSup,\n\tSvg,\n\tSvgProps,\n\tTable,\n\tTBody,\n\tTd,\n\tTemplate,\n\tTFoot,\n\tTh,\n\tTHead,\n\tTime,\n\tTimeProps,\n\tTitle,\n\tTr,\n\tUl,\n\tVideo,\n\tVideoProps,\n\tSlot,\n\tSlotProps,\n\tCode,\n\tHr,\n\tFormProps\n} from '../nodes/simple_dom_nodes';\nimport { TextArea, TextAreaProps } from '../nodes/textarea';\nimport {\n\tArrayAurumElement,\n\tAurumComponentAPI,\n\tAurumElement,\n\tAurumElementModel,\n\taurumElementModelIdentitiy,\n\tcreateAPI,\n\tcreateRenderSession,\n\trender,\n\tRenderable\n} from '../rendering/aurum_element';\nimport { ArrayDataSource } from '../stream/data_source';\nimport { MapLike } from './common';\nimport { CancellationToken } from './cancellation_token';\n\nconst nodeMap = {\n\tbutton: Button,\n\tcode: Code,\n\thr: Hr,\n\tdiv: Div,\n\tinput: Input,\n\tli: Li,\n\tspan: Span,\n\tstyle: Style,\n\tul: Ul,\n\tp: P,\n\timg: Img,\n\tlink: Link,\n\tcanvas: Canvas,\n\ta: A,\n\tarticle: Article,\n\tbr: Br,\n\tform: Form,\n\tlabel: Label,\n\tol: Ol,\n\tpre: Pre,\n\tprogress: Progress,\n\ttable: Table,\n\ttd: Td,\n\ttr: Tr,\n\tth: Th,\n\ttextarea: TextArea,\n\th1: H1,\n\th2: H2,\n\th3: H3,\n\th4: H4,\n\th5: H5,\n\th6: H6,\n\thead: Head,\n\theader: Header,\n\tfooter: Footer,\n\tnav: Nav,\n\tb: B,\n\ti: I,\n\tscript: Script,\n\tabbr: Abbr,\n\tarea: Area,\n\taside: Aside,\n\taudio: Audio,\n\tem: Em,\n\theading: Heading,\n\tiframe: IFrame,\n\tnoscript: NoScript,\n\toption: Option,\n\tq: Q,\n\tselect: Select,\n\tsource: Source,\n\ttitle: Title,\n\tvideo: Video,\n\ttbody: TBody,\n\ttfoot: TFoot,\n\tthead: THead,\n\tsummary: Summary,\n\tdetails: Details,\n\tsub: Sub,\n\tsup: Sup,\n\tsvg: Svg,\n\tdata: Data,\n\ttime: Time,\n\ttemplate: Template,\n\tslot: Slot\n};\n\nexport class Aurum {\n\tpublic static attach(aurumRenderable: Renderable, dom: HTMLElement): CancellationToken {\n\t\tconst session = createRenderSession();\n\t\tconst content = render(aurumRenderable, session);\n\t\tif (content instanceof AurumElement) {\n\t\t\tcontent.attachToDom(dom, dom.childNodes.length);\n\t\t\tsession.sessionToken.addCancelable(() => content.dispose());\n\t\t} else if (Array.isArray(content)) {\n\t\t\tconst root = new ArrayAurumElement(new ArrayDataSource(content), createAPI(session));\n\t\t\tsession.sessionToken.addCancelable(() => root.dispose());\n\t\t\troot.attachToDom(dom, dom.childNodes.length);\n\t\t} else {\n\t\t\tdom.appendChild(content);\n\t\t\tsession.sessionToken.addCancelable(() => {\n\t\t\t\tdom.removeChild(content);\n\t\t\t});\n\t\t}\n\t\tfor (let i = session.attachCalls.length - 1; i >= 0; i--) {\n\t\t\tsession.attachCalls[i]();\n\t\t}\n\n\t\treturn session.sessionToken;\n\t}\n\n\tpublic static factory(\n\t\tnode: string | ((props: any, children: Renderable[], api: AurumComponentAPI) => Renderable),\n\t\targs: MapLike<any>,\n\t\t...innerNodes: AurumElementModel<any>[]\n\t): AurumElementModel<any> {\n\t\tlet name;\n\t\tlet intrinsic = false;\n\t\tif (typeof node === 'string') {\n\t\t\tintrinsic = true;\n\t\t\tname = node;\n\t\t\tconst type = node;\n\t\t\tnode = nodeMap[node];\n\t\t\tif (node === undefined) {\n\t\t\t\tthrow new Error(`Node ${type} does not exist or is not supported`);\n\t\t\t}\n\t\t} else {\n\t\t\tname = node.name;\n\t\t}\n\n\t\treturn {\n\t\t\t[aurumElementModelIdentitiy]: true,\n\t\t\tname,\n\t\t\tisIntrinsic: intrinsic,\n\t\t\tfactory: node as (props: any, children: Renderable[], api: AurumComponentAPI) => Renderable,\n\t\t\tprops: args,\n\t\t\tchildren: innerNodes\n\t\t};\n\t}\n}\n\nexport namespace Aurum {\n\texport namespace JSX {\n\t\texport interface IntrinsicElements {\n\t\t\tcode: HTMLNodeProps<HTMLElement>;\n\t\t\tbutton: ButtonProps;\n\t\t\thr: HTMLNodeProps<HTMLHRElement>;\n\t\t\tdiv: HTMLNodeProps<HTMLDivElement>;\n\t\t\tinput: InputProps;\n\t\t\tli: HTMLNodeProps<HTMLLIElement>;\n\t\t\tspan: HTMLNodeProps<HTMLElement>;\n\t\t\tstyle: StyleProps;\n\t\t\tul: HTMLNodeProps<HTMLUListElement>;\n\t\t\tp: HTMLNodeProps<HTMLParagraphElement>;\n\t\t\timg: ImgProps;\n\t\t\tlink: LinkProps;\n\t\t\tcanvas: CanvasProps;\n\t\t\ta: AProps;\n\t\t\tarticle: HTMLNodeProps<HTMLElement>;\n\t\t\tbr: HTMLNodeProps<HTMLBRElement>;\n\t\t\tform: FormProps;\n\t\t\tlabel: LabelProps;\n\t\t\tol: HTMLNodeProps<HTMLOListElement>;\n\t\t\tpre: HTMLNodeProps<HTMLPreElement>;\n\t\t\tprogress: ProgressProps;\n\t\t\ttable: HTMLNodeProps<HTMLTableElement>;\n\t\t\ttd: HTMLNodeProps<HTMLTableColElement>;\n\t\t\ttr: HTMLNodeProps<HTMLTableRowElement>;\n\t\t\tth: HTMLNodeProps<HTMLTableHeaderCellElement>;\n\t\t\ttextarea: TextAreaProps;\n\t\t\th1: HTMLNodeProps<HTMLElement>;\n\t\t\th2: HTMLNodeProps<HTMLElement>;\n\t\t\th3: HTMLNodeProps<HTMLElement>;\n\t\t\th4: HTMLNodeProps<HTMLElement>;\n\t\t\th5: HTMLNodeProps<HTMLElement>;\n\t\t\th6: HTMLNodeProps<HTMLElement>;\n\t\t\theader: HTMLNodeProps<HTMLElement>;\n\t\t\tfooter: HTMLNodeProps<HTMLElement>;\n\t\t\tnav: HTMLNodeProps<HTMLElement>;\n\t\t\tb: HTMLNodeProps<HTMLElement>;\n\t\t\ti: HTMLNodeProps<HTMLElement>;\n\t\t\tscript: ScriptProps;\n\t\t\tabbr: HTMLNodeProps<HTMLElement>;\n\t\t\tarea: AreaProps;\n\t\t\tslot: SlotProps;\n\t\t\taside: HTMLNodeProps<HTMLElement>;\n\t\t\taudio: AudioProps;\n\t\t\tem: HTMLNodeProps<HTMLElement>;\n\t\t\theading: HTMLNodeProps<HTMLHeadingElement>;\n\t\t\tiframe: IFrameProps;\n\t\t\tnoscript: HTMLNodeProps<HTMLElement>;\n\t\t\toption: OptionProps;\n\t\t\tq: HTMLNodeProps<HTMLQuoteElement>;\n\t\t\tselect: SelectProps;\n\t\t\tsource: SourceProps;\n\t\t\ttitle: HTMLNodeProps<HTMLTitleElement>;\n\t\t\tvideo: VideoProps;\n\t\t\ttbody: HTMLNodeProps<HTMLElement>;\n\t\t\ttfoot: HTMLNodeProps<HTMLElement>;\n\t\t\tthead: HTMLNodeProps<HTMLElement>;\n\t\t\tsummary: HTMLNodeProps<HTMLElement>;\n\t\t\tdetails: HTMLNodeProps<HTMLDetailsElement>;\n\t\t\tsub: HTMLNodeProps<HTMLElement>;\n\t\t\tsup: HTMLNodeProps<HTMLElement>;\n\t\t\tsvg: SvgProps;\n\t\t\tdata: DataProps;\n\t\t\ttime: TimeProps;\n\t\t\tbody: HTMLNodeProps<HTMLBodyElement>;\n\t\t\thead: HTMLNodeProps<HTMLHeadElement>;\n\t\t\ttemplate: HTMLNodeProps<HTMLTemplateElement>;\n\t\t}\n\t}\n}\n","import { DomNodeCreator } from '../nodes/dom_adapter';\nimport { Aurum } from '../utilities/aurum';\nimport { AurumComponentAPI, createAPI, createRenderSession, Renderable, RenderSession } from './aurum_element';\nimport { DataSource } from '../stream/data_source';\n\nexport function Webcomponent<T>(\n\tconfig: {\n\t\t/**\n\t\t * Name of the webcomponent, must be  lower case kebab case as required by the spec\n\t\t */\n\t\tname: string;\n\t\t/**\n\t\t * List of attributes of the web component that will be transformed into a data source that reflects the exact state of the attribute in the DOM no matter what changes the attirbute\n\t\t */\n\t\tobservedAttributes?: string[];\n\t\tshadowRootMode?: 'open' | 'closed';\n\t\tshadowRootDelegatesFocus?: boolean;\n\t},\n\tlogic: (props: T, api: AurumComponentAPI) => Renderable\n): (props: T, children: Renderable[], api: AurumComponentAPI) => Renderable {\n\tcustomElements.define(\n\t\tconfig.name,\n\t\tclass extends HTMLElement {\n\t\t\tprivate api: AurumComponentAPI;\n\t\t\tprivate session: RenderSession;\n\t\t\tprivate props: any;\n\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tif (config.observedAttributes === undefined) {\n\t\t\t\t\tconfig.observedAttributes = [];\n\t\t\t\t}\n\t\t\t\tthis.props = {};\n\t\t\t\tfor (const attr of config.observedAttributes) {\n\t\t\t\t\tthis.props[attr] = new DataSource();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstatic get observedAttributes() {\n\t\t\t\treturn config.observedAttributes;\n\t\t\t}\n\n\t\t\tpublic attributeChangedCallback(name, oldValue, newValue): void {\n\t\t\t\tif (oldValue !== newValue) {\n\t\t\t\t\tthis.props[name].update(newValue);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpublic connectedCallback(): void {\n\t\t\t\tconst template = document.createDocumentFragment();\n\t\t\t\tthis.session = createRenderSession();\n\t\t\t\tthis.api = createAPI(this.session);\n\t\t\t\tconst content = logic(this.props, this.api);\n\n\t\t\t\tfor (const cb of this.session.attachCalls) {\n\t\t\t\t\tcb();\n\t\t\t\t}\n\n\t\t\t\tAurum.attach(content, template as any);\n\n\t\t\t\tthis.attachShadow({\n\t\t\t\t\tmode: config.shadowRootMode ?? 'open',\n\t\t\t\t\tdelegatesFocus: config.shadowRootDelegatesFocus\n\t\t\t\t}).appendChild(template);\n\t\t\t}\n\n\t\t\tpublic disconnectedCallback(): void {\n\t\t\t\tthis.session.sessionToken.cancel();\n\t\t\t}\n\t\t}\n\t);\n\n\treturn DomNodeCreator(config.name, config.observedAttributes, undefined, (node, props) => {\n\t\tfor (const key in props) {\n\t\t\t//@ts-ignore\n\t\t\tif (!(key in node.props)) {\n\t\t\t\t//@ts-ignore\n\t\t\t\tnode.props[key] = props[key];\n\t\t\t}\n\t\t}\n\t});\n}\n","import { DataSource } from '../stream/data_source';\nimport { Renderable, AurumComponentAPI, aurumElementModelIdentitiy, AurumElementModel } from '../rendering/aurum_element';\nimport { dsMap, dsUnique } from '../stream/data_source_operators';\n\nexport function AurumRouter(props: {}, children: Renderable[], api: AurumComponentAPI) {\n\tchildren = [].concat.apply(\n\t\t[],\n\t\tchildren.filter((c) => !!c)\n\t);\n\tif (\n\t\tchildren.some(\n\t\t\t(c) =>\n\t\t\t\t!c[aurumElementModelIdentitiy] || !((c as AurumElementModel<any>).factory === Route || (c as AurumElementModel<any>).factory === DefaultRoute)\n\t\t)\n\t) {\n\t\tthrow new Error('Aurum Router only accepts Route and DefaultRoute instances as children');\n\t}\n\tif (children.filter((c) => (c as AurumElementModel<any>).factory === DefaultRoute).length > 1) {\n\t\tthrow new Error('Too many default routes only 0 or 1 allowed');\n\t}\n\n\tconst urlDataSource = new DataSource(getUrlPath());\n\n\tapi.cancellationToken.registerDomEvent(window, 'hashchange', () => {\n\t\turlDataSource.update(getUrlPath());\n\t});\n\n\treturn urlDataSource\n\t\t.transform(dsUnique(), api.cancellationToken)\n\t\t.withInitial(urlDataSource.value)\n\t\t.transform(dsMap((p) => selectRoute(p, children as any)));\n}\n\nfunction getUrlPath(): string {\n\tconst hash = location.hash.substring(1);\n\tif (hash.includes('?')) {\n\t\treturn hash.substring(0, hash.indexOf('?'));\n\t} else if (hash.includes('#')) {\n\t\treturn hash.substring(0, hash.indexOf('#'));\n\t} else {\n\t\treturn hash;\n\t}\n}\n\nfunction selectRoute(url: string, routes: AurumElementModel<RouteProps>[]): Renderable[] {\n\tif (url === undefined || url === null) {\n\t\treturn routes.find((r) => r.factory === DefaultRoute)?.children;\n\t} else {\n\t\tif (routes.find((r) => r.props?.href === url)) {\n\t\t\treturn routes.find((r) => r.props?.href === url).children;\n\t\t} else {\n\t\t\tconst segments = url.split('/');\n\t\t\tsegments.pop();\n\t\t\twhile (segments.length) {\n\t\t\t\tconst path = segments.join('/');\n\t\t\t\tif (routes.find((r) => r.props?.href === path)) {\n\t\t\t\t\treturn routes.find((r) => r.props?.href === path).children;\n\t\t\t\t}\n\t\t\t\tsegments.pop();\n\t\t\t}\n\t\t\treturn routes.find((r) => r.factory === DefaultRoute)?.children;\n\t\t}\n\t}\n}\n\nexport interface RouteProps {\n\thref: string;\n}\n\nexport function Route(props: RouteProps, children): undefined {\n\treturn undefined;\n}\n\nexport function DefaultRoute(props: {}, children): undefined {\n\treturn undefined;\n}\n","import { Renderable, AurumComponentAPI } from '../rendering/aurum_element';\nimport { DataSource } from '../stream/data_source';\nimport { CancellationToken } from '../utilities/cancellation_token';\nexport interface SuspenseProps {\n\tfallback?: Renderable;\n}\n\nexport function Suspense(props: SuspenseProps, children: Renderable[], api: AurumComponentAPI) {\n\tconst data = new DataSource<Renderable>(props?.fallback);\n\tconst cleanUp = new CancellationToken();\n\tapi.onDetach(() => {\n\t\tcleanUp.cancel();\n\t});\n\n\tPromise.all(api.prerender(children, cleanUp)).then(\n\t\t(res) => {\n\t\t\tif (!cleanUp.isCanceled) {\n\t\t\t\tdata.update(res);\n\t\t\t}\n\t\t},\n\t\t(e) => {\n\t\t\tcleanUp.cancel();\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t);\n\n\treturn data;\n}\n","import { AurumComponentAPI, AurumElementModel, aurumElementModelIdentitiy, Renderable } from '../rendering/aurum_element';\nimport { GenericDataSource } from '../stream/data_source';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { dsMap, dsUnique } from '../stream/data_source_operators';\n\nexport interface SwitchProps<T = boolean> {\n\tstate: GenericDataSource<T>;\n}\n\nexport function Switch<T = boolean>(props: SwitchProps<T>, children: Renderable[], api: AurumComponentAPI) {\n\tchildren = [].concat.apply(\n\t\t[],\n\t\tchildren.filter((c) => !!c)\n\t);\n\tif (\n\t\tchildren.some(\n\t\t\t(c) =>\n\t\t\t\t!c[aurumElementModelIdentitiy] ||\n\t\t\t\t!((c as AurumElementModel<any>).factory === SwitchCase || (c as AurumElementModel<any>).factory === DefaultSwitchCase)\n\t\t)\n\t) {\n\t\tthrow new Error('Switch only accepts SwitchCase as children');\n\t}\n\tif (children.filter((c) => (c as AurumElementModel<any>).factory === DefaultSwitchCase).length > 1) {\n\t\tthrow new Error('Too many default switch cases only 0 or 1 allowed');\n\t}\n\n\tconst cleanUp = new CancellationToken();\n\tapi.onDetach(() => {\n\t\tcleanUp.cancel();\n\t});\n\n\tconst u = props.state.transform(dsUnique(), cleanUp);\n\treturn u.withInitial(props.state.value).transform(dsMap((state) => selectCase(state, children as AurumElementModel<SwitchCaseProps<any>>[])));\n}\n\nfunction selectCase<T>(state: T, children: AurumElementModel<SwitchCaseProps<any>>[]) {\n\treturn children.find((c) => c.props?.when === state)?.children ?? children.find((p) => p.factory === DefaultSwitchCase)?.children;\n}\n\nexport interface SwitchCaseProps<T> {\n\twhen: T;\n}\n\nexport function SwitchCase<T>(props: SwitchCaseProps<T>, children): undefined {\n\treturn undefined;\n}\n\nexport function DefaultSwitchCase(props: {}, children): undefined {\n\treturn undefined;\n}\n","import { ArrayDataSource, DataSource } from './data_source';\nimport { Callback } from '../utilities/common';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { EventEmitter } from '../utilities/event_emitter';\n\nexport interface ObjectChange<T, K extends keyof T> {\n\tkey: K;\n\toldValue: T[K];\n\tnewValue: T[K];\n\tdeleted?: boolean;\n}\n\nexport class ObjectDataSource<T> {\n\tprotected data: T;\n\tprivate updateEvent: EventEmitter<ObjectChange<T, keyof T>>;\n\tprivate updateEventOnKey: Map<keyof T, EventEmitter<ObjectChange<T, keyof T>>>;\n\n\tconstructor(initialData: T) {\n\t\tif (initialData) {\n\t\t\tthis.data = initialData;\n\t\t}\n\n\t\tthis.updateEvent = new EventEmitter();\n\t\tthis.updateEventOnKey = new Map();\n\t}\n\n\t/**\n\t * Creates a datasource for a single key of the object\n\t * @param key\n\t * @param cancellationToken\n\t */\n\tpublic pick<K extends keyof T>(key: K, cancellationToken?: CancellationToken): DataSource<T[K]> {\n\t\tconst subDataSource: DataSource<T[K]> = new DataSource(this.data?.[key]);\n\n\t\tthis.listenOnKey(\n\t\t\tkey,\n\t\t\t(v) => {\n\t\t\t\tsubDataSource.update(v.newValue);\n\t\t\t},\n\t\t\tcancellationToken\n\t\t);\n\n\t\treturn subDataSource;\n\t}\n\n\t/**\n\t * Listen to changes of the object\n\t */\n\tpublic listen(callback: Callback<ObjectChange<T, keyof T>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateEvent.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\tpublic map<D>(mapper: (change: ObjectChange<T, keyof T>) => D): ArrayDataSource<D> {\n\t\tconst stateMap: Map<string | number | Symbol, D> = new Map<string | number | Symbol, D>();\n\t\tconst result = new ArrayDataSource<D>();\n\t\tthis.listenAndRepeat((change) => {\n\t\t\tif (change.deleted && stateMap.has(change.key)) {\n\t\t\t\tconst item = stateMap.get(change.key);\n\t\t\t\tresult.remove(item);\n\t\t\t\tstateMap.delete(change.key);\n\t\t\t} else if (stateMap.has(change.key)) {\n\t\t\t\tconst newItem = mapper(change);\n\t\t\t\tresult.replace(stateMap.get(change.key), newItem);\n\t\t\t\tstateMap.set(change.key, newItem);\n\t\t\t} else if (!stateMap.has(change.key) && !change.deleted) {\n\t\t\t\tconst newItem = mapper(change);\n\t\t\t\tresult.push(newItem);\n\t\t\t\tstateMap.set(change.key, newItem);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Same as listen but will immediately call the callback with the current value of each key\n\t */\n\tpublic listenAndRepeat(callback: Callback<ObjectChange<T, keyof T>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tconst c = this.updateEvent.subscribe(callback, cancellationToken).cancel;\n\t\tfor (const key in this.data) {\n\t\t\tcallback({\n\t\t\t\tkey,\n\t\t\t\tnewValue: this.data[key],\n\t\t\t\toldValue: undefined,\n\t\t\t\tdeleted: false\n\t\t\t});\n\t\t}\n\t\treturn c;\n\t}\n\n\t/**\n\t * Same as listenOnKey but will immediately call the callback with the current value first\n\t */\n\tpublic listenOnKeyAndRepeat<K extends keyof T>(\n\t\tkey: K,\n\t\tcallback: Callback<ObjectChange<T, keyof T>>,\n\t\tcancellationToken?: CancellationToken\n\t): Callback<void> {\n\t\tcallback({\n\t\t\tkey,\n\t\t\tnewValue: this.data[key],\n\t\t\toldValue: undefined\n\t\t});\n\n\t\treturn this.listenOnKey(key, callback, cancellationToken);\n\t}\n\n\t/**\n\t * Listen to changes of a single key of the object\n\t */\n\tpublic listenOnKey<K extends keyof T>(key: K, callback: Callback<ObjectChange<T, K>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tif (!this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.set(key, new EventEmitter());\n\t\t}\n\t\tconst event = this.updateEventOnKey.get(key);\n\t\treturn event.subscribe(callback as any, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Returns all the keys of the object in the source\n\t */\n\tpublic keys(): string[] {\n\t\treturn Object.keys(this.data);\n\t}\n\n\t/**\n\t * Returns all the values of the object in the source\n\t */\n\tpublic values(): any {\n\t\treturn Object.values(this.data);\n\t}\n\n\t/**\n\t * get the current value of a key of the object\n\t * @param key\n\t */\n\tpublic get<K extends keyof T>(key: K): T[K] {\n\t\treturn this.data[key];\n\t}\n\n\t/**\n\t * delete a key from the object\n\t * @param key\n\t * @param value\n\t */\n\tpublic delete<K extends keyof T>(key: K): void {\n\t\tconst old = this.data[key];\n\t\tdelete this.data[key];\n\t\tthis.updateEvent.fire({ oldValue: old, key, newValue: undefined, deleted: true });\n\t\tif (this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.get(key).fire({ oldValue: old, key, newValue: undefined });\n\t\t}\n\t}\n\n\t/**\n\t * set the value for a key of the object\n\t * @param key\n\t * @param value\n\t */\n\tpublic set<K extends keyof T>(key: K, value: T[K]): void {\n\t\tif (this.data[key] === value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst old = this.data[key];\n\t\tthis.data[key] = value;\n\t\tthis.updateEvent.fire({ oldValue: old, key, newValue: this.data[key] });\n\t\tif (this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.get(key).fire({ oldValue: old, key, newValue: this.data[key] });\n\t\t}\n\t}\n\n\t/**\n\t * Merge the key value pairs of an object into this object non recursively\n\t * @param newData\n\t */\n\tpublic assign(newData: Partial<T> | ObjectDataSource<T>): void {\n\t\tif (newData instanceof ObjectDataSource) {\n\t\t\tfor (const key of newData.keys()) {\n\t\t\t\tthis.set(key as keyof T, newData.data[key]);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const key of Object.keys(newData)) {\n\t\t\t\tthis.set(key as keyof T, newData[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns a shallow copy of the object\n\t */\n\tpublic toObject(): T {\n\t\treturn { ...this.data };\n\t}\n\n\t/**\n\t * Returns a simplified version of this datasource\n\t */\n\tpublic toDataSource(): DataSource<T> {\n\t\tconst stream = new DataSource(this.data);\n\t\tthis.listen((s) => {\n\t\t\tstream.update(this.data);\n\t\t});\n\t\treturn stream;\n\t}\n}\n","import { ArrayDataSource, DataSource } from './data_source';\nimport { Callback } from '../utilities/common';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { EventEmitter } from '../utilities/event_emitter';\n\nexport interface MapChange<K, V> {\n\tkey: K;\n\toldValue: V;\n\tnewValue: V;\n\tdeleted?: boolean;\n}\n\nexport class MapDataSource<K, V> {\n\tprotected data: Map<K, V>;\n\tprivate updateEvent: EventEmitter<MapChange<K, V>>;\n\tprivate updateEventOnKey: Map<K, EventEmitter<MapChange<K, V>>>;\n\n\tconstructor(initialData: Map<K, V>) {\n\t\tif (initialData) {\n\t\t\tthis.data = initialData;\n\t\t}\n\n\t\tthis.updateEvent = new EventEmitter();\n\t\tthis.updateEventOnKey = new Map();\n\t}\n\n\t/**\n\t * Creates a datasource for a single key of the object\n\t * @param key\n\t * @param cancellationToken\n\t */\n\tpublic pick(key: K, cancellationToken?: CancellationToken): DataSource<V> {\n\t\tconst subDataSource: DataSource<V> = new DataSource(this.data.get(key));\n\n\t\tthis.listenOnKey(\n\t\t\tkey,\n\t\t\t(v) => {\n\t\t\t\tsubDataSource.update(v.newValue);\n\t\t\t},\n\t\t\tcancellationToken\n\t\t);\n\n\t\treturn subDataSource;\n\t}\n\n\t/**\n\t * Listen to changes of the object\n\t */\n\tpublic listen(callback: Callback<MapChange<K, V>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateEvent.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Same as listen but will immediately call the callback with the current value of each key\n\t */\n\tpublic listenAndRepeat(callback: Callback<MapChange<K, V>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tconst c = this.updateEvent.subscribe(callback, cancellationToken).cancel;\n\t\tfor (const key of this.data.keys()) {\n\t\t\tcallback({\n\t\t\t\tkey,\n\t\t\t\tnewValue: this.data.get(key),\n\t\t\t\toldValue: undefined,\n\t\t\t\tdeleted: false\n\t\t\t});\n\t\t}\n\t\treturn c;\n\t}\n\n\tpublic map<D>(mapper: (change: MapChange<K, V>) => D): ArrayDataSource<D> {\n\t\tconst stateMap: Map<K, D> = new Map<K, D>();\n\t\tconst result = new ArrayDataSource<D>();\n\t\tthis.listenAndRepeat((change) => {\n\t\t\tif (change.deleted && stateMap.has(change.key)) {\n\t\t\t\tconst item = stateMap.get(change.key);\n\t\t\t\tresult.remove(item);\n\t\t\t\tstateMap.delete(change.key);\n\t\t\t} else if (stateMap.has(change.key)) {\n\t\t\t\tconst newItem = mapper(change);\n\t\t\t\tresult.replace(stateMap.get(change.key), newItem);\n\t\t\t\tstateMap.set(change.key, newItem);\n\t\t\t} else if (!stateMap.has(change.key) && !change.deleted) {\n\t\t\t\tconst newItem = mapper(change);\n\t\t\t\tresult.push(newItem);\n\t\t\t\tstateMap.set(change.key, newItem);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Same as listenOnKey but will immediately call the callback with the current value first\n\t */\n\tpublic listenOnKeyAndRepeat(key: K, callback: Callback<MapChange<K, V>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tcallback({\n\t\t\tkey,\n\t\t\tnewValue: this.data.get(key),\n\t\t\toldValue: undefined\n\t\t});\n\n\t\treturn this.listenOnKey(key, callback, cancellationToken);\n\t}\n\n\t/**\n\t * Listen to changes of a single key of the object\n\t */\n\tpublic listenOnKey(key: K, callback: Callback<MapChange<K, V>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tif (!this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.set(key, new EventEmitter());\n\t\t}\n\t\tconst event = this.updateEventOnKey.get(key);\n\t\treturn event.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Returns all the keys of the object in the source\n\t */\n\tpublic keys(): IterableIterator<K> {\n\t\treturn this.data.keys();\n\t}\n\n\t/**\n\t * Returns all the values of the object in the source\n\t */\n\tpublic values(): IterableIterator<V> {\n\t\treturn this.data.values();\n\t}\n\n\t/**\n\t * get the current value of a key of the object\n\t * @param key\n\t */\n\tpublic get(key: K): V {\n\t\treturn this.data.get(key);\n\t}\n\n\t/**\n\t * check if map has a key\n\t * @param key\n\t */\n\tpublic has(key: K): boolean {\n\t\treturn this.data.has(key);\n\t}\n\n\t/**\n\t * delete a key from the object\n\t * @param key\n\t * @param value\n\t */\n\tpublic delete(key: K): void {\n\t\tconst old = this.data.get(key);\n\t\tthis.data.delete(key);\n\t\tthis.updateEvent.fire({ oldValue: old, key, newValue: undefined, deleted: true });\n\t\tif (this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.get(key).fire({ oldValue: old, key, newValue: undefined });\n\t\t}\n\t}\n\n\t/**\n\t * set the value for a key of the object\n\t * @param key\n\t * @param value\n\t */\n\tpublic set(key: K, value: V): void {\n\t\tif (this.data.get(key) === value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst old = this.data.get(key);\n\t\tthis.data.set(key, value);\n\t\tthis.updateEvent.fire({ oldValue: old, key, newValue: this.data.get(key) });\n\t\tif (this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.get(key).fire({ oldValue: old, key, newValue: this.data.get(key) });\n\t\t}\n\t}\n\n\t/**\n\t * Merge the key value pairs of an object into this object non recursively\n\t * @param newData\n\t */\n\tpublic assign(newData: Map<K, V> | MapDataSource<K, V>): void {\n\t\tfor (const key of newData.keys()) {\n\t\t\tthis.set(key, newData.get(key));\n\t\t}\n\t}\n\n\t/**\n\t * Returns a shallow copy of the map\n\t */\n\tpublic toMap(): Map<K, V> {\n\t\treturn new Map(this.data.entries());\n\t}\n}\n","import { ArrayDataSource, DataSource } from './data_source';\nimport { Callback } from '../utilities/common';\nimport { CancellationToken } from '../utilities/cancellation_token';\nimport { EventEmitter } from '../utilities/event_emitter';\n\nexport interface SetChange<K> {\n\tkey: K;\n\texists: boolean;\n}\n\nexport class SetDataSource<K> {\n\tprotected data: Set<K>;\n\tprivate updateEvent: EventEmitter<SetChange<K>>;\n\tprivate updateEventOnKey: Map<K, EventEmitter<boolean>>;\n\n\tconstructor(initialData: Set<K>) {\n\t\tif (initialData) {\n\t\t\tthis.data = initialData;\n\t\t}\n\n\t\tthis.updateEvent = new EventEmitter();\n\t\tthis.updateEventOnKey = new Map();\n\t}\n\n\t/**\n\t * Creates a datasource for a single key of the object\n\t * @param key\n\t * @param cancellationToken\n\t */\n\tpublic pick(key: K, cancellationToken?: CancellationToken): DataSource<boolean> {\n\t\tconst subDataSource: DataSource<boolean> = new DataSource(this.data.has(key));\n\n\t\tthis.listenOnKey(\n\t\t\tkey,\n\t\t\t(v) => {\n\t\t\t\tsubDataSource.update(v);\n\t\t\t},\n\t\t\tcancellationToken\n\t\t);\n\n\t\treturn subDataSource;\n\t}\n\n\t/**\n\t * Listen to changes of the object\n\t */\n\tpublic listen(callback: Callback<SetChange<K>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\treturn this.updateEvent.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\t/**\n\t * Same as listen but will immediately call the callback with the current value of each key\n\t */\n\tpublic listenAndRepeat(callback: Callback<SetChange<K>>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tconst c = this.updateEvent.subscribe(callback, cancellationToken).cancel;\n\t\tfor (const key of this.data.keys()) {\n\t\t\tcallback({\n\t\t\t\tkey,\n\t\t\t\texists: true\n\t\t\t});\n\t\t}\n\t\treturn c;\n\t}\n\n\t/**\n\t * Same as listenOnKey but will immediately call the callback with the current value first\n\t */\n\tpublic listenOnKeyAndRepeat(key: K, callback: Callback<boolean>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tcallback(this.has(key));\n\n\t\treturn this.listenOnKey(key, callback, cancellationToken);\n\t}\n\n\t/**\n\t * Listen to changes of a single key of the object\n\t */\n\tpublic listenOnKey(key: K, callback: Callback<boolean>, cancellationToken?: CancellationToken): Callback<void> {\n\t\tif (!this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.set(key, new EventEmitter());\n\t\t}\n\t\tconst event = this.updateEventOnKey.get(key);\n\t\treturn event.subscribe(callback, cancellationToken).cancel;\n\t}\n\n\tpublic map<D>(mapper: (change: SetChange<K>) => D): ArrayDataSource<D> {\n\t\tconst stateMap: Map<K, D> = new Map<K, D>();\n\t\tconst result = new ArrayDataSource<D>();\n\t\tthis.listenAndRepeat((change) => {\n\t\t\tif (!change.exists && stateMap.has(change.key)) {\n\t\t\t\tconst item = stateMap.get(change.key);\n\t\t\t\tresult.remove(item);\n\t\t\t\tstateMap.delete(change.key);\n\t\t\t} else if (!stateMap.has(change.key) && change.exists) {\n\t\t\t\tconst newItem = mapper(change);\n\t\t\t\tresult.push(newItem);\n\t\t\t\tstateMap.set(change.key, newItem);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns all the keys of the object in the source\n\t */\n\tpublic keys(): IterableIterator<K> {\n\t\treturn this.data.keys();\n\t}\n\n\t/**\n\t * check if map has a key\n\t * @param key\n\t */\n\tpublic has(key: K): boolean {\n\t\treturn this.data.has(key);\n\t}\n\n\t/**\n\t * delete a key from the object\n\t * @param key\n\t * @param value\n\t */\n\tpublic delete(key: K): void {\n\t\tthis.data.delete(key);\n\t\tthis.updateEvent.fire({ key, exists: false });\n\t\tif (this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.get(key).fire(false);\n\t\t}\n\t}\n\n\t/**\n\t * set the value for a key of the object\n\t * @param key\n\t * @param value\n\t */\n\tpublic add(key: K): void {\n\t\tif (this.data.has(key)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.data.add(key);\n\t\tthis.updateEvent.fire({ key, exists: true });\n\t\tif (this.updateEventOnKey.has(key)) {\n\t\t\tthis.updateEventOnKey.get(key).fire(true);\n\t\t}\n\t}\n\n\t/**\n\t * Merge the key value pairs of an object into this object non recursively\n\t * @param newData\n\t */\n\tpublic assign(newData: Set<K> | SetDataSource<K>): void {\n\t\tfor (const key of newData.keys()) {\n\t\t\tthis.add(key);\n\t\t}\n\t}\n\n\t/**\n\t * Returns a shallow copy of the set\n\t */\n\tpublic toSet(): Set<K> {\n\t\treturn new Set(this.data.keys());\n\t}\n}\n","export * from './rendering/classname';\nexport * from './rendering/webcomponent';\nexport * from './rendering/aurum_element';\nexport * from './builtin_compoents/router';\nexport * from './builtin_compoents/suspense';\nexport * from './builtin_compoents/switch';\nexport * from './stream/data_source';\nexport * from './stream/duplex_data_source';\nexport * from './stream/object_data_source';\nexport * from './stream/map_data_source';\nexport * from './stream/set_data_source';\nexport * from './stream/data_source_operators';\nexport * from './stream/operator_model';\nexport * from './stream/stream';\nexport * from './utilities/aurum';\nexport * from './utilities/cancellation_token';\nexport * from './utilities/event_emitter';\nexport { debugMode, enableDebugMode } from './debug_mode';\nexport { AttributeValue, ClassType, DataDrain } from './utilities/common';\n"]}